<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Статистична потужність, ефект та довірчі інтервали – Прикладний статистичний аналіз</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./z-test.html" rel="next">
<link href="./binom.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6c380caa1d326ca7d97976c903cdd929.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Не має результатів",
    "search-matching-documents-text": "Результати пошуку",
    "search-copy-link-title": "Скопіювати посилання",
    "search-hide-matches-text": "Сховати додаткові результати",
    "search-more-match-text": "додатковий результат у цьому документі",
    "search-more-matches-text": "додаткових результатів у цьому документі",
    "search-clear-button-title": "Очистити",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Відмінити",
    "search-submit-button-title": "Надіслати",
    "search-label": "Пошук"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключити бокову панель навігації" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./power.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Статистична потужність, ефект та довірчі інтервали</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключити бокову панель навігації" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Пошук" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Прикладний статистичний аналіз</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Переключити режим читання">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Пошук"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Передмова</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Вступ</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./binom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Біноміальний критерій</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./power.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Статистична потужність, ефект та довірчі інтервали</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./z-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><span class="math inline">\(Z\)</span>-критерій Фішера</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><span class="math inline">\(t\)</span>-критерій Стьюдента</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./monte-carlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Монте-Карло в задачах статистики</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Підсумки</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Список літератури</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Зміст</h2>
   
  <ul>
  <li><a href="#статистична-потужність" id="toc-статистична-потужність" class="nav-link active" data-scroll-target="#статистична-потужність"><span class="header-section-number">2.1</span> Статистична потужність</a>
  <ul class="collapse">
  <li><a href="#хибно-негативні-помилки" id="toc-хибно-негативні-помилки" class="nav-link" data-scroll-target="#хибно-негативні-помилки"><span class="header-section-number">2.1.1</span> Хибно негативні помилки</a></li>
  <li><a href="#критерій-пори-року" id="toc-критерій-пори-року" class="nav-link" data-scroll-target="#критерій-пори-року"><span class="header-section-number">2.1.2</span> Критерій пори року</a></li>
  <li><a href="#потужність" id="toc-потужність" class="nav-link" data-scroll-target="#потужність"><span class="header-section-number">2.1.3</span> Потужність</a></li>
  </ul></li>
  <li><a href="#потужність-для-біноміального-розподілу" id="toc-потужність-для-біноміального-розподілу" class="nav-link" data-scroll-target="#потужність-для-біноміального-розподілу"><span class="header-section-number">2.2</span> Потужність для біноміального розподілу</a></li>
  <li><a href="#мінімальна-величина-ефекту" id="toc-мінімальна-величина-ефекту" class="nav-link" data-scroll-target="#мінімальна-величина-ефекту"><span class="header-section-number">2.3</span> Мінімальна величина ефекту</a></li>
  <li><a href="#sec-ci" id="toc-sec-ci" class="nav-link" data-scroll-target="#sec-ci"><span class="header-section-number">2.4</span> Довірчі інтервали</a></li>
  <li><a href="#односторонні-довірчі-інтервали" id="toc-односторонні-довірчі-інтервали" class="nav-link" data-scroll-target="#односторонні-довірчі-інтервали"><span class="header-section-number">2.5</span> Односторонні довірчі інтервали</a></li>
  <li><a href="#властивості-довірчих-інтервалів" id="toc-властивості-довірчих-інтервалів" class="nav-link" data-scroll-target="#властивості-довірчих-інтервалів"><span class="header-section-number">2.6</span> Властивості довірчих інтервалів</a>
  <ul class="collapse">
  <li><a href="#ймовірність-попадання-в-інтервал" id="toc-ймовірність-попадання-в-інтервал" class="nav-link" data-scroll-target="#ймовірність-попадання-в-інтервал"><span class="header-section-number">2.6.1</span> Ймовірність попадання в інтервал</a></li>
  <li><a href="#довірчий-інтервал-вілсона" id="toc-довірчий-інтервал-вілсона" class="nav-link" data-scroll-target="#довірчий-інтервал-вілсона"><span class="header-section-number">2.6.2</span> Довірчий інтервал Вілсона</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Статистична потужність, ефект та довірчі інтервали</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="статистична-потужність" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="статистична-потужність"><span class="header-section-number">2.1</span> Статистична потужність</h2>
<section id="хибно-негативні-помилки" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="хибно-негативні-помилки"><span class="header-section-number">2.1.1</span> Хибно негативні помилки</h3>
<p>Раніше під час побудови критеріїв ми звертали увагу тільки на <span class="math inline">\(\alpha\)</span>, рівень значущості критерію. Але цей параметр контролює лише хибнопозитивну помилку (False Positive), а саме ймовірність, що критерій прийме <span class="math inline">\(H_1\)</span> за умови вірності <span class="math inline">\(H_0\)</span>.</p>
<p>Але є ще один вид помилок, які може допустити критерій — хибно негативні помилки (False Negative). Це випадки, коли критерій приймає <span class="math inline">\(H_0\)</span> за умови вірності <span class="math inline">\(H_1\)</span>. Це важливо, оскільки вони можуть вказувати на те, що критерій не чутливий до змін, які відбуваються в даних.</p>
<p>Випадок, коли ймовірність FPR <span class="math inline">\(&lt; \alpha\)</span>, але при цьому ймовірність хибно негативні помилки (False Negative Rate, FNR) величезна, можна навести легко. Для цього достатньо <strong>ніколи</strong> не відкидати гіпотезу, взявши критерій <span class="math inline">\(S \equiv 0\)</span>.</p>
<p>Наведемо приклад, коли помилки False Negative відбуваються не завжди, але критерії є все одно нечутливими.</p>
</section>
<section id="критерій-пори-року" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="критерій-пори-року"><span class="header-section-number">2.1.2</span> Критерій пори року</h3>
<p>Поставимо гіпотезу про те, що зараз на вулиці літо. Для перевірки можна було б, звісно, подивитися в календар, але ми зробимо інакше.</p>
<p><span class="math display">\[
H_0: \text{ на вулиці літо}
\]</span></p>
<p><span class="math display">\[
H_1: \text{ на вулиці не літо}
\]</span></p>
<p>Подивимося у вікно і визначимо, чи йде там сніг. Якщо він йде, то це непоганий доказ того, що зараз не літо, а отже можна відкинути <span class="math inline">\(H_0\)</span>.</p>
<p>Порахуємо FPR та FNR для цього критерію. Ми знаємо, що влітку сніг іде дуже рідко (ймовірність помилки нижча за <span class="math inline">\(0.1\%\)</span>), тож це точно критерій рівня значущості <span class="math inline">\(0.001\)</span>, чого зазвичай достатньо для критеріїв.</p>
<p><span class="math display">\[
FPR(S) = P(\text{йде сніг}\ |\ \text{сьогодні літо}) &lt; 0.001
\]</span></p>
<p>Але що з FNR? Розглянемо конкретний випадок: зараз вересень. Оскільки у вересні майже завжди немає снігу, можна сказати, що FNR більша за <span class="math inline">\(90\%\)</span>, отже, цей критерій насправді мало дієвий.</p>
<p><span class="math display">\[
FNR(S) = P(\text{не йде сніг}\ |\ \text{зараз вересень}) &gt; 0.9
\]</span></p>
<p>Сформулюємо інший критерій рівня значущості <span class="math inline">\(\alpha\)</span>, причому в цьому разі рівень значущості можна вибрати довільним.</p>
<p><span class="math display">\[
S(\xi) = \begin{cases}
    1, \text{ якщо монетка з імовірністю орла } \alpha \text{ випала орлом} \\
    0, \text{ інакше}
\end{cases}
\]</span></p>
<p>Виходить, цей критерій випадковий, і він не використовує взагалі жодної інформації про погоду. Однак вимогам до рівня значущості він задовольняє.</p>
<p><span class="math display">\[
FPR = P(\text{випав орел}\ |\ \text{сьогодні літо}) = P(\text{випав орел}) = \alpha
\]</span></p>
<p>Обчислимо FNR.</p>
<p><span class="math display">\[
FNR = P(\text{не випав орел}\ |\ \text{сьогодні не літо}) = P(\text{не випав орел}) = 1 - \alpha
\]</span></p>
<p>За <span class="math inline">\(\alpha = 0.001\)</span>, як у першому випадку, отримуємо ймовірність FNR <span class="math inline">\(0.999 &gt; 0.9\)</span>, тобто за однакового рівня значущості з першим критерієм, другий критерій частіше припускається хибно негативної помилки.</p>
</section>
<section id="потужність" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="потужність"><span class="header-section-number">2.1.3</span> Потужність</h3>
<p>У статистиці заведено позитивним результатом вважати відкидання нульової гіпотези, бо зазвичай підтвердження альтернативи означає наявність бізнес-результату. Тому вважається хорошим критерій, який частіше дає змогу виявити бізнес-результат. І рахують тоді не ймовірність хибно негативної помилки, а <em>потужність</em>, що дорівнює ймовірності відкинути нульову гіпотезу за вірності <span class="math inline">\(H_1\)</span>, тобто ймовірність <strong>істинно позитивного результату</strong> (True Positive Rate, TPR).</p>
<p><span id="eq-power"><span class="math display">\[
\text{Power}_S = 1 - FNR
\tag{2.1}\]</span></span></p>
<p>Коли альтернатива <span class="math inline">\(H_1\)</span> складається з множини результатів, потужність розглядають як функцію від результату. Наприклад, можна порахувати потужність першого та другого критеріїв взимку й восени.</p>
<p><span class="math display">\[
\text{Power}_S(\mu) = 1 - FNR(\mu)
\]</span></p>
<p><strong>Перший критерій</strong></p>
<p><span class="math display">\[
\text{Power}_S(\text{травень}) = P(\text{їде сніг } | \text{ травень}) \approx 0.00001
\]</span></p>
<p><span class="math display">\[
\text{Power}_S(\text{жовтень}) = P(\text{їде сніг } | \text{ жовтень}) \approx 0.1
\]</span></p>
<p><span class="math display">\[
\text{Power}_S(\text{січень}) = P(\text{їде сніг } | \text{ січень}) \approx 0.5
\]</span></p>
<p><strong>Другий критерій</strong></p>
<p><span class="math display">\[
\text{Power}_S(\text{травень}) = P(\text{випав орел } | \text{ травень}) = \alpha = 0.001
\]</span></p>
<p><span class="math display">\[
\text{Power}_S(\text{жовтень}) = P(\text{випав орел } | \text{ жовтень}) = \alpha = 0.001
\]</span></p>
<p><span class="math display">\[
\text{Power}_S(\text{січень}) = P(\text{випав орел } | \text{ січень}) = \alpha = 0.001
\]</span></p>
<p>Зазвичай завдання пошуку найкращого критерію формулюється як пошук якомога потужнішого критерію за заданого рівня значущості <span class="math inline">\(FPR \leqslant \alpha\)</span>. Але ми сказали, що потужність — функція від параметра, у нашому випадку від місяця.</p>
<p>Якщо ми застосовуватимемо критерій у січні, то потужнішим буде перший критерій, а якщо в травні, то потужнішим буде другий критерій. Тому потрібно розуміти, коли буде застосовуватися критерій, а отже, ми шукаємо найпотужніший критерій у галузі, яка нас цікавить.</p>
<p>Хоча в реальності в травні потужність обох критеріїв настільки низька, що вони просто не приносять користі, й використовувати їх не має сенсу.</p>
</section>
</section>
<section id="потужність-для-біноміального-розподілу" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="потужність-для-біноміального-розподілу"><span class="header-section-number">2.2</span> Потужність для біноміального розподілу</h2>
<p>Застосуємо нові знання про потужність для нашої задачі з освітнім сервісом. З бізнес-міркувань ми вже вибрали <span class="math inline">\(\alpha = 0.05\)</span>, а отже, знаємо, що ми неправильно відкидаємо гіпотезу <span class="math inline">\(H_0:\ \mu = 0.5\)</span> з ймовірністю не більше, ніж <span class="math inline">\(5\%\)</span>. Тобто цим обмежена ймовірність хибно позитивної помилки.</p>
<p>А з якою ймовірністю ми будемо <em>правильно</em> відкидати гіпотезу? І яка в нас буде ймовірність хибно негативної помилки? На це запитання якраз відповість формула потужності.</p>
<p>Згадаймо критерій, за яким ми приймаємо рішення:</p>
<p><span class="math display">\[
Q(\xi) = \sum\limits_{i=1}^n \xi_i - \text{кількість підписок}
\]</span></p>
<p><span class="math display">\[
S = \{Q \geqslant 20\}
\]</span></p>
<p>Тобто якщо отримуємо хоча б <span class="math inline">\(20\)</span> успішних підписок, то відкидаємо <span class="math inline">\({H}_0\)</span>.</p>
<p>Зауважимо, що потужність залежить від того, яке значення <span class="math inline">\(\mu\)</span> у нашій генеральній сукупності. Зафіксуємо спочатку параметр <span class="math inline">\(\mu = 0.6\)</span> й порахуємо потужність для нього. Якщо істинний параметр такий, то статистика <span class="math inline">\(Q\)</span> має розподіл <span class="math inline">\(Binom(30, 0.6)\)</span>.</p>
<div id="cell-fig-binom-power" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>binom_h0 <span class="op">=</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>binom_alternative <span class="op">=</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>x_grid <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="dv">31</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>crit_reg <span class="op">=</span> x_grid <span class="op">&gt;=</span> <span class="dv">20</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>probs_h0 <span class="op">=</span> binom_h0.pmf(x_grid)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>plt.bar(x_grid, probs_h0, color<span class="op">=</span>turquoise, label<span class="op">=</span><span class="st">'PMF, $Binom(0.5, 30)$'</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>probs_alternative <span class="op">=</span> binom_alternative.pmf(x_grid)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>plt.bar(x_grid, probs_alternative, color<span class="op">=</span>slate, label<span class="op">=</span><span class="st">'PMF, $Binom(0.6, 30)$'</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>plt.bar(x_grid[crit_reg], probs_alternative[crit_reg], color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Критична область'</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-power" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="power_files/figure-html/fig-binom-power-output-1.png" width="652" height="304" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;2.1: Потужність критерію для <span class="math inline">\(\mu = 0.6\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Як і раніше, нас цікавить імовірність отримати <span class="math inline">\(20\)</span> або більше успіхів. Але якщо раніше ми дивилися на неї для розподілу з <span class="math inline">\(\mu=0.5\)</span> й хотіли, щоб вона була меншою за <span class="math inline">\(5\%\)</span>, то тепер ми дивимося за <span class="math inline">\(\mu = 0.6\)</span> та прагнемо зробити цю величину якомога більшою. Порівняно з обчисленням FPR формула не зміниться, змінюється тільки <span class="math inline">\(\mu\)</span></p>
<div id="a0c0f061" class="cell" data-execution_count="3">
<div id="lst-binom-power" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.1: Обчислення потужності критерію
</figcaption>
<div aria-describedby="lst-binom-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-power"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-power-1"><a href="#lst-binom-power-1" aria-hidden="true" tabindex="-1"></a>critical_value <span class="op">=</span> <span class="dv">20</span></span>
<span id="lst-binom-power-2"><a href="#lst-binom-power-2" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span><span class="fl">0.6</span>).cdf(critical_value <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="lst-binom-power-3"><a href="#lst-binom-power-3" aria-hidden="true" tabindex="-1"></a>fpr   <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span><span class="fl">0.5</span>).cdf(critical_value <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="lst-binom-power-4"><a href="#lst-binom-power-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-power-5"><a href="#lst-binom-power-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Хибно позитивна помилка: </span><span class="sc">{</span>fpr<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="lst-binom-power-6"><a href="#lst-binom-power-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Потужність: </span><span class="sc">{</span>power<span class="sc">:.1%}</span><span class="ss">"</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Хибно позитивна помилка: 4.9%
Потужність: 29.1%</code></pre>
</div>
</div>
<p>Видно, що потужність близько <span class="math inline">\(30\%\)</span>. Це досить маленьке значення, адже якщо наш продукт прибутковий, то ми побачимо це за допомогою нашого тесту тільки з імовірністю в <span class="math inline">\(30\)</span> відсотків. Ми легко можемо пропустити ефект.</p>
<p>Що ж можна зробити, щоб зробити потужність вищою? Щоб розібратися, реалізуємо функцію потужності в загальному вигляді.</p>
<div id="ed6da961" class="cell" data-execution_count="4">
<div id="lst-binom-power-general" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-power-general-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.2: Обчислення потужності критерію для загального випадку
</figcaption>
<div aria-describedby="lst-binom-power-general-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-power-general"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-power-general-1"><a href="#lst-binom-power-general-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_stat_power(N, mu_h0, mu_alternative, alpha):</span>
<span id="lst-binom-power-general-2"><a href="#lst-binom-power-general-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''Обчислює статистичну потужність критерію для біноміального розподілу</span></span>
<span id="lst-binom-power-general-3"><a href="#lst-binom-power-general-3" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="lst-binom-power-general-4"><a href="#lst-binom-power-general-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Параметри:</span></span>
<span id="lst-binom-power-general-5"><a href="#lst-binom-power-general-5" aria-hidden="true" tabindex="-1"></a><span class="co">        N - кількість бернуллієвських експериментів (розмір вибірки)</span></span>
<span id="lst-binom-power-general-6"><a href="#lst-binom-power-general-6" aria-hidden="true" tabindex="-1"></a><span class="co">        mu_h0 - імовірність успіху в нульовій гіпотезі</span></span>
<span id="lst-binom-power-general-7"><a href="#lst-binom-power-general-7" aria-hidden="true" tabindex="-1"></a><span class="co">        mu_alternative - передбачувана ймовірність успіху в експерименті</span></span>
<span id="lst-binom-power-general-8"><a href="#lst-binom-power-general-8" aria-hidden="true" tabindex="-1"></a><span class="co">        alpha - рівень значущості критерію</span></span>
<span id="lst-binom-power-general-9"><a href="#lst-binom-power-general-9" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="lst-binom-power-general-10"><a href="#lst-binom-power-general-10" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span>N, p<span class="op">=</span>mu_h0)</span>
<span id="lst-binom-power-general-11"><a href="#lst-binom-power-general-11" aria-hidden="true" tabindex="-1"></a>    binom_alternative <span class="op">=</span> binom(n<span class="op">=</span>N, p<span class="op">=</span>mu_alternative)</span>
<span id="lst-binom-power-general-12"><a href="#lst-binom-power-general-12" aria-hidden="true" tabindex="-1"></a>    critical_value <span class="op">=</span> binom_h0.ppf(<span class="dv">1</span> <span class="op">-</span> alpha) <span class="op">+</span> <span class="dv">1</span></span>
<span id="lst-binom-power-general-13"><a href="#lst-binom-power-general-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="op">-</span> binom_alternative.cdf(critical_value <span class="op">-</span> <span class="dv">1</span>) </span>
<span id="lst-binom-power-general-14"><a href="#lst-binom-power-general-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-power-general-15"><a href="#lst-binom-power-general-15" aria-hidden="true" tabindex="-1"></a>get_stat_power(<span class="dv">30</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, alpha<span class="op">=</span><span class="fl">0.05</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>0.2914718612234968</code></pre>
</div>
</div>
<p>Коли в житті ми спостерігаємо якесь явище і бачимо його лише кілька разів, ми не впевнені в тому, що воно не випадкове. Якщо ж бачимо його досить часто, то вже складаємо закономірності. Так і в статистиці. Коли ми подивилися на 30 потенційних підписок, ми помічаємо, що частка доставок більше половини. Але ми все ще не впевнені. Щоб отримати більше впевненості, потрібно провести більше спостережень, тобто знайти більше пробних клієнтів.</p>
<p>Подивимося, що буде, якщо ми проведемо експеримент на 300 клієнтах.</p>
<div id="6129b9db" class="cell" data-execution_count="5">
<div id="lst-binom-power-general-300" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-power-general-300-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.3: Обчислення потужності критерію для 300 клієнтів
</figcaption>
<div aria-describedby="lst-binom-power-general-300-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-power-general-300"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-power-general-300-1"><a href="#lst-binom-power-general-300-1" aria-hidden="true" tabindex="-1"></a>get_stat_power(<span class="dv">300</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, alpha<span class="op">=</span><span class="fl">0.05</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>0.9655326717180749</code></pre>
</div>
</div>
<p>Бачимо, що потужність уже дуже близька до <span class="math inline">\(100\%\)</span>. Але провести 300 пробних занять набагато затратніше, ніж 30. І за ресурсами, і за часом. Тому зазвичай балансують між потужністю і тривалістю/витратами експерименту.</p>
<p>Прийнято вважати, що прийнятною для роботи потужністю вважається <span class="math inline">\(80\%\)</span>. Подивимося, як змінюється потужність при зростанні розміру вибірки, і скільки потрібно провести експериментів, щоб детектувати ефект при <span class="math inline">\(\mu = 0.6\)</span> у <span class="math inline">\(80\%\)</span> випадків.</p>
<div id="cell-fig-binom-power-n" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>n_grid <span class="op">=</span> np.arange(<span class="dv">10</span>, <span class="dv">600</span>, <span class="dv">10</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> get_stat_power(n_grid, <span class="fl">0.5</span>, <span class="fl">0.6</span>, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Кількість пробних занять'</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Потжність'</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>plt.plot(n_grid, power, color<span class="op">=</span>turquoise)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="fl">0.8</span>, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Потужність = 80%'</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>min_n <span class="op">=</span> n_grid[power <span class="op">&gt;=</span> <span class="fl">0.8</span>].<span class="bu">min</span>()</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>plt.axvline(min_n, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>slate, label<span class="op">=</span><span class="ss">f'N = </span><span class="sc">{</span>min_n<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-power-n" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-power-n-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="power_files/figure-html/fig-binom-power-n-output-1.png" width="666" height="324" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-power-n-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;2.2: Залежність потужності від розміру вибірки для <span class="math inline">\(\mu = 0.6\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Бачимо, що для потужності в <span class="math inline">\(80\%\)</span> достатньо набрати 160 пробних занять.</p>
<p>А що, якщо ми хочемо детектувати ще менший ефект? Наприклад, якщо хочемо відкидати гіпотезу за <span class="math inline">\(\mu = 0.51\)</span>. Часто поліпшення ймовірності успіху на <span class="math inline">\(1\%\)</span> може бути значущим для продукту, тому це питання не позбавлене сенсу.</p>
<div id="cell-fig-binom-power-n-51" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>n_grid <span class="op">=</span> np.arange(<span class="dv">10</span>, <span class="dv">30000</span>, <span class="dv">59</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> get_stat_power(n_grid, <span class="fl">0.5</span>, <span class="fl">0.51</span>, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Кількість пробних занять'</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Потжність'</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>plt.plot(n_grid, power, color<span class="op">=</span>turquoise)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="fl">0.8</span>, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Потужність = 80%'</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>min_n <span class="op">=</span> n_grid[power <span class="op">&gt;=</span> <span class="fl">0.8</span>].<span class="bu">min</span>()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>plt.axvline(min_n, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>slate, label<span class="op">=</span><span class="ss">f'N = </span><span class="sc">{</span>min_n<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-power-n-51" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-power-n-51-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="power_files/figure-html/fig-binom-power-n-51-output-1.png" width="661" height="319" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-power-n-51-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;2.3: Залежність потужності від розміру вибірки для <span class="math inline">\(\mu = 0.51\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Бачимо, що потрібно понад 15 тисяч клієнтів, щоб детектувати такий ефект! Дуже складно знайти стільки пробних клієнтів. Але потрібно замислитися над питанням, а чи варто це робити? У нашому випадку, якщо ймовірність успіху <span class="math inline">\(51\%\)</span>, то прибуток із замовлень буде невеликий, і вкладення інвесторів, звісно, окупатимуться, але дуже довго. Тому збільшення на <span class="math inline">\(1%\)</span> для нашого завдання не значуще <em>практично</em>, а отже, не потрібно намагатися набирати 15 тисяч людей, а можна зупинитися і на 160.</p>
<p>Перед кожним експериментом аналітику варто замислюватися над питанням тривалості тесту і кількості учасників. Для цього потрібно зрозуміти:</p>
<ul>
<li>Який ефект є для завдання практично значущим?</li>
<li>Скільки знадобиться випробовуваних, щоб детектувати цей ефект частіше, ніж у <span class="math inline">\(80\%\)</span> випадків?</li>
</ul>
<p>З графіків видно, що для детектування меншого ефекту потрібен більший розмір вибірки. Подивимося, як для фіксованого <span class="math inline">\(N=30\)</span> змінюється потужність для різних параметрів <span class="math inline">\(\mu\)</span>.</p>
<div id="cell-fig-binom-power-mu" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.linspace(<span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="dv">100</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> get_stat_power(<span class="dv">30</span>, <span class="fl">0.5</span>, mu_grid, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Ймовірність успіху'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Потужність'</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>plt.plot(mu_grid, power, color<span class="op">=</span>turquoise)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="fl">0.8</span>, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Потужність = 80%'</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>min_mu <span class="op">=</span> mu_grid[power <span class="op">&gt;=</span> <span class="fl">0.8</span>].<span class="bu">min</span>()</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>plt.axvline(min_mu, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>slate, label<span class="op">=</span><span class="ss">f'$\mu = </span><span class="sc">{</span>min_mu<span class="sc">:.2f}</span><span class="ss">$'</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-power-mu" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-power-mu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="power_files/figure-html/fig-binom-power-mu-output-1.png" width="666" height="327" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-power-mu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;2.4: Залежність потужності від параметра <span class="math inline">\(\mu\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>У нашому експерименті ми добре детектуємо ефект, тільки якщо ймовірність успіху в генеральній сукупності хоча б <span class="math inline">\(72\%\)</span>.</p>
</section>
<section id="мінімальна-величина-ефекту" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="мінімальна-величина-ефекту"><span class="header-section-number">2.3</span> Мінімальна величина ефекту</h2>
<p>Вище на <a href="#fig-binom-power-mu" class="quarto-xref">Рисунок&nbsp;<span>2.4</span></a> ми побачили, що з хорошою потужністю понад <span class="math inline">\(80\%\)</span> ми можемо помітити ефект у <span class="math inline">\(22\)</span> процентних пункти. Причому це можна порахувати навіть до проведення експерименту. У нашому випадку таке збільшення успішності щодо <span class="math inline">\(0.5\)</span> цілком можливо, і з ним можна працювати. Але коли аналітики перевіряють зміни, найчастіше очікуваний ефект коливається в районі одного, максимум двох відсотків! Для подібних змін не підійде обрана постановка експерименту, а значить і проводити його не має сенсу.</p>
<p>Тому перед запуском експериментів аналітики повідомляють <strong>мінімальну величину ефекту, яку можна задетектувати</strong> (Minimal Detectable Effect, MDE). У нашому випадку <span class="math inline">\(MDE = +22\)</span> процентних пункти.</p>
<p>Більш формально, MDE для гіпотези <span class="math inline">\(H_0: \mu = \mu_0\)</span> — це мінімальний ефект <span class="math inline">\(\delta\)</span>, за якого критерій рівня значущості <span class="math inline">\(\alpha\)</span> для перевірки цієї гіпотези за істинного параметра <span class="math inline">\(\mu = \mu_0 + \delta\)</span> та розміру вибірки <span class="math inline">\(N\)</span> відкидатиме <span class="math inline">\({H}_0\)</span> з потужністю більшою, ніж <span class="math inline">\(1 - \beta\)</span>.</p>
<p>Найчастіше беруть <span class="math inline">\(1 - \beta = 80\%\)</span>. Напишемо функцію, яка обчислюватиме MDE підбором.</p>
<div id="6e30b46b" class="cell" data-execution_count="9">
<div id="lst-binom-mde" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-mde-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.4: Обчислення MDE
</figcaption>
<div aria-describedby="lst-binom-mde-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-mde"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-mde-1"><a href="#lst-binom-mde-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> binom_test_mde_one_sided(N, mu0, alpha<span class="op">=</span><span class="fl">0.05</span>, min_power<span class="op">=</span><span class="fl">0.8</span>):</span>
<span id="lst-binom-mde-2"><a href="#lst-binom-mde-2" aria-hidden="true" tabindex="-1"></a>    delta_grid <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span> <span class="op">-</span> mu0, <span class="dv">500</span>) </span>
<span id="lst-binom-mde-3"><a href="#lst-binom-mde-3" aria-hidden="true" tabindex="-1"></a>    power <span class="op">=</span> get_stat_power(N, mu0, mu0 <span class="op">+</span> delta_grid, alpha<span class="op">=</span>alpha)</span>
<span id="lst-binom-mde-4"><a href="#lst-binom-mde-4" aria-hidden="true" tabindex="-1"></a>    fit_delta <span class="op">=</span> delta_grid[power <span class="op">&gt;=</span> min_power]</span>
<span id="lst-binom-mde-5"><a href="#lst-binom-mde-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fit_delta[<span class="dv">0</span>]</span>
<span id="lst-binom-mde-6"><a href="#lst-binom-mde-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-mde-7"><a href="#lst-binom-mde-7" aria-hidden="true" tabindex="-1"></a>binom_test_mde_one_sided(<span class="dv">30</span>, <span class="fl">0.5</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0.21843687374749496</code></pre>
</div>
</div>
<p>Результат збігається з обчисленнями за графіком <a href="#fig-binom-power-mu" class="quarto-xref">Рисунок&nbsp;<span>2.4</span></a>. Тобто ми можемо детектувати ефект у <span class="math inline">\(22\)</span> процентних пункти.</p>
<p>Зазвичай MDE розраховують не просто так, а нерозривно з ним іде питання про визначення <strong>розміру вибірки</strong>.</p>
<p>У нашому завданні ми знайшли <span class="math inline">\(30\)</span> клієнтів, не обчислюючи спочатку, скільки їх знадобиться. Але що якщо отриманий MDE занадто великий й потрібно зробити його меншим, оскільки очікувані зміни набагато менші? Тоді вирішується зворотне завдання, За необхідним MDE визначити обсяг вибірки. Якщо ми говоримо, що хочемо детектувати +10 в.п., тобто 60% успішних підписок, то потрібно знайти 160 тестових клієнтів, це видно з попередніх графіків. Якщо 30 осіб нам, наприклад, шукати місяць, такий тест може затягнутися майже на півроку. Тому варто подумати про те, щоб виділити додаткові ресурси на пошук клієнтів, наприклад, залучити маркетологів.</p>
</section>
<section id="sec-ci" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="sec-ci"><span class="header-section-number">2.4</span> Довірчі інтервали</h2>
<p>Раніше ми навчилися перевіряти гіпотезу <span class="math inline">\({H}_0: \mu = 0.5\)</span>. Як відповідь ми отримуємо лише вердикт “відкидаємо <span class="math inline">\({H}_0\)</span>” або “не відкидаємо <span class="math inline">\({H}_0\)</span>”. Однак у вибірці міститься набагато більше інформації, й ми можемо більше зрозуміти про параметр, ніж порівняння з числом <span class="math inline">\(0.5\)</span>.</p>
<p>Якщо гіпотеза <span class="math inline">\({H}_0\)</span> не відкидається, це означає, що значення <span class="math inline">\(\mu = 0.5\)</span> припустиме для нашої вибірки. Отримані значення можна пояснити значенням <span class="math inline">\(\mu = 0.5\)</span>. Але якщо у нас є механізм перевірки для будь-якого <span class="math inline">\(\mu\)</span>, ми можемо для всіх значень дізнатися, які з них допустимі, і отримати множину можливих значень <span class="math inline">\(\mu\)</span>. Така множина називається <em>довірчим інтервалом</em>.</p>
<p><strong>Довірчий інтервал</strong> рівня <span class="math inline">\(1 - \alpha\)</span> — множина значень параметра <span class="math inline">\(\mu_0\)</span>, для яких гіпотеза <span class="math inline">\(\mu = \mu_0\)</span> не відкидається критерієм рівня значущості <span class="math inline">\(\alpha\)</span>.</p>
<p>З визначення випливає, що різні критерії можуть породжувати різні довірчі інтервали. У цій частині розглянемо, які інтервали породжуються двостороннім критерієм. Для цього з кроком <span class="math inline">\(0.001\)</span> переберемо значення <span class="math inline">\(\mu \in [0, 1]\)</span> і перевіримо гіпотези.</p>
<div id="aca2aa5f" class="cell" data-execution_count="10">
<div id="lst-binom-ci" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.5: Довірчі інтервали для біноміального розподілу
</figcaption>
<div aria-describedby="lst-binom-ci-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci"><pre class="sourceCode code-annotation-code python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-1"><a href="#lst-binom-ci-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> two_sided_criterion_nonsym(n, mu, alpha):</span>
<span id="lst-binom-ci-2"><a href="#lst-binom-ci-2" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span>n, p<span class="op">=</span>mu)</span>
<span id="lst-binom-ci-3"><a href="#lst-binom-ci-3" aria-hidden="true" tabindex="-1"></a>    c2 <span class="op">=</span> binom_h0.ppf(<span class="dv">1</span> <span class="op">-</span> alpha<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="lst-binom-ci-4"><a href="#lst-binom-ci-4" aria-hidden="true" tabindex="-1"></a>    c1 <span class="op">=</span> binom_h0.ppf(alpha<span class="op">/</span><span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="lst-binom-ci-5"><a href="#lst-binom-ci-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c1, c2</span>
<span id="lst-binom-ci-6"><a href="#lst-binom-ci-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-7"><a href="#lst-binom-ci-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-8"><a href="#lst-binom-ci-8" aria-hidden="true" tabindex="-1"></a>success_cnt <span class="op">=</span> <span class="dv">19</span></span>
<span id="lst-binom-ci-9"><a href="#lst-binom-ci-9" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="lst-binom-ci-10"><a href="#lst-binom-ci-10" aria-hidden="true" tabindex="-1"></a>mu_no_rejection <span class="op">=</span> []</span>
<span id="lst-binom-ci-11"><a href="#lst-binom-ci-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-12"><a href="#lst-binom-ci-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="lst-binom-ci-13"><a href="#lst-binom-ci-13" aria-hidden="true" tabindex="-1"></a>    c1, c2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-14"><a href="#lst-binom-ci-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> success_cnt <span class="op">&gt;</span> c1 <span class="kw">and</span> success_cnt <span class="op">&lt;</span> c2:</span>
<span id="lst-binom-ci-15"><a href="#lst-binom-ci-15" aria-hidden="true" tabindex="-1"></a>        mu_no_rejection.append(mu_h0)</span>
<span id="lst-binom-ci-16"><a href="#lst-binom-ci-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-17"><a href="#lst-binom-ci-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'95% довірчий інтервал: [</span><span class="sc">{</span><span class="bu">min</span>(mu_no_rejection)<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(mu_no_rejection)<span class="sc">}</span><span class="ss">]'</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>95% довірчий інтервал: [0.439 - 0.8]</code></pre>
</div>
</div>
<ol type="1">
<li>Функція, що обчислює критичні значення для двостороннього критерію.</li>
<li>Кількість успішних підписок.</li>
<li>Сітка значень <span class="math inline">\(\mu\)</span>.</li>
<li>Список значень <span class="math inline">\(\mu\)</span>, для яких гіпотеза не відкидається.</li>
<li>Перебір значень <span class="math inline">\(\mu\)</span>.</li>
</ol>
<p>Отримавши такий інтервал, ми відразу можемо зробити висновок, що гіпотеза <span class="math inline">\({H}_0: \mu = 0.5\)</span> не відкидається, оскільки <span class="math inline">\(0.5\)</span> лежить у довірчому інтервалі. Але при цьому відразу зрозуміло, що <span class="math inline">\(\mu \neq 0.4\)</span> на рівні значущості <span class="math inline">\(\alpha\)</span>.</p>
<p>Звичайно ж, у довірчому інтервалі лежить значення <span class="math inline">\(\mu = \frac{19}{30}\)</span>, для якого <span class="math inline">\(19\)</span> успіхів — це найбільш правдоподібний результат. При цьому інтервал несиметричний щодо точки <span class="math inline">\(\frac{19}{30}\)</span>.</p>
<p>Подивимося, як можна візуально знайти межу інтервалу. Ми отримали <span class="math inline">\(19\)</span> успіхів. Для кожного <span class="math inline">\(\mu_0\)</span> статистика <span class="math inline">\(Q\)</span> має розподіл <span class="math inline">\(Binom(30, \mu_0)\)</span>. Будемо малювати цей розподіл і дивитися, чи потрапляє <span class="math inline">\(19\)</span> у критичну область.</p>
<div id="cell-fig-binom-ci" class="cell" data-execution_count="11">
<div id="lst-binom-ci-plot" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.6: Довірчі інтервали для біноміального розподілу
</figcaption>
<div aria-describedby="lst-binom-ci-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-plot"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-plot-1"><a href="#lst-binom-ci-plot-1" aria-hidden="true" tabindex="-1"></a>mus_h0 <span class="op">=</span> [<span class="fl">0.2</span>, <span class="fl">0.438</span>, <span class="fl">0.439</span>, <span class="fl">0.8</span>, <span class="fl">0.81</span>, <span class="fl">0.9</span>]</span>
<span id="lst-binom-ci-plot-2"><a href="#lst-binom-ci-plot-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-plot-3"><a href="#lst-binom-ci-plot-3" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">10</span>))</span>
<span id="lst-binom-ci-plot-4"><a href="#lst-binom-ci-plot-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-plot-5"><a href="#lst-binom-ci-plot-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0, ax <span class="kw">in</span> <span class="bu">zip</span>(mus_h0, axes.flatten()):</span>
<span id="lst-binom-ci-plot-6"><a href="#lst-binom-ci-plot-6" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span>mu_h0)</span>
<span id="lst-binom-ci-plot-7"><a href="#lst-binom-ci-plot-7" aria-hidden="true" tabindex="-1"></a>    probs <span class="op">=</span> binom_h0.pmf(x_grid)</span>
<span id="lst-binom-ci-plot-8"><a href="#lst-binom-ci-plot-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-plot-9"><a href="#lst-binom-ci-plot-9" aria-hidden="true" tabindex="-1"></a>    ax.bar(x_grid, probs, color<span class="op">=</span>turquoise, label<span class="op">=</span><span class="ss">f'PMF, $Binom(</span><span class="sc">{</span>mu_h0<span class="sc">}</span><span class="ss">, 30)$'</span>)</span>
<span id="lst-binom-ci-plot-10"><a href="#lst-binom-ci-plot-10" aria-hidden="true" tabindex="-1"></a>    c1, c2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-plot-11"><a href="#lst-binom-ci-plot-11" aria-hidden="true" tabindex="-1"></a>    crit_reg <span class="op">=</span> (x_grid <span class="op">&lt;=</span> c1) <span class="op">|</span> (x_grid <span class="op">&gt;=</span> c2)</span>
<span id="lst-binom-ci-plot-12"><a href="#lst-binom-ci-plot-12" aria-hidden="true" tabindex="-1"></a>    ax.bar(x_grid[crit_reg], probs[crit_reg], color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Критична область'</span>)</span>
<span id="lst-binom-ci-plot-13"><a href="#lst-binom-ci-plot-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-plot-14"><a href="#lst-binom-ci-plot-14" aria-hidden="true" tabindex="-1"></a>    is_rejection <span class="op">=</span> success_cnt <span class="op">&lt;=</span> c1 <span class="kw">or</span> success_cnt <span class="op">&gt;=</span> c2</span>
<span id="lst-binom-ci-plot-15"><a href="#lst-binom-ci-plot-15" aria-hidden="true" tabindex="-1"></a>    ax.axvline(success_cnt, ls<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'Q = </span><span class="sc">{</span>success_cnt<span class="sc">}</span><span class="ss"> '</span> <span class="op">+</span> (<span class="st">'відхилено'</span> <span class="cf">if</span> is_rejection <span class="cf">else</span> <span class="st">'не видхилено'</span>), color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="lst-binom-ci-plot-16"><a href="#lst-binom-ci-plot-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-plot-17"><a href="#lst-binom-ci-plot-17" aria-hidden="true" tabindex="-1"></a>    rejection_prob <span class="op">=</span> probs[crit_reg].<span class="bu">sum</span>()</span>
<span id="lst-binom-ci-plot-18"><a href="#lst-binom-ci-plot-18" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'$\mu = </span><span class="sc">{</span>mu_h0<span class="sc">}</span><span class="ss">$'</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="lst-binom-ci-plot-19"><a href="#lst-binom-ci-plot-19" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display">
<div id="fig-binom-ci" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-ci-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="power_files/figure-html/fig-binom-ci-output-1.png" width="658" height="802" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-ci-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;2.5: Довірчі інтервали для біноміального розподілу
</figcaption>
</figure>
</div>
</div>
</div>
<p>Видно, що зі зростанням <span class="math inline">\(\mu_0\)</span> гістограма зсувається вправо. І спочатку <span class="math inline">\(19\)</span> потрапляє в праву критичну область. Потім, починаючи з точки <span class="math inline">\(0.439\)</span>, значення <span class="math inline">\(19\)</span> вже опиняється поза критичною областю, і тільки з <span class="math inline">\(\mu_0 = 0.81\)</span> починає потрапляти в ліву критичну область.</p>
<p>Таким чином, ліва межа довірчого інтервалу — це перша точка, коли значення статистики перестало потрапляти до критичної області, а права межа - остання точка, коли значення не потрапляє до правої критичної області.</p>
</section>
<section id="односторонні-довірчі-інтервали" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="односторонні-довірчі-інтервали"><span class="header-section-number">2.5</span> Односторонні довірчі інтервали</h2>
<p>Насправді, двосторонній критерій потрібен вкрай рідко. Контролювати хибно похитивну помилку нам потрібно тільки для відхилень у бік, корисний для бізнесу. У випадку завдання з освітнім сервісом це отримання <em>більшої</em> конверсії в успіх.</p>
<p>Спробуємо скористатися одностороннім критерієм для побудови довірчого інтервалу.</p>
<div id="4b19b810" class="cell" data-execution_count="12">
<div id="lst-binom-ci-one-sided" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-one-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.7: Односторонні довірчі інтервали для біноміального розподілу
</figcaption>
<div aria-describedby="lst-binom-ci-one-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-one-sided"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-one-sided-1"><a href="#lst-binom-ci-one-sided-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_binom_criterion(n, mu<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.05</span>):</span>
<span id="lst-binom-ci-one-sided-2"><a href="#lst-binom-ci-one-sided-2" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span>n, p<span class="op">=</span>mu)</span>
<span id="lst-binom-ci-one-sided-3"><a href="#lst-binom-ci-one-sided-3" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> binom_h0.ppf(<span class="dv">1</span> <span class="op">-</span> alpha)</span>
<span id="lst-binom-ci-one-sided-4"><a href="#lst-binom-ci-one-sided-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> q <span class="op">+</span> <span class="dv">1</span></span>
<span id="lst-binom-ci-one-sided-5"><a href="#lst-binom-ci-one-sided-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-one-sided-6"><a href="#lst-binom-ci-one-sided-6" aria-hidden="true" tabindex="-1"></a>success_cnt <span class="op">=</span> <span class="dv">19</span></span>
<span id="lst-binom-ci-one-sided-7"><a href="#lst-binom-ci-one-sided-7" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="fl">1.001</span>, <span class="fl">0.001</span>)</span>
<span id="lst-binom-ci-one-sided-8"><a href="#lst-binom-ci-one-sided-8" aria-hidden="true" tabindex="-1"></a>mu_no_rejection <span class="op">=</span> []</span>
<span id="lst-binom-ci-one-sided-9"><a href="#lst-binom-ci-one-sided-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-one-sided-10"><a href="#lst-binom-ci-one-sided-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="lst-binom-ci-one-sided-11"><a href="#lst-binom-ci-one-sided-11" aria-hidden="true" tabindex="-1"></a>    crit_val <span class="op">=</span> make_binom_criterion(n<span class="op">=</span><span class="dv">30</span>, mu<span class="op">=</span>mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-one-sided-12"><a href="#lst-binom-ci-one-sided-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> success_cnt <span class="op">&lt;</span> crit_val:</span>
<span id="lst-binom-ci-one-sided-13"><a href="#lst-binom-ci-one-sided-13" aria-hidden="true" tabindex="-1"></a>        mu_no_rejection.append(mu_h0)</span>
<span id="lst-binom-ci-one-sided-14"><a href="#lst-binom-ci-one-sided-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-one-sided-15"><a href="#lst-binom-ci-one-sided-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'95% довірчий інтервал: [</span><span class="sc">{</span><span class="bu">min</span>(mu_no_rejection)<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(mu_no_rejection)<span class="sc">}</span><span class="ss">]'</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>95% довірчий інтервал: [0.467 - 1.0]</code></pre>
</div>
</div>
<p>Коли ми використовували двосторонній інтервал, ми отримали ліву межу <span class="math inline">\(0.439 &lt; 0.467\)</span>. Виходить, що односторонній інтервал з точки зору лівої межі дає нам більше інформації. При цьому з точки зору правої межі ми втрачаємо інформацію зовсім. Вона дорівнює 1 просто тому, що ймовірність не може бути більшою.</p>
<p>Насправді зазвичай на праву межу не дивляться під час аналізу, коли ми шукаємо позитивний ефект.</p>
<p>Припустимо, ми отримали не <span class="math inline">\(19\)</span> успіхів, а <span class="math inline">\(22\)</span>. Побудуємо 2 види інтервалів.</p>
<div id="b8d4536a" class="cell" data-execution_count="13">
<div id="lst-binom-ci-22" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.8: Двосторонній довірчий інтервал для <span class="math inline">\(22\)</span> успіхів
</figcaption>
<div aria-describedby="lst-binom-ci-22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-22-1"><a href="#lst-binom-ci-22-1" aria-hidden="true" tabindex="-1"></a>success_cnt <span class="op">=</span> <span class="dv">22</span></span>
<span id="lst-binom-ci-22-2"><a href="#lst-binom-ci-22-2" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="lst-binom-ci-22-3"><a href="#lst-binom-ci-22-3" aria-hidden="true" tabindex="-1"></a>mu_no_rejection <span class="op">=</span> []</span>
<span id="lst-binom-ci-22-4"><a href="#lst-binom-ci-22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-5"><a href="#lst-binom-ci-22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="lst-binom-ci-22-6"><a href="#lst-binom-ci-22-6" aria-hidden="true" tabindex="-1"></a>    c1, c2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-22-7"><a href="#lst-binom-ci-22-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> success_cnt <span class="op">&gt;</span> c1 <span class="kw">and</span> success_cnt <span class="op">&lt;</span> c2:</span>
<span id="lst-binom-ci-22-8"><a href="#lst-binom-ci-22-8" aria-hidden="true" tabindex="-1"></a>        mu_no_rejection.append(mu_h0)</span>
<span id="lst-binom-ci-22-9"><a href="#lst-binom-ci-22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-10"><a href="#lst-binom-ci-22-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Двосторонній 95% довірчий інтервал: [</span><span class="sc">{</span><span class="bu">min</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss">]'</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Двосторонній 95% довірчий інтервал: [0.542 - 0.877]</code></pre>
</div>
</div>
<div id="7d72986b" class="cell" data-execution_count="14">
<div id="lst-binom-ci-22-one-sided" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-22-one-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.9: Односторонній довірчий інтервал для <span class="math inline">\(22\)</span> успіхів
</figcaption>
<div aria-describedby="lst-binom-ci-22-one-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-22-one-sided"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-22-one-sided-1"><a href="#lst-binom-ci-22-one-sided-1" aria-hidden="true" tabindex="-1"></a>success_cnt <span class="op">=</span> <span class="dv">22</span></span>
<span id="lst-binom-ci-22-one-sided-2"><a href="#lst-binom-ci-22-one-sided-2" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="fl">1.001</span>, <span class="fl">0.001</span>)</span>
<span id="lst-binom-ci-22-one-sided-3"><a href="#lst-binom-ci-22-one-sided-3" aria-hidden="true" tabindex="-1"></a>mu_no_rejection <span class="op">=</span> []</span>
<span id="lst-binom-ci-22-one-sided-4"><a href="#lst-binom-ci-22-one-sided-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-one-sided-5"><a href="#lst-binom-ci-22-one-sided-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="lst-binom-ci-22-one-sided-6"><a href="#lst-binom-ci-22-one-sided-6" aria-hidden="true" tabindex="-1"></a>    crit_val <span class="op">=</span> make_binom_criterion(n<span class="op">=</span><span class="dv">30</span>, mu<span class="op">=</span>mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-22-one-sided-7"><a href="#lst-binom-ci-22-one-sided-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> success_cnt <span class="op">&lt;</span> crit_val:</span>
<span id="lst-binom-ci-22-one-sided-8"><a href="#lst-binom-ci-22-one-sided-8" aria-hidden="true" tabindex="-1"></a>        mu_no_rejection.append(mu_h0)</span>
<span id="lst-binom-ci-22-one-sided-9"><a href="#lst-binom-ci-22-one-sided-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-one-sided-10"><a href="#lst-binom-ci-22-one-sided-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Односторонній 95% довірчий інтервал: [</span><span class="sc">{</span><span class="bu">min</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss">]'</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Односторонній 95% довірчий інтервал: [0.571 - 1.000]</code></pre>
</div>
</div>
<p>За обома довірчими інтервалами ми робимо висновок, що конверсія значимо відрізняється від <span class="math inline">\(50\%\)</span>. Але односторонній інтервал дає кращу нижню оцінку на ймовірність успіху. Ми можемо зрозуміти, що наша конверсія більша за <span class="math inline">\(57\%\)</span>. А інформація з двостороннього інтервалу про те, що ймовірність менша за <span class="math inline">\(88\%\)</span> не додає нам користі.</p>
<p>Навіщо ж ми тоді взагалі використовуємо двосторонній інтервал? Щоб це зрозуміти, подивимося, як виглядають візуально межі для одностороннього інтервалу.</p>
<div id="cell-fig-binom-ci-22" class="cell" data-execution_count="15">
<div id="lst-binom-ci-22-plot" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-22-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.10: Односторонній довірчий інтервал для <span class="math inline">\(22\)</span> успіхів
</figcaption>
<div aria-describedby="lst-binom-ci-22-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-22-plot"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-22-plot-1"><a href="#lst-binom-ci-22-plot-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">10</span>))</span>
<span id="lst-binom-ci-22-plot-2"><a href="#lst-binom-ci-22-plot-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-plot-3"><a href="#lst-binom-ci-22-plot-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0, ax <span class="kw">in</span> <span class="bu">zip</span>(mus_h0, axes.flatten()):</span>
<span id="lst-binom-ci-22-plot-4"><a href="#lst-binom-ci-22-plot-4" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span>mu_h0)</span>
<span id="lst-binom-ci-22-plot-5"><a href="#lst-binom-ci-22-plot-5" aria-hidden="true" tabindex="-1"></a>    probs <span class="op">=</span> binom_h0.pmf(x_grid)</span>
<span id="lst-binom-ci-22-plot-6"><a href="#lst-binom-ci-22-plot-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-plot-7"><a href="#lst-binom-ci-22-plot-7" aria-hidden="true" tabindex="-1"></a>    ax.bar(x_grid, probs, color<span class="op">=</span>turquoise, label<span class="op">=</span><span class="ss">f'PMF, $Binom(</span><span class="sc">{</span>mu_h0<span class="sc">}</span><span class="ss">, 30)$'</span>)</span>
<span id="lst-binom-ci-22-plot-8"><a href="#lst-binom-ci-22-plot-8" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> make_binom_criterion(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-22-plot-9"><a href="#lst-binom-ci-22-plot-9" aria-hidden="true" tabindex="-1"></a>    crit_reg <span class="op">=</span> (x_grid <span class="op">&gt;=</span> c)</span>
<span id="lst-binom-ci-22-plot-10"><a href="#lst-binom-ci-22-plot-10" aria-hidden="true" tabindex="-1"></a>    ax.bar(x_grid[crit_reg], probs[crit_reg], color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Критична область'</span>)</span>
<span id="lst-binom-ci-22-plot-11"><a href="#lst-binom-ci-22-plot-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-plot-12"><a href="#lst-binom-ci-22-plot-12" aria-hidden="true" tabindex="-1"></a>    is_rejection <span class="op">=</span> success_cnt <span class="op">&gt;=</span> c</span>
<span id="lst-binom-ci-22-plot-13"><a href="#lst-binom-ci-22-plot-13" aria-hidden="true" tabindex="-1"></a>    ax.axvline(success_cnt, ls<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'Q = </span><span class="sc">{</span>success_cnt<span class="sc">}</span><span class="ss"> '</span> <span class="op">+</span> (<span class="st">'відхилено'</span> <span class="cf">if</span> is_rejection <span class="cf">else</span> <span class="st">'не відхилено'</span>), color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="lst-binom-ci-22-plot-14"><a href="#lst-binom-ci-22-plot-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-plot-15"><a href="#lst-binom-ci-22-plot-15" aria-hidden="true" tabindex="-1"></a>    rejection_prob <span class="op">=</span> probs[crit_reg].<span class="bu">sum</span>()</span>
<span id="lst-binom-ci-22-plot-16"><a href="#lst-binom-ci-22-plot-16" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'$\mu = </span><span class="sc">{</span>mu_h0<span class="sc">}</span><span class="ss">$'</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="lst-binom-ci-22-plot-17"><a href="#lst-binom-ci-22-plot-17" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display">
<div id="fig-binom-ci-22" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-ci-22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="power_files/figure-html/fig-binom-ci-22-output-1.png" width="658" height="802" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-ci-22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;2.6: Односторонній довірчий інтервал для <span class="math inline">\(22\)</span> успіхів
</figcaption>
</figure>
</div>
</div>
</div>
<p>Порівняно з <a href="#fig-binom-ci" class="quarto-xref">Рисунок&nbsp;<span>2.5</span></a> ми бачимо, що права критична область стала більшою через те, що там тепер знаходиться не <span class="math inline">\(2.5\%\)</span>, а <span class="math inline">\(5\%\)</span> від усіх значень. При цьому лівої критичної області просто не існує, тому за великих <span class="math inline">\(\mu\)</span> не відбувається потрапляння <span class="math inline">\(19\)</span> до неї, а значить ми не відкидаємо гіпотезу.</p>
<p>Зауважимо, що якби ми будували двосторонній інтервал, але з удвічі більшою <span class="math inline">\(\alpha\)</span>, потрапляння в праву критичну область траплялися б за тих самих <span class="math inline">\(\mu\)</span>, що й в односторонньому критерії. Тому часто для пошуку односторонньої межі будують двосторонній довірчий інтервал із більшою <span class="math inline">\(\alpha\)</span>, ігноруючи при цьому праву межу. Це зручно, оскільки можна користуватися тільки однією функцією для критерію.</p>
<p>Перевіримо, що вийде за <span class="math inline">\(\alpha = 0.1\)</span>.</p>
<div id="a3be2a66" class="cell" data-execution_count="16">
<div id="lst-binom-ci-22-2alpha" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-22-2alpha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.11: Двосторонній довірчий інтервал для <span class="math inline">\(22\)</span> успіхів з <span class="math inline">\(\alpha = 0.1\)</span>
</figcaption>
<div aria-describedby="lst-binom-ci-22-2alpha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-22-2alpha"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-22-2alpha-1"><a href="#lst-binom-ci-22-2alpha-1" aria-hidden="true" tabindex="-1"></a>success_cnt <span class="op">=</span> <span class="dv">19</span></span>
<span id="lst-binom-ci-22-2alpha-2"><a href="#lst-binom-ci-22-2alpha-2" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="lst-binom-ci-22-2alpha-3"><a href="#lst-binom-ci-22-2alpha-3" aria-hidden="true" tabindex="-1"></a>mu_no_rejection <span class="op">=</span> []</span>
<span id="lst-binom-ci-22-2alpha-4"><a href="#lst-binom-ci-22-2alpha-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-2alpha-5"><a href="#lst-binom-ci-22-2alpha-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="lst-binom-ci-22-2alpha-6"><a href="#lst-binom-ci-22-2alpha-6" aria-hidden="true" tabindex="-1"></a>    c1, c2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="lst-binom-ci-22-2alpha-7"><a href="#lst-binom-ci-22-2alpha-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> success_cnt <span class="op">&gt;</span> c1 <span class="kw">and</span> success_cnt <span class="op">&lt;</span> c2:</span>
<span id="lst-binom-ci-22-2alpha-8"><a href="#lst-binom-ci-22-2alpha-8" aria-hidden="true" tabindex="-1"></a>        mu_no_rejection.append(mu_h0)</span>
<span id="lst-binom-ci-22-2alpha-9"><a href="#lst-binom-ci-22-2alpha-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-2alpha-10"><a href="#lst-binom-ci-22-2alpha-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'95% довірчий інтервал: [</span><span class="sc">{</span><span class="bu">min</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss">]'</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>95% довірчий інтервал: [0.467 - 0.778]</code></pre>
</div>
</div>
<p>Бачимо, що отримали таку саму ліву межу, як і в односторонньому інтервалі.</p>
</section>
<section id="властивості-довірчих-інтервалів" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="властивості-довірчих-інтервалів"><span class="header-section-number">2.6</span> Властивості довірчих інтервалів</h2>
<p>Згадаймо визначення довірчого інтервалу.</p>
<p>Нехай є критерій <span class="math inline">\(S = \{Q(\xi) \leqslant C\}\)</span> рівня значущості <span class="math inline">\(\alpha\)</span> для перевірки гіпотези <span class="math inline">\({H}_0: \mu = \mu_0\)</span>, <span class="math inline">\(Q\)</span> — статистика критерію, а <span class="math inline">\(q\)</span> — її реалізація на конкретній вибірці <span class="math inline">\(\xi = \xi_1, \dots, \xi_n\)</span>. Тоді <strong>довірчим інтервалом</strong> називається множина таких <span class="math inline">\(\mu_0\)</span>, на яких критерій <span class="math inline">\(S\)</span> не відкидає гіпотезу <span class="math inline">\({H}_0: \mu = \mu_0\)</span>.</p>
<p>Процедура підрахунку інтервалу — це довгий перебір значень із деяким кроком. Але це все ще залишається деякою функцією від вибірки, тобто <em>статистикою</em> й випадковою величиною, причому її розподіл залежить від статистики <span class="math inline">\(Q\)</span>, а отже, і від початкової вибірки, та від параметра <span class="math inline">\(\mu\)</span> у генеральній сукупності.</p>
<p>Позначимо межі інтервалу за <span class="math inline">\(\mathcal{L}(Q), \mathcal{R}(Q)\)</span> — статистики критерію, які відповідають лівій та правій межі інтервалу.</p>
<section id="ймовірність-попадання-в-інтервал" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="ймовірність-попадання-в-інтервал"><span class="header-section-number">2.6.1</span> Ймовірність попадання в інтервал</h3>
<p>Яким би не було істинне значення <span class="math inline">\(\mu = \mu_0\)</span>, ймовірність того, що воно перебуває між <span class="math inline">\(\mathcal{L}(Q)\)</span> та <span class="math inline">\(\mathcal{R}(Q)\)</span>, не нижча, ніж <span class="math inline">\(1 - \alpha\)</span>. Значення <span class="math inline">\(1 - \alpha\)</span> називається <strong>рівнем довіри</strong> довірчого інтервалу.</p>
<p><span id="eq-ci-1"><span class="math display">\[
P(\mathcal{L}(Q) &lt; \mu_0 &lt; \mathcal{R}(Q)) \geqslant 1 - \alpha
\tag{2.2}\]</span></span></p>
<p>Важливо, що випадковість тут прихована саме в <span class="math inline">\(\mathcal{L}\)</span> і <span class="math inline">\(\mathcal{R}\)</span>, а не в <span class="math inline">\(\mu_0\)</span>. Параметр <span class="math inline">\(\mu_0\)</span> невідомий, але ми припускаємо його константним і не випадковим.</p>
<p>Перевіримо справедливість цієї властивості. Для цього зафіксуємо <span class="math inline">\(\mu_0\)</span> й проведемо множину експериментів:</p>
<ul>
<li>Генеруємо вибірку з розподілу з параметром <span class="math inline">\(\mu_0\)</span>.</li>
<li>Обчислюємо статистику <span class="math inline">\(q\)</span>.</li>
<li>Рахуємо довірчий інтервал для <span class="math inline">\(\alpha = 0.05\)</span>.</li>
</ul>
<p>Перевіряємо, що частка випадків, коли параметр <span class="math inline">\(\mu_0\)</span> опинився всередині інтервалу, хоча б <span class="math inline">\(95\%\)</span></p>
<div id="lst-binom-ci-1" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.12: Перевірка властивості довірчого інтервалу.
</figcaption>
<div aria-describedby="lst-binom-ci-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="2ac54c24" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_binomial_confint(n, alpha, q):</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="fl">1.1</span>, <span class="fl">0.1</span>) <span class="co"># np.arange(0, 1.001, 0.001)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    mu_no_rejection <span class="op">=</span> []</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        c1, c2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> q <span class="op">&gt;</span> c1 <span class="kw">and</span> q <span class="op">&lt;</span> c2:</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>            mu_no_rejection.append(mu_h0)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">min</span>(mu_no_rejection), <span class="bu">max</span>(mu_no_rejection)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>N_EXPERIMENTS <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>SAMPLE_SIZE <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>latent_mu <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>binom_true <span class="op">=</span> binom(n<span class="op">=</span>SAMPLE_SIZE, p<span class="op">=</span>latent_mu)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>confint_fail_cases <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N_EXPERIMENTS):</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> binom_true.rvs()</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    L, R <span class="op">=</span> my_binomial_confint(n<span class="op">=</span>SAMPLE_SIZE, alpha<span class="op">=</span><span class="fl">0.05</span>, q<span class="op">=</span>q)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> L <span class="op">&lt;</span> latent_mu <span class="op">&lt;</span> R:</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        confint_fail_cases <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>success_cases <span class="op">=</span> <span class="bu">round</span>(<span class="dv">100</span> <span class="op">*</span> (N_EXPERIMENTS <span class="op">-</span> confint_fail_cases) <span class="op">/</span> N_EXPERIMENTS, <span class="dv">2</span>)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Відсоток успішних випадків: </span><span class="sc">{</span>success_cases<span class="sc">}</span><span class="ss">%"</span>)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>end_time <span class="op">=</span> time.time()</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Час виконання: </span><span class="sc">{</span>end_time <span class="op">-</span> start_time<span class="sc">:.4f}</span><span class="ss"> секунди"</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Відсоток успішних випадків: 61.4%
Час виконання: 4.2039 секунди</code></pre>
</div>
</div>
</div>
</figure>
</div>
<p>Зазначимо, що цей код працював понад 5 хвилин. Це через те, що під час кожного експерименту потрібно побудувати довірчий інтервал, а значить перевірити 1000 можливих параметрів <span class="math inline">\(\mu_0\)</span>.</p>
<p>Бачимо, що властивість виконалася. Ми очікували хоча б <span class="math inline">\(95\%\)</span> влучень, отримали навіть <span class="math inline">\(61.4\%\)</span>. Насправді це значно більше, ніж ми очікували. Це відбувається через дискретність розподілу. З тієї ж причини під час пошуку критичної області ми не могли вибрати стовпці із сумарною висотою рівно <span class="math inline">\(\alpha\)</span>.</p>
<section id="доведення" class="level4" data-number="2.6.1.1">
<h4 data-number="2.6.1.1" class="anchored" data-anchor-id="доведення"><span class="header-section-number">2.6.1.1</span> Доведення</h4>
<p>Під час формулювання властивості ми припускаємо, що є деяка <span class="math inline">\(\mu_0\)</span> — ймовірність успіху в генеральній сукупності. Коли ми проводимо штучний експеримент, ми фіксуємо її й можемо вважати істинною <span class="math inline">\(\mu\)</span>.</p>
<p>Щоразу ми генеруємо <span class="math inline">\(Q \sim Binom(\mu_0, 30)\)</span> й перевіряємо, чи потрапила <span class="math inline">\(\mu_0\)</span> у довірчий інтервал. Намалюємо розподіл статистики <span class="math inline">\(Q\)</span>, який уже нам знайомий. Намалюємо й область ймовірності <span class="math inline">\(\leqslant \alpha\)</span>, як ми робили це раніше.</p>
<div id="cell-fig-binom-ci-1" class="cell" data-execution_count="18">
<div id="lst-binom-ci-1-plot" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-1-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.13: Розподіл статистики при істинній ймовірності успіху
</figcaption>
<div aria-describedby="lst-binom-ci-1-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-1-plot"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-1-plot-1"><a href="#lst-binom-ci-1-plot-1" aria-hidden="true" tabindex="-1"></a>mu0 <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="lst-binom-ci-1-plot-2"><a href="#lst-binom-ci-1-plot-2" aria-hidden="true" tabindex="-1"></a>binom_mu0 <span class="op">=</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span>mu0)</span>
<span id="lst-binom-ci-1-plot-3"><a href="#lst-binom-ci-1-plot-3" aria-hidden="true" tabindex="-1"></a>probs <span class="op">=</span> binom_mu0.pmf(x_grid)</span>
<span id="lst-binom-ci-1-plot-4"><a href="#lst-binom-ci-1-plot-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-1-plot-5"><a href="#lst-binom-ci-1-plot-5" aria-hidden="true" tabindex="-1"></a>plt.bar(x_grid, probs, color<span class="op">=</span>turquoise, label<span class="op">=</span><span class="ss">f'PMF, $Binom(</span><span class="sc">{</span>mu0<span class="sc">}</span><span class="ss">, 30)$'</span>)</span>
<span id="lst-binom-ci-1-plot-6"><a href="#lst-binom-ci-1-plot-6" aria-hidden="true" tabindex="-1"></a>c1, c2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, mu0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-1-plot-7"><a href="#lst-binom-ci-1-plot-7" aria-hidden="true" tabindex="-1"></a>crit_reg <span class="op">=</span> (x_grid <span class="op">&gt;=</span> c2) <span class="op">|</span> (x_grid <span class="op">&lt;=</span> c1)</span>
<span id="lst-binom-ci-1-plot-8"><a href="#lst-binom-ci-1-plot-8" aria-hidden="true" tabindex="-1"></a>plt.bar(x_grid[crit_reg], probs[crit_reg], color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Критична область'</span>)</span>
<span id="lst-binom-ci-1-plot-9"><a href="#lst-binom-ci-1-plot-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="lst-binom-ci-1-plot-10"><a href="#lst-binom-ci-1-plot-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display">
<div id="fig-binom-ci-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-ci-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="power_files/figure-html/fig-binom-ci-1-output-1.png" width="652" height="304" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-ci-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;2.7: Розподіл статистики при істинній ймовірності успіху
</figcaption>
</figure>
</div>
</div>
</div>
<p>Нехай реалізувалося значення статистики <span class="math inline">\(q\)</span>. За такою вибіркою можна побудувати довірчий інтервал на <span class="math inline">\(\mu\)</span>. Він буде якось розташований, але зараз нас цікавить, чи потрапить у нього <span class="math inline">\(\mu_0\)</span>. За визначенням потрапляння в інтервал відбудеться, якщо не відкидається гіпотеза <span class="math inline">\({H}_0:\ \mu = \mu_0\)</span>. Але тоді за справедливості <span class="math inline">\({H}_0\)</span> статистика має той розподіл, що і на малюнку. І гіпотеза відкидається тільки в разі потрапляння в критичну область, а це трапляється з ймовірністю <span class="math inline">\(\leqslant \alpha\)</span>.</p>
<p>Отже, з ймовірністю хоча б <span class="math inline">\(1 - \alpha\)</span> <span class="math inline">\(\mu_0\)</span> перебуватиме в довірчому інтервалі.</p>
<p>Часто так й вводять визначення довірчого інтервалу. Для вибірки <span class="math inline">\(\xi_1, \dots, \xi_n\)</span> — це така пара статистик <span class="math inline">\(\mathcal{L}(\xi)\)</span> і <span class="math inline">\(\mathcal{R}(\xi)\)</span>, що хоч яким би не було <span class="math inline">\(\mu_0\)</span>,</p>
<p><span id="eq-ci-2"><span class="math display">\[
P(L(\xi) &lt; \mu_0 &lt; R(\xi)) \geqslant 1 - \alpha
\tag{2.3}\]</span></span></p>
<p>де <span class="math inline">\(L(\xi)\)</span> і <span class="math inline">\(R(\xi)\)</span> — статистики, що залежать від вибірки. Знову звертаємо увагу, що випадковість тут прихована не в параметрі <span class="math inline">\(\mu_0\)</span>, а в статистиках від вибірки.</p>
</section>
</section>
<section id="довірчий-інтервал-вілсона" class="level3" data-number="2.6.2">
<h3 data-number="2.6.2" class="anchored" data-anchor-id="довірчий-інтервал-вілсона"><span class="header-section-number">2.6.2</span> Довірчий інтервал Вілсона</h3>
<p>Розглянутий зараз алгоритм побудови довірчого інтервалу працює занадто довго. У Python є функції, які дозволяють швидше розрахувати інтервал. Наприклад, можна скористатися методом Вілсона і функцією <code>proportion_confint</code>.</p>
<p>Повторимо експерименти з новим типом довірчого інтервалу, тут можемо дозволити більше реалізацій вибірки, оскільки інтервал рахується недовго.</p>
<div id="b51cb71d" class="cell" data-execution_count="19">
<div id="lst-binom-ci-2" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.14: Довірчий інтервал Вілсона
</figcaption>
<div aria-describedby="lst-binom-ci-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-2-1"><a href="#lst-binom-ci-2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.proportion <span class="im">import</span> proportion_confint</span>
<span id="lst-binom-ci-2-2"><a href="#lst-binom-ci-2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-2-3"><a href="#lst-binom-ci-2-3" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="lst-binom-ci-2-4"><a href="#lst-binom-ci-2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-2-5"><a href="#lst-binom-ci-2-5" aria-hidden="true" tabindex="-1"></a>N_EXPERIMENTS <span class="op">=</span> <span class="dv">1000</span></span>
<span id="lst-binom-ci-2-6"><a href="#lst-binom-ci-2-6" aria-hidden="true" tabindex="-1"></a>SAMPLE_SIZE <span class="op">=</span> <span class="dv">30</span></span>
<span id="lst-binom-ci-2-7"><a href="#lst-binom-ci-2-7" aria-hidden="true" tabindex="-1"></a>latent_mu <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="lst-binom-ci-2-8"><a href="#lst-binom-ci-2-8" aria-hidden="true" tabindex="-1"></a>binom_true <span class="op">=</span> binom(n<span class="op">=</span>SAMPLE_SIZE, p<span class="op">=</span>latent_mu)</span>
<span id="lst-binom-ci-2-9"><a href="#lst-binom-ci-2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-2-10"><a href="#lst-binom-ci-2-10" aria-hidden="true" tabindex="-1"></a>confint_fail_cases <span class="op">=</span> <span class="dv">0</span></span>
<span id="lst-binom-ci-2-11"><a href="#lst-binom-ci-2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-2-12"><a href="#lst-binom-ci-2-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N_EXPERIMENTS):</span>
<span id="lst-binom-ci-2-13"><a href="#lst-binom-ci-2-13" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> binom_true.rvs()  </span>
<span id="lst-binom-ci-2-14"><a href="#lst-binom-ci-2-14" aria-hidden="true" tabindex="-1"></a>    L, R <span class="op">=</span> proportion_confint(</span>
<span id="lst-binom-ci-2-15"><a href="#lst-binom-ci-2-15" aria-hidden="true" tabindex="-1"></a>        count<span class="op">=</span>q,</span>
<span id="lst-binom-ci-2-16"><a href="#lst-binom-ci-2-16" aria-hidden="true" tabindex="-1"></a>        nobs<span class="op">=</span>SAMPLE_SIZE,</span>
<span id="lst-binom-ci-2-17"><a href="#lst-binom-ci-2-17" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.05</span>,</span>
<span id="lst-binom-ci-2-18"><a href="#lst-binom-ci-2-18" aria-hidden="true" tabindex="-1"></a>        method<span class="op">=</span><span class="st">'wilson'</span></span>
<span id="lst-binom-ci-2-19"><a href="#lst-binom-ci-2-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="lst-binom-ci-2-20"><a href="#lst-binom-ci-2-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> L <span class="op">&lt;</span> latent_mu <span class="op">&lt;</span> R:</span>
<span id="lst-binom-ci-2-21"><a href="#lst-binom-ci-2-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="lst-binom-ci-2-22"><a href="#lst-binom-ci-2-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="lst-binom-ci-2-23"><a href="#lst-binom-ci-2-23" aria-hidden="true" tabindex="-1"></a>        confint_fail_cases <span class="op">+=</span> <span class="dv">1</span></span>
<span id="lst-binom-ci-2-24"><a href="#lst-binom-ci-2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-2-25"><a href="#lst-binom-ci-2-25" aria-hidden="true" tabindex="-1"></a>success_cases <span class="op">=</span> <span class="bu">round</span>(<span class="dv">100</span> <span class="op">*</span> (N_EXPERIMENTS <span class="op">-</span> confint_fail_cases) <span class="op">/</span> N_EXPERIMENTS, <span class="dv">2</span>)</span>
<span id="lst-binom-ci-2-26"><a href="#lst-binom-ci-2-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Відсоток успішних випадків: </span><span class="sc">{</span>success_cases<span class="sc">}</span><span class="ss">%"</span>)</span>
<span id="lst-binom-ci-2-27"><a href="#lst-binom-ci-2-27" aria-hidden="true" tabindex="-1"></a>end_time <span class="op">=</span> time.time()</span>
<span id="lst-binom-ci-2-28"><a href="#lst-binom-ci-2-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Час виконання: </span><span class="sc">{</span>end_time <span class="op">-</span> start_time<span class="sc">:.4f}</span><span class="ss"> секунди"</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Відсоток успішних випадків: 96.6%
Час виконання: 0.2021 секунди</code></pre>
</div>
</div>
<p>Зауважимо, що наше <span class="math inline">\(\mu\)</span> може знаходитись в довірчому інтервалі менше, ніж у <span class="math inline">\(95\%\)</span> випадків. Це відбувається через те, що швидкі методи працюють наближено, оцінюючи розподіл статистики при збільшенні розміру вибірки. Чим розмір вибірки більший, тим ближчим буде інтервал до <span class="math inline">\(95\%\)</span>-ного.</p>
<p>Залежність частки успішних влучень <span class="math inline">\(\mu\)</span> у довірчий інтервал від розміру вибірки зобразимо на <a href="#fig-binom-ci-2" class="quarto-xref">Рисунок&nbsp;<span>2.8</span></a>.</p>
<div id="cell-fig-binom-ci-2" class="cell" data-execution_count="20">
<div id="lst-binom-ci-2-plot" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-2-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;2.15: Залежність частки успішних влучень <span class="math inline">\(\mu\)</span> у довірчий інтервал від розміру вибірки
</figcaption>
<div aria-describedby="lst-binom-ci-2-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-2-plot"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-2-plot-1"><a href="#lst-binom-ci-2-plot-1" aria-hidden="true" tabindex="-1"></a>n_grid <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="dv">1000</span>, <span class="dv">25</span>).tolist()</span>
<span id="lst-binom-ci-2-plot-2"><a href="#lst-binom-ci-2-plot-2" aria-hidden="true" tabindex="-1"></a>interval_success_rate <span class="op">=</span> []</span>
<span id="lst-binom-ci-2-plot-3"><a href="#lst-binom-ci-2-plot-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-2-plot-4"><a href="#lst-binom-ci-2-plot-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> n_grid:</span>
<span id="lst-binom-ci-2-plot-5"><a href="#lst-binom-ci-2-plot-5" aria-hidden="true" tabindex="-1"></a>    confint_fail_cases <span class="op">=</span> <span class="dv">0</span></span>
<span id="lst-binom-ci-2-plot-6"><a href="#lst-binom-ci-2-plot-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(N_EXPERIMENTS):</span>
<span id="lst-binom-ci-2-plot-7"><a href="#lst-binom-ci-2-plot-7" aria-hidden="true" tabindex="-1"></a>        binom_true <span class="op">=</span> binom(n<span class="op">=</span>n, p<span class="op">=</span>latent_mu)</span>
<span id="lst-binom-ci-2-plot-8"><a href="#lst-binom-ci-2-plot-8" aria-hidden="true" tabindex="-1"></a>        q <span class="op">=</span> binom_true.rvs()  </span>
<span id="lst-binom-ci-2-plot-9"><a href="#lst-binom-ci-2-plot-9" aria-hidden="true" tabindex="-1"></a>        L, R <span class="op">=</span> proportion_confint(</span>
<span id="lst-binom-ci-2-plot-10"><a href="#lst-binom-ci-2-plot-10" aria-hidden="true" tabindex="-1"></a>            count<span class="op">=</span>q,</span>
<span id="lst-binom-ci-2-plot-11"><a href="#lst-binom-ci-2-plot-11" aria-hidden="true" tabindex="-1"></a>            nobs<span class="op">=</span>n,</span>
<span id="lst-binom-ci-2-plot-12"><a href="#lst-binom-ci-2-plot-12" aria-hidden="true" tabindex="-1"></a>            alpha<span class="op">=</span><span class="fl">0.05</span>,</span>
<span id="lst-binom-ci-2-plot-13"><a href="#lst-binom-ci-2-plot-13" aria-hidden="true" tabindex="-1"></a>            method<span class="op">=</span><span class="st">'wilson'</span></span>
<span id="lst-binom-ci-2-plot-14"><a href="#lst-binom-ci-2-plot-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="lst-binom-ci-2-plot-15"><a href="#lst-binom-ci-2-plot-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> L <span class="op">&lt;</span> latent_mu <span class="op">&lt;</span> R:</span>
<span id="lst-binom-ci-2-plot-16"><a href="#lst-binom-ci-2-plot-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">pass</span></span>
<span id="lst-binom-ci-2-plot-17"><a href="#lst-binom-ci-2-plot-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="lst-binom-ci-2-plot-18"><a href="#lst-binom-ci-2-plot-18" aria-hidden="true" tabindex="-1"></a>            confint_fail_cases <span class="op">+=</span> <span class="dv">1</span></span>
<span id="lst-binom-ci-2-plot-19"><a href="#lst-binom-ci-2-plot-19" aria-hidden="true" tabindex="-1"></a>    interval_success_rate.append(<span class="dv">1</span> <span class="op">-</span> confint_fail_cases <span class="op">/</span> N_EXPERIMENTS)</span>
<span id="lst-binom-ci-2-plot-20"><a href="#lst-binom-ci-2-plot-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-2-plot-21"><a href="#lst-binom-ci-2-plot-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Розмір вибірки $n$'</span>)</span>
<span id="lst-binom-ci-2-plot-22"><a href="#lst-binom-ci-2-plot-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Частка успішних влучень'</span>)</span>
<span id="lst-binom-ci-2-plot-23"><a href="#lst-binom-ci-2-plot-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-2-plot-24"><a href="#lst-binom-ci-2-plot-24" aria-hidden="true" tabindex="-1"></a>plt.plot(n_grid, interval_success_rate, label<span class="op">=</span><span class="st">'Частка успішних влучень'</span>, color<span class="op">=</span>turquoise)</span>
<span id="lst-binom-ci-2-plot-25"><a href="#lst-binom-ci-2-plot-25" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="fl">0.95</span>, ls<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Желаемая успешность'</span>, color<span class="op">=</span>red_pink)</span>
<span id="lst-binom-ci-2-plot-26"><a href="#lst-binom-ci-2-plot-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-2-plot-27"><a href="#lst-binom-ci-2-plot-27" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="lst-binom-ci-2-plot-28"><a href="#lst-binom-ci-2-plot-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display">
<div id="fig-binom-ci-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-ci-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="power_files/figure-html/fig-binom-ci-2-output-1.png" width="672" height="326" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-ci-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;2.8: Залежність частки успішних влучень <span class="math inline">\(\mu\)</span> у довірчий інтервал від розміру вибірки
</figcaption>
</figure>
</div>
</div>
</div>
<p>Видно, що на будь-якому розмірі вибірки під час використання інтервалу Вілсона можна отримати менше <span class="math inline">\(95\%\)</span> влучень, але що більший розмір вибірки, то менше графік відхиляється від <span class="math inline">\(95\%\)</span>.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопійовано!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопійовано!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./binom.html" class="pagination-link" aria-label="Біноміальний критерій">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Біноміальний критерій</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./z-test.html" class="pagination-link" aria-label="$Z$-критерій Фішера">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><span class="math inline">\(Z\)</span>-критерій Фішера</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Прикладний статистичний аналіз</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Ця книга створена за допомогою <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>