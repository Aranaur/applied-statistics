<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>1&nbsp; Біноміальний критерій – Прикладний статистичний аналіз</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./z-test.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6c380caa1d326ca7d97976c903cdd929.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Не має результатів",
    "search-matching-documents-text": "Результати пошуку",
    "search-copy-link-title": "Скопіювати посилання",
    "search-hide-matches-text": "Сховати додаткові результати",
    "search-more-match-text": "додатковий результат у цьому документі",
    "search-more-matches-text": "додаткових результатів у цьому документі",
    "search-clear-button-title": "Очистити",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Відмінити",
    "search-submit-button-title": "Надіслати",
    "search-label": "Пошук"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключити бокову панель навігації" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./binom.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Біноміальний критерій</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Переключити бокову панель навігації" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Пошук" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Прикладний статистичний аналіз</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Переключити режим читання">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Пошук"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Передмова</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Вступ</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./binom.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Біноміальний критерій</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./z-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><span class="math inline">\(Z\)</span>-критерій Фішера</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t-test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><span class="math inline">\(t\)</span>-критерій Стьюдента</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./monte-carlo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Монте-Карло в задачах статистики</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Підсумки</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Зміст</h2>
   
  <ul>
  <li><a href="#генеральна-сукупність-та-вибірка" id="toc-генеральна-сукупність-та-вибірка" class="nav-link active" data-scroll-target="#генеральна-сукупність-та-вибірка"><span class="header-section-number">1.1</span> Генеральна сукупність та вибірка</a></li>
  <li><a href="#статистичні-гіпотези" id="toc-статистичні-гіпотези" class="nav-link" data-scroll-target="#статистичні-гіпотези"><span class="header-section-number">1.2</span> Статистичні гіпотези</a>
  <ul class="collapse">
  <li><a href="#постановка-задачі" id="toc-постановка-задачі" class="nav-link" data-scroll-target="#постановка-задачі"><span class="header-section-number">1.2.1</span> Постановка задачі</a></li>
  <li><a href="#критерій" id="toc-критерій" class="nav-link" data-scroll-target="#критерій"><span class="header-section-number">1.2.2</span> Критерій</a></li>
  <li><a href="#критична-область" id="toc-критична-область" class="nav-link" data-scroll-target="#критична-область"><span class="header-section-number">1.2.3</span> Критична область</a></li>
  <li><a href="#обчислення-fpr" id="toc-обчислення-fpr" class="nav-link" data-scroll-target="#обчислення-fpr"><span class="header-section-number">1.2.4</span> Обчислення FPR</a></li>
  </ul></li>
  <li><a href="#статистичні-функції-в-python" id="toc-статистичні-функції-в-python" class="nav-link" data-scroll-target="#статистичні-функції-в-python"><span class="header-section-number">1.3</span> Статистичні функції в Python</a>
  <ul class="collapse">
  <li><a href="#біноміальний-розподіл" id="toc-біноміальний-розподіл" class="nav-link" data-scroll-target="#біноміальний-розподіл"><span class="header-section-number">1.3.1</span> Біноміальний розподіл</a></li>
  <li><a href="#функція-ймовірностей" id="toc-функція-ймовірностей" class="nav-link" data-scroll-target="#функція-ймовірностей"><span class="header-section-number">1.3.2</span> Функція ймовірностей</a></li>
  <li><a href="#кумулятивна-функція-розподілу" id="toc-кумулятивна-функція-розподілу" class="nav-link" data-scroll-target="#кумулятивна-функція-розподілу"><span class="header-section-number">1.3.3</span> Кумулятивна функція розподілу</a></li>
  <li><a href="#квантиль" id="toc-квантиль" class="nav-link" data-scroll-target="#квантиль"><span class="header-section-number">1.3.4</span> Квантиль</a></li>
  </ul></li>
  <li><a href="#p-значення" id="toc-p-значення" class="nav-link" data-scroll-target="#p-значення"><span class="header-section-number">1.4</span> <span class="math inline">\(p\)</span>-значення</a>
  <ul class="collapse">
  <li><a href="#більш-екстремальні-значення" id="toc-більш-екстремальні-значення" class="nav-link" data-scroll-target="#більш-екстремальні-значення"><span class="header-section-number">1.4.1</span> Більш екстремальні значення</a></li>
  <li><a href="#p-значення-1" id="toc-p-значення-1" class="nav-link" data-scroll-target="#p-значення-1"><span class="header-section-number">1.4.2</span> <span class="math inline">\(p\)</span>-значення</a></li>
  </ul></li>
  <li><a href="#двосторонні-критерії" id="toc-двосторонні-критерії" class="nav-link" data-scroll-target="#двосторонні-критерії"><span class="header-section-number">1.5</span> Двосторонні критерії</a>
  <ul class="collapse">
  <li><a href="#як-вибрати-критичну-область" id="toc-як-вибрати-критичну-область" class="nav-link" data-scroll-target="#як-вибрати-критичну-область"><span class="header-section-number">1.5.1</span> Як вибрати критичну область</a></li>
  <li><a href="#як-знайти-p-значення" id="toc-як-знайти-p-значення" class="nav-link" data-scroll-target="#як-знайти-p-значення"><span class="header-section-number">1.5.2</span> Як знайти <span class="math inline">\(p\)</span>-значення</a></li>
  <li><a href="#випадок-із-несиметричним-розподілом" id="toc-випадок-із-несиметричним-розподілом" class="nav-link" data-scroll-target="#випадок-із-несиметричним-розподілом"><span class="header-section-number">1.5.3</span> Випадок із несиметричним розподілом</a></li>
  <li><a href="#p-значення-для-несиметричного-розподілу" id="toc-p-значення-для-несиметричного-розподілу" class="nav-link" data-scroll-target="#p-значення-для-несиметричного-розподілу"><span class="header-section-number">1.5.4</span> <span class="math inline">\(p\)</span>-значення для несиметричного розподілу</a></li>
  </ul></li>
  <li><a href="#готові-функції" id="toc-готові-функції" class="nav-link" data-scroll-target="#готові-функції"><span class="header-section-number">1.6</span> Готові функції</a></li>
  <li><a href="#статистична-потужність" id="toc-статистична-потужність" class="nav-link" data-scroll-target="#статистична-потужність"><span class="header-section-number">1.7</span> Статистична потужність</a>
  <ul class="collapse">
  <li><a href="#хибно-негативні-помилки" id="toc-хибно-негативні-помилки" class="nav-link" data-scroll-target="#хибно-негативні-помилки"><span class="header-section-number">1.7.1</span> Хибно негативні помилки</a></li>
  <li><a href="#критерій-пори-року" id="toc-критерій-пори-року" class="nav-link" data-scroll-target="#критерій-пори-року"><span class="header-section-number">1.7.2</span> Критерій пори року</a></li>
  <li><a href="#потужність" id="toc-потужність" class="nav-link" data-scroll-target="#потужність"><span class="header-section-number">1.7.3</span> Потужність</a></li>
  </ul></li>
  <li><a href="#потужність-для-біноміального-розподілу" id="toc-потужність-для-біноміального-розподілу" class="nav-link" data-scroll-target="#потужність-для-біноміального-розподілу"><span class="header-section-number">1.8</span> Потужність для біноміального розподілу</a></li>
  <li><a href="#мінімальна-величина-ефекту" id="toc-мінімальна-величина-ефекту" class="nav-link" data-scroll-target="#мінімальна-величина-ефекту"><span class="header-section-number">1.9</span> Мінімальна величина ефекту</a></li>
  <li><a href="#довірчі-інтервали" id="toc-довірчі-інтервали" class="nav-link" data-scroll-target="#довірчі-інтервали"><span class="header-section-number">1.10</span> Довірчі інтервали</a></li>
  <li><a href="#односторонні-довірчі-інтервали" id="toc-односторонні-довірчі-інтервали" class="nav-link" data-scroll-target="#односторонні-довірчі-інтервали"><span class="header-section-number">1.11</span> Односторонні довірчі інтервали</a></li>
  <li><a href="#властивості-довірчих-інтервалів" id="toc-властивості-довірчих-інтервалів" class="nav-link" data-scroll-target="#властивості-довірчих-інтервалів"><span class="header-section-number">1.12</span> Властивості довірчих інтервалів</a></li>
  <li><a href="#висновок" id="toc-висновок" class="nav-link" data-scroll-target="#висновок"><span class="header-section-number">1.13</span> Висновок</a></li>
  <li><a href="#питання-для-самоперевірки" id="toc-питання-для-самоперевірки" class="nav-link" data-scroll-target="#питання-для-самоперевірки"><span class="header-section-number">1.14</span> Питання для самоперевірки</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-binom" class="quarto-section-identifier"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Біноміальний критерій</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="генеральна-сукупність-та-вибірка" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="генеральна-сукупність-та-вибірка"><span class="header-section-number">1.1</span> Генеральна сукупність та вибірка</h2>
<p>Ви вирішили створити платформу онлайн-курсів з програмування. Ви записали навчальні відео та запропонували користувачам доступ за передплатою. Вартість курсу для студента становить 1000 гривень, а витрати на підтримку платформи та індивідуальні консультації коштують вам 500 гривень з кожного студента.</p>
<p>Проте ви помічаєте, що деякі люди відмовляються від курсу після першого заняття, якщо матеріал їм здається складним або нецікавим. Інвестори готові підтримати ваш проєкт, якщо рівень відмов буде нижче 50%.</p>
<p>Щоб це перевірити, ви проводите експеримент: залучаєте 30 нових студентів. 20 із них проходять курс й оплачують доступ, а 11 відмовляються. 20 — це більше половини, але чи достатньо цього, щоб довести перспективність проєкту?</p>
<p>Розв’язуючи таку задачу, ми припускаємо, що існує певна аудиторія, яка користуватиметься нашим сервісом. Цю групу називають <strong>генеральною сукупністю</strong>. Якщо запустити сервіс для всіх потенційних користувачів, у ньому буде певна частка успішних випадків, позначимо її як <span class="math inline">\(\mu\)</span>. Це невідомий параметр, який ми не можемо визначити безпосередньо. Натомість ми можемо проводити експерименти та <strong>досліджувати</strong> результати. Оскільки протестувати продукт на всій аудиторії неможливо, ми беремо <strong>вибірку</strong> з генеральної сукупності та аналізуємо частку успішних випадків.</p>
<p>Згідно з результатами нашого експерименту, спостережувана ймовірність оплати становить <span class="math inline">\(\hat{\mu} = 20/30 = 0.67\)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Це означає, що 67% студентів оплатили доступ. Чи можемо ми зробити висновок, що справжня частка успішних випадків перевищує 50%?</p>
<p>Розгляньмо, чому отримане значення <em>може не бути</em> переконливим доказом. Припустимо, що ймовірність успішної оплати дорівнює <span class="math inline">\(\mu = 0.5\)</span>, і змоделюємо можливі результати для 30 студентів.</p>
<p>Давайте спростимо цю задачу до прикладу з підкиданням монетки та змоделюємо результати для 30 спроб:</p>
<ul>
<li>Якщо монетка випаде орлом, студент оплачує доступ.</li>
<li>Якщо монетка випаде решкою, студент відмовляється від курсу.</li>
<li>Використаємо метод <code>integers()</code> до класу <code>Generator</code>, яка генерує випадкові цілі числа в заданому діапазоні.</li>
<li>Підкинемо монетку 30 разів та порахуємо кількість успішних випадків.</li>
</ul>
<div id="lst-coin-flip" class="listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-coin-flip-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.1: Підкидання монетки
</figcaption>
<div aria-describedby="lst-coin-flip-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div id="e209072b" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-10-1" class="code-annotation-target"><a href="#annotated-cell-10-1" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(<span class="dv">18</span>)</span>
<span id="annotated-cell-10-2"><a href="#annotated-cell-10-2" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-10-3" class="code-annotation-target"><a href="#annotated-cell-10-3" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">30</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-10-4" class="code-annotation-target"><a href="#annotated-cell-10-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> rng.integers(<span class="dv">0</span>, <span class="dv">1</span>, size <span class="op">=</span> <span class="dv">30</span>, endpoint <span class="op">=</span> <span class="va">True</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-10-5" class="code-annotation-target"><a href="#annotated-cell-10-5" aria-hidden="true" tabindex="-1"></a>success <span class="op">=</span> np.<span class="bu">sum</span>(results) <span class="op">/</span> n</span>
<span id="annotated-cell-10-6"><a href="#annotated-cell-10-6" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-10-7" class="code-annotation-target"><a href="#annotated-cell-10-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Кількість успішних випадків: </span><span class="sc">{</span><span class="bu">round</span>(success, <span class="dv">3</span>) <span class="op">*</span> <span class="dv">100</span><span class="sc">}</span><span class="ss">%"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="1" data-code-annotation="1">Ініціалізуємо генератор випадкових чисел з фіксованим <code>seed</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="3" data-code-annotation="2">Кількість студентів.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="4" data-code-annotation="3">Генеруємо випадкові числа<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> для кожного студента.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="5" data-code-annotation="4">Обчислюємо частку успішних випадків.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="7" data-code-annotation="5">Виводимо результат.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Кількість успішних випадків: 70.0%</code></pre>
</div>
</div>
</div>
</figure>
</div>
<p>Ми бачимо, що в експерименті частка успішних випадків навіть перевищила 63%, тоді як у симуляції була закладена ймовірність 50%.</p>
<p>Тому, на жаль, ми не можемо з абсолютною точністю визначити, яким є справжнє значення <span class="math inline">\(\mu\)</span> у генеральній сукупності та чи перевищує воно 50%, незалежно від того, скільки спостережень ми проводимо. Однак, застосовуючи методи прикладної статистики, ми зможемо використати інструменти, які допоможуть ухвалити правильне рішення, зокрема й у цьому випадку.</p>
</section>
<section id="статистичні-гіпотези" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="статистичні-гіпотези"><span class="header-section-number">1.2</span> Статистичні гіпотези</h2>
<section id="постановка-задачі" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="постановка-задачі"><span class="header-section-number">1.2.1</span> Постановка задачі</h3>
<p>Ми з’ясували, що навіть за ймовірності <span class="math inline">\(\mu = 0.5\)</span> можна отримати значну кількість успішних випадків. Насправді ми спеціально підбирали <code>seed</code> для отримання такого результату. Якщо повторити цей експеримент з іншим значенням <code>seed</code> або збільшити кількість спостережень, результат може виявитися іншим.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Порада
</div>
</div>
<div class="callout-body-container callout-body">
<p>Спробуйте змінити <code>seed</code> (наприклад 22) або кількість спостережень та перевірте, як змінюється результат.</p>
</div>
</div>
<p>Тож велика кількість успішних випадків може бути результатом випадковості. Щоб вирішити, чи можна вважати результати експерименту <strong>статистично значущими</strong> необхідно отримати відповідь на питання:</p>
<blockquote class="blockquote">
<p>Чи можна вважати, що спостережуване значення <span class="math inline">\(\hat{\mu}\)</span> є більшим від <span class="math inline">\(\mu = 0.5\)</span>?</p>
</blockquote>
<p>Звернімося до теорії ймовірностей. Факт підписки на наш сервіс для кожного окремого студента можна розглядати як випадкову величину <span class="math inline">\(\xi\)</span>, яка підпорядковується розподілу Бернуллі<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Параметр цього розподілу, а саме ймовірність успіху, нам невідомий.</p>
<p><span class="math display">\[
\xi \sim \text{Bernoulli}(\mu)
\]</span></p>
<p>де <span class="math inline">\(\mu\)</span> — ймовірність успіху.</p>
<p>Нас цікавить підтвердження того, що <span class="math inline">\(\mu &gt; 0.5\)</span>. У статистиці для перевірки гіпотез розглядають дві можливості:</p>
<ul>
<li><strong>Нульова гіпотеза</strong> (<span class="math inline">\(H_0\)</span>) формулюється як твердження, яке ми прагнемо спростувати.</li>
<li><strong>Альтернативна гіпотеза</strong> (<span class="math inline">\(H_1\)</span>) висловлює припущення, яке ми хочемо довести.</li>
</ul>
<p>Скорочено це записують як:</p>
<p><span class="math display">\[
\begin{aligned}
H_0 &amp;: \mu \leq 0.5 \\
H_1 &amp;: \mu &gt; 0.5
\end{aligned}
\]</span></p>
<p>Зауважимо, що якщо в нашому експерименті з 30 студентами можна дивитися не на частку успіхів, а на їх <strong>кількість</strong>.</p>
<p>Тоді питання можна переформулювати так:</p>
<blockquote class="blockquote">
<p>За умови вірності <span class="math inline">\(H_0\)</span> наскільки ймовірно отримати 20 або більше успішних випадків з 30?</p>
</blockquote>
<p>Якщо ми проводимо <span class="math inline">\(n\)</span> незалежних спостережень, то сума цих випадкових величин також підпорядковується біноміальному розподілу<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<p><span class="math display">\[
S_n = \sum_{i=1}^{n} \xi_i \sim \text{Binomial}(n, \mu)
\]</span></p>
<p>де <span class="math inline">\(\xi_i\)</span> — випадкова величина, яка показує успіх у <span class="math inline">\(i\)</span>-му спостереженні, <span class="math inline">\(S_n\)</span> — кількість успішних випадків у <span class="math inline">\(n\)</span> спостереженнях, <span class="math inline">\(n\)</span> — кількість спостережень, <span class="math inline">\(\mu\)</span> — ймовірність успіху.</p>
<p>Давайте подивимось, як це виглядає графічно. Для цього побудуємо графік функції щільності ймовірностей для біноміального розподілу з параметрами <span class="math inline">\(n = 30\)</span> та <span class="math inline">\(\mu = 0.5\)</span>.</p>
<div id="cell-fig-binom-pmf" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">0</span>, n <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> binom.pmf(x, n, mu)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>plt.bar(x, y, color<span class="op">=</span>turquoise)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>plt.bar(x[x <span class="op">&gt;=</span> <span class="dv">20</span>], y[x <span class="op">&gt;=</span> <span class="dv">20</span>], color<span class="op">=</span>red_pink)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Кількість успішних випадків"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Ймовірність"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-pmf" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-pmf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-pmf-output-1.png" width="675" height="324" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-pmf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.1: Функція щільності ймовірностей при <span class="math inline">\(H_0\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-binom-pmf" class="quarto-xref">Рисунок&nbsp;<span>1.1</span></a> демонструє функцію щільності ймовірностей для біноміального розподілу з параметрами <span class="math inline">\(n = 30\)</span> та <span class="math inline">\(\mu = 0.5\)</span>. Ціановим<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> кольором позначено ймовірності для кожної кількості успішних випадків. Рожевими виділено ймовірності для кількості успішних випадків, яка перевищує або дорівнює 20.</p>
</section>
<section id="критерій" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="критерій"><span class="header-section-number">1.2.2</span> Критерій</h3>
<p>Щойно ми розробили алгоритм, який на основі вибірки <span class="math inline">\(\xi\)</span> або визнає наявність доказів на користь <span class="math inline">\(H_1\)</span>, або повідомляє, що таких доказів немає. Відповідно, він або відхиляє <span class="math inline">\(H_0\)</span>, або не відхиляє її.</p>
<p>Такий алгоритм називається <strong>критерієм</strong>. Його можна подати у вигляді функції <span class="math inline">\(S\)</span>, яка приймає реалізацію вибірки та повертає <span class="math inline">\(1\)</span>, якщо слід відхилити <span class="math inline">\(H_0\)</span>, та <span class="math inline">\(0\)</span> в іншому випадку.</p>
<p><span class="math display">\[
S(\xi) = \begin{cases}
    1, \text{ якщо відхиляємо } H_0 \\
    0, \text{ в іншому випадку}
\end{cases}
\]</span></p>
<p>Давайте припустимо, що ми вирішили відхилити <span class="math inline">\(H_0\)</span>, якщо кількість успішних випадків перевищує або дорівнює 21. Тоді критерій набуде вигляду:</p>
<p><span class="math display">\[
S(\xi) = \begin{cases}
    1, \text{ якщо } \sum \xi_i \geqslant 21 \\
    0, \text{ в іншому випадку}
\end{cases}
\]</span></p>
<p>Зазвичай скорочують запис і пишуть просто правило, за яким відхиляємо <span class="math inline">\(H_0\)</span></p>
<p><span class="math display">\[
S = \{\sum \xi_i \geqslant 21\}
\]</span></p>
<p>Позначимо <span class="math inline">\(Q = \sum \xi_i\)</span>, <span class="math inline">\(C = 21\)</span>, тоді критерій набуває вигляду:</p>
<p><span class="math display">\[
S = \{Q(\xi) \geqslant C\}
\]</span></p>
<p>Так влаштована більшість класичних критеріїв у прикладній статистиці, тому величинам у ньому дано спеціальні назви. <span class="math inline">\(Q\)</span> називається <strong>статистикою критерію</strong>, <span class="math inline">\(C\)</span> — <strong>критичним значенням</strong>.</p>
<p><span class="math inline">\(Q\)</span> може бути будь-якою функцією від вибірки, яку ви вважаєте логічною для перевірки гіпотези. У нашому випадку це кількість успіхів, або сума всіх <span class="math inline">\(\xi_i\)</span>. Але ви можете вибрати й інші: максимальне значення, суму перших 5 значень або навіть просто перший елемент.</p>
</section>
<section id="критична-область" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="критична-область"><span class="header-section-number">1.2.3</span> Критична область</h3>
<p>Знову перепишемо наше основне запитання, тільки тепер з використанням нашого критерію <span class="math inline">\(S\)</span>:</p>
<blockquote class="blockquote">
<p>Наскільки часто може бути таке, що за справедливості <span class="math inline">\(H_0\)</span> критерій <span class="math inline">\(S\)</span> відхиляє гіпотезу?</p>
</blockquote>
<p>Відповідь на це запитання залежить від критичного значення. Зараз ми взяли його рівним 21, побачивши на картинці, що великі відхилення відбуваються при <span class="math inline">\(H_0\)</span> рідко. Але що означає рідко й наскільки рідко, не сказали. Тепер наша мета зрозуміти, як вибрати критичне значення <span class="math inline">\(C\)</span>, виходячи з <strong>частоти помилок</strong> нашого критерію.</p>
<p>Вибираючи <span class="math inline">\(C\)</span>, ми можемо або часто відхиляти нульову гіпотезу, коли <span class="math inline">\(C\)</span> мале, або можемо робити це рідше, коли <span class="math inline">\(C\)</span> велике. Щоб вибрати правильне значення, потрібно визначитися, коли наш критерій помиляється.</p>
<ul>
<li><p><span class="math inline">\(C = 16\)</span>. Якщо відхиляти гіпотезу при отриманні хоча б 16 успішних підписок із 30, то це навряд чи влаштує інвесторів. Так, успіхів більше половини. Але якщо в генеральній сукупності ймовірність 0.5, то майже в половині випадків ми будемо відхиляти гіпотезу. Критерій помилково повертає <span class="math inline">\(1\)</span>, тобто це помилка <strong>хибно позитивна</strong> (false positive, <strong>FP</strong>).</p></li>
<li><p><span class="math inline">\(C = 29\)</span>. У такому разі будемо відхиляти гіпотезу тільки за 29 або 30 успіхів. Ці значення, звісно, говорять про те, що відхилення від 50% успіхів сильне. Але якщо в генеральній сукупності ймовірність, наприклад, 60%, то такі значення будуть виходити рідко. Але ж такі ймовірності теж влаштували б інвесторів, й ми б змогли відкрити стартап! А з таким критерієм ми навряд чи доб’ємося цього. Не відхилити гіпотезу <span class="math inline">\(H_0\)</span>, коли вона неправильна — це теж помилка. Вона називається <strong>хибно негативна</strong> (false negative, <strong>FN</strong>), оскільки критерій повернув 0 помилково.</p></li>
</ul>
<p><span class="math display">\[
\text{FP} - H_0\ відхиляється,\ коли\ вона\ вірна
\]</span></p>
<p><span class="math display">\[
\text{FN} - H_0\ не\ відхиляється,\ коли\ вона\ не вірна
\]</span></p>
<p>У нашому завданні інвесторам важливіше хибно позитивна помилка. Їм дуже не хочеться потрапити в ситуацію, коли їм показали доказ успішності бізнесу, а виявилося, більшість користувачів відмовляється оформлювати підписку й компанія не отримує прибуток. Це призведе до збитків. Хибно негативна помилка призведе до того, що ви втратите успішний бізнес, але інвестори грошей не втратять.</p>
<p>Тому виберемо поріг, щоб ймовірність хибно позитивної помилки була задовільною, або ж <strong>частота хибнопозитивних спрацьовувань</strong> (False Positive Rate, FPR). Для цього треба зрозуміти, як часто ми будемо відхиляти гіпотезу, за умови вірності <span class="math inline">\(H_0\)</span>.</p>
<p>Тепер знову переформулюємо основне питання, повністю з використанням нових термінів, й врешті-решт відповімо на нього.</p>
<blockquote class="blockquote">
<p>Який FPR у критерію <span class="math inline">\(S\)</span> для перевірки гіпотези <span class="math inline">\(H_0\)</span> проти <span class="math inline">\(H_1\)</span>?</p>
</blockquote>
<p>Коли <span class="math inline">\(H_0\)</span> є вірною, щоб порахувати кількість успіхів ми проводили 30 разів підкидання монетки з ймовірністю орла <span class="math inline">\(0.5\)</span>. Кількість орлів (тобто успіхів) у такому експерименті має розподіл, який називається біноміальним, тобто при <span class="math inline">\(\mu = 0.5\)</span> наша статистика має біноміальний розподіл <span class="math inline">\(Q \sim Binom(0.5, 30)\)</span>.</p>
<p>Обчислимо FPR для <span class="math inline">\(C = 21\)</span></p>
<p><span class="math display">\[
\begin{aligned}
FPR &amp;= P(S(\xi) = 1\ |\ H_0) \\
&amp;= P(Q \geqslant 21\ |\ H_0) \\
&amp;= P(Q \geqslant 21\ |\ \mu = 0.5) = \\
&amp;= P(Q \geqslant 21\ |\ Q \sim Binom(0.5, 30))
\end{aligned}
\]</span></p>
<p>Це вже ймовірність події за конкретного розподілу випадкової величини. Його можна подивитися за таблицею або, що зручніше, обчислити з використанням мов програмування.</p>
</section>
<section id="обчислення-fpr" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="обчислення-fpr"><span class="header-section-number">1.2.4</span> Обчислення FPR</h3>
<p>Давайте порахуємо суму ймовірностей для кількостей успіхів від 21 до 30 включно. Покажемо графічно, як це виглядає на <a href="#fig-binom-pmf-fpr" class="quarto-xref">Рисунку&nbsp;<span>1.2</span></a>.</p>
<div id="cell-fig-binom-pmf-fpr" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">0</span>, n <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> binom.pmf(x, n, <span class="fl">0.5</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>plt.bar(x, y, color<span class="op">=</span>turquoise)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>plt.bar(x[x <span class="op">&gt;=</span> crit_subs], y[x <span class="op">&gt;=</span> crit_subs], color<span class="op">=</span>red_pink)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(crit_subs <span class="op">-</span> <span class="dv">2</span>, crit_subs <span class="op">+</span> <span class="dv">4</span>):</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    plt.text(i <span class="op">+</span> <span class="fl">0.5</span>, y[i] <span class="op">+</span> <span class="fl">0.001</span>, <span class="ss">f"</span><span class="sc">{</span><span class="bu">round</span>(y[i] <span class="op">*</span> <span class="dv">100</span>, <span class="dv">1</span>)<span class="sc">}</span><span class="ss">%"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, size<span class="op">=</span><span class="dv">8</span>, rotation <span class="op">=</span> <span class="dv">30</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Кількість успішних випадків"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Ймовірність"</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-pmf-fpr" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-pmf-fpr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-pmf-fpr-output-1.png" width="675" height="324" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-pmf-fpr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.2: Ймовірність хибно відхилити <span class="math inline">\(H_0\)</span> за умови її вірності
</figcaption>
</figure>
</div>
</div>
</div>
<p>Залишається лише обчислити суму ймовірностей для кількостей успіхів від 21 до 30 включно. Це і буде нашим FPR.</p>
<p><span class="math display">\[
FPR_{21} = \sum_{i = 21}^{30} P(Q = i) \approx 0.021
\]</span></p>
<p>У нашому випадку це буде 2.1%. Якщо FPR не перевищує деякої константи <span class="math inline">\(\alpha\)</span>, то критерій називається критерієм <strong>рівня значущості</strong> <span class="math inline">\(\alpha\)</span>. Статистичний критерій з <span class="math inline">\(\alpha\)</span> = 100% створити тривіально — достатньо завжди відхиляти <span class="math inline">\(H_0\)</span> — тому така постановка не має сенсу.</p>
<p>Рівень значущості зазвичай обирають на основі бізнес-міркувань. Він позначає те, який ризик неправильного прийняття позитивного рішення ми вважаємо прийнятним. Зазвичай беруть <span class="math inline">\(\alpha = 0.05\)</span>, але якщо потрібне більш точне ухвалення рішення, можуть вибрати <span class="math inline">\(0.01\)</span>, <span class="math inline">\(0.005\)</span>, <span class="math inline">\(0.001\)</span>. Якщо ж рішення не таке критичне, можуть вибрати <span class="math inline">\(0.1\)</span>.</p>
<p>Припустимо, вибрали значення <span class="math inline">\(\alpha = 0.05\)</span>, скористаємося критерієм <span class="math inline">\(S\)</span>: тобто якщо кількість успішних випадків перевищує або дорівнює 21, то відхиляємо <span class="math inline">\(H_0\)</span>.</p>
<p>Якщо уважно подивитись на <a href="#fig-binom-pmf-fpr" class="quarto-xref">Рисунок&nbsp;<span>1.2</span></a>, то можна помітити, що ми можемо відхиляти <span class="math inline">\(H_0\)</span> при кількості успіхів від 20, а не 21, оскільки такий все ще буде відповідати <span class="math inline">\(\alpha = 0.05\)</span>:</p>
<p><span class="math display">\[
FPR_{20} = \sum_{i = 20}^{30} P(Q = i) \approx 0.049
\]</span></p>
<p>Якщо ж обрати 19, то FPR буде більше <span class="math inline">\(\alpha\)</span>: <span class="math display">\[
FPR_{19} = \sum_{i = 20}^{30} P(Q = i) \approx 0.1002
\]</span></p>
</section>
</section>
<section id="статистичні-функції-в-python" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="статистичні-функції-в-python"><span class="header-section-number">1.3</span> Статистичні функції в Python</h2>
<p>У цій частині подивимося, як вивести те, що ми отримали в частині 2, за допомогою Python. А також зрозуміємо, як знайти відповідне <span class="math inline">\(C\)</span> за допомогою Python.</p>
<section id="біноміальний-розподіл" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="біноміальний-розподіл"><span class="header-section-number">1.3.1</span> Біноміальний розподіл</h3>
<p>Ми з’ясували, що статистика <span class="math inline">\(Q\)</span> має біноміальний розподіл.</p>
<p>Біноміальний розподіл <span class="math inline">\(Binom(n, \mu)\)</span> — розподіл кількості успіхів у послідовності з <span class="math inline">\(n\)</span> незалежних випадкових експериментів, ймовірність успіху в кожному з яких дорівнює <span class="math inline">\(\mu\)</span>.</p>
<p>Щоб працювати з розподілом, можна створити об’єкт-розподіл за допомогою бібліотеки <code>scipy.stats</code>.</p>
<div id="315bd5f2" class="cell" data-execution_count="6">
<div id="lst-binom" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.2: Створення біноміального розподілу
</figcaption>
<div aria-describedby="lst-binom-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom"><pre class="sourceCode code-annotation-code python code-with-copy"><code class="sourceCode python"><span id="lst-binom-1"><a href="#lst-binom-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> binom</span>
<span id="lst-binom-2"><a href="#lst-binom-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-3"><a href="#lst-binom-3" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">30</span></span>
<span id="lst-binom-4"><a href="#lst-binom-4" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> <span class="fl">0.5</span></span>
<span id="lst-binom-5"><a href="#lst-binom-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-6"><a href="#lst-binom-6" aria-hidden="true" tabindex="-1"></a>binom_dist <span class="op">=</span> binom(n, mu)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<ol type="1">
<li>Кількість спостережень.</li>
<li>Ймовірність успіху.</li>
</ol>
</section>
<section id="функція-ймовірностей" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="функція-ймовірностей"><span class="header-section-number">1.3.2</span> Функція ймовірностей</h3>
<p>Функція ймовірності дискретного розподілу <span class="math inline">\(p_\xi(x)\)</span> — ймовірність, з якою <span class="math inline">\(\xi\)</span> приймає значення <span class="math inline">\(x\)</span>.</p>
<p>У Python це функція <code>pmf</code> (probability mass function).</p>
<div id="7133ed5c" class="cell" data-execution_count="7">
<div id="lst-binom-pmf" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-pmf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.3: Обчислення ймовірностей біноміального розподілу для кількості успіхів
</figcaption>
<div aria-describedby="lst-binom-pmf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-pmf"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-pmf-1"><a href="#lst-binom-pmf-1" aria-hidden="true" tabindex="-1"></a>binom_dist.pmf(<span class="dv">20</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>0.027981600724160654</code></pre>
</div>
</div>
<p>Зобразимо розподіл статистики <span class="math inline">\(Q\)</span> за справедливості <span class="math inline">\(H_0\)</span> на графіку. Для цього можна передати відразу масив точок, для яких треба розрахувати ймовірність.</p>
<div id="cell-fig-binom-pmf-python" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-1" class="code-annotation-target"><a href="#annotated-cell-3-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="dv">0</span>, n <span class="op">+</span> <span class="dv">1</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-3-2" class="code-annotation-target"><a href="#annotated-cell-3-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> binom_dist.pmf(x)</span>
<span id="annotated-cell-3-3"><a href="#annotated-cell-3-3" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-3-4" class="code-annotation-target"><a href="#annotated-cell-3-4" aria-hidden="true" tabindex="-1"></a>crit_subs <span class="op">=</span> <span class="dv">21</span></span>
<span id="annotated-cell-3-5"><a href="#annotated-cell-3-5" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-3-6" class="code-annotation-target"><a href="#annotated-cell-3-6" aria-hidden="true" tabindex="-1"></a>plt.bar(x, y, color<span class="op">=</span>turquoise, label<span class="op">=</span><span class="st">"Ймовірність успіхів"</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-3-7" class="code-annotation-target"><a href="#annotated-cell-3-7" aria-hidden="true" tabindex="-1"></a>plt.bar(x[x <span class="op">&gt;=</span> crit_subs], y[x <span class="op">&gt;=</span> crit_subs], color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">"Критичне значення"</span>)</span>
<span id="annotated-cell-3-8"><a href="#annotated-cell-3-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Кількість успішних випадків"</span>)</span>
<span id="annotated-cell-3-9"><a href="#annotated-cell-3-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Ймовірність"</span>)</span>
<span id="annotated-cell-3-10"><a href="#annotated-cell-3-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="1" data-code-annotation="1">Масив точок.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="2" data-code-annotation="2">Розрахунок ймовірностей.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="4" data-code-annotation="3">Критичне значення.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="6" data-code-annotation="4">Ймовірність успіхів.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="7" data-code-annotation="5">Критичне значення.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-display">
<div id="fig-binom-pmf-python" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-pmf-python-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-pmf-python-output-1.png" width="675" height="324" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-pmf-python-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.3: Функція щільності ймовірностей біноміального розподілу
</figcaption>
</figure>
</div>
</div>
</div>
<p>Насправді вже зараз ми можемо порахувати ймовірність потрапляння в критичну область. Потрібно просто підсумувати ймовірності для кількостей успіхів від 21 до 30.</p>
<div id="5b1e8d83" class="cell" data-execution_count="9">
<div id="lst-binom-pmf-sum" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-pmf-sum-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.4: Обчислення ймовірностей для критичної області
</figcaption>
<div aria-describedby="lst-binom-pmf-sum-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-pmf-sum"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-pmf-sum-1"><a href="#lst-binom-pmf-sum-1" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">round</span>(np.<span class="bu">sum</span>(y[crit_subs:]), <span class="dv">4</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0.0214</code></pre>
</div>
</div>
<p>Отже, ми дійсно побудували критерій рівня значущості <span class="math inline">\(\alpha = 0.05\)</span>. Ба більше, це критерій рівня значущості 0.021.</p>
<p>А що якби ми взяли <span class="math inline">\(C = 19\)</span>?</p>
<div id="bee2b690" class="cell" data-execution_count="10">
<div id="lst-binom-pmf-sum-19" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-pmf-sum-19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.5: Обчислення ймовірностей для критичної області при <span class="math inline">\(C = 19\)</span>
</figcaption>
<div aria-describedby="lst-binom-pmf-sum-19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-pmf-sum-19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-pmf-sum-19-1"><a href="#lst-binom-pmf-sum-19-1" aria-hidden="true" tabindex="-1"></a>crit_subs <span class="op">=</span> <span class="dv">19</span></span>
<span id="lst-binom-pmf-sum-19-2"><a href="#lst-binom-pmf-sum-19-2" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">round</span>(np.<span class="bu">sum</span>(y[crit_subs:]), <span class="dv">4</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>0.1002</code></pre>
</div>
</div>
<p>Тоді ймовірність помилки вже навіть більше <span class="math inline">\(10\%\)</span>, що зовсім нам не підходить.</p>
<p>А якщо <span class="math inline">\(C = 20\)</span>?</p>
<div id="d86c729e" class="cell" data-execution_count="11">
<div id="lst-coin-toss" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-coin-toss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.6: Обчислення ймовірностей для критичної області при <span class="math inline">\(C = 20\)</span>
</figcaption>
<div aria-describedby="lst-coin-toss-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-coin-toss"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-coin-toss-1"><a href="#lst-coin-toss-1" aria-hidden="true" tabindex="-1"></a>crit_subs <span class="op">=</span> <span class="dv">20</span></span>
<span id="lst-coin-toss-2"><a href="#lst-coin-toss-2" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">round</span>(np.<span class="bu">sum</span>(y[crit_subs:]), <span class="dv">4</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>0.0494</code></pre>
</div>
</div>
<p>Видно, що немає такого <span class="math inline">\(C\)</span>, щоб FPR був рівно <span class="math inline">\(5\%\)</span>.</p>
</section>
<section id="кумулятивна-функція-розподілу" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="кумулятивна-функція-розподілу"><span class="header-section-number">1.3.3</span> Кумулятивна функція розподілу</h3>
<p>Кумулятивна функція розподілу <span class="math inline">\(F_\xi(x) = P(\xi \leqslant x)\)</span></p>
<p>У Python це функція <code>cdf</code> (Cumulative Distribution Function).</p>
<div id="4e7757f2" class="cell" data-execution_count="12">
<div id="lst-binom-cdf" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-cdf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.7: Обчислення кумулятивної функції розподілу біноміального розподілу
</figcaption>
<div aria-describedby="lst-binom-cdf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-cdf"><pre class="sourceCode code-annotation-code python code-with-copy"><code class="sourceCode python"><span id="lst-binom-cdf-1"><a href="#lst-binom-cdf-1" aria-hidden="true" tabindex="-1"></a>binom_dist.cdf(<span class="dv">19</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>0.9506314266473055</code></pre>
</div>
</div>
<p>Ймовірність отримати <span class="math inline">\(19\)</span> або менше успіхів у нашому завданні <span class="math inline">\(\geqslant 0.95\)</span>. А оскільки <span class="math inline">\(P(\xi \leqslant 19) + P(\xi \geqslant 20) = 1\)</span>, можемо обчислити рівень значущості нашого критерію.</p>
<div id="aa3b9a1f" class="cell" data-execution_count="13">
<div id="lst-binom-cdf-20" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-cdf-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.8: Обчислення рівня значущості критерію
</figcaption>
<div aria-describedby="lst-binom-cdf-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-cdf-20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-cdf-20-1"><a href="#lst-binom-cdf-20-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span> binom_dist.cdf(<span class="dv">19</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0.04936857335269451</code></pre>
</div>
</div>
</section>
<section id="квантиль" class="level3" data-number="1.3.4">
<h3 data-number="1.3.4" class="anchored" data-anchor-id="квантиль"><span class="header-section-number">1.3.4</span> Квантиль</h3>
<p>Щоб вибрати критичну область для критерію, ми хотіли б знайти точку, площа стовпців праворуч від якої була б <span class="math inline">\(5\%\)</span>. Тобто площа стовпців зліва — <span class="math inline">\(95\%\)</span>. Така точка називається <em>квантилью</em>.</p>
<p><span class="math display">\[
u_p(\xi) = \{x\ | F_\xi(x) = p\}
\]</span></p>
<p>Але при <span class="math inline">\(p = 0.95\)</span> й нашому біноміальному розподілі, такої точки немає. Ми з’ясували, що є точка, праворуч від якої площа <span class="math inline">\(0.494\)</span>, а в наступної вже <span class="math inline">\(0.1\)</span>. Щоб визначити квантиль у цьому випадку, модифікуємо визначення. Квантиль <span class="math inline">\(u_p(\xi)\)</span> — величина, яку <span class="math inline">\(\xi\)</span> не перевищує з імовірністю хоча б <span class="math inline">\(p\)</span>. Тобто <span class="math inline">\(F_\xi(u_p) \geqslant p\)</span>.</p>
<p><span class="math display">\[
u_p(\xi) = min\ \{x\ |\ F_\xi(x) \geqslant p \}
\]</span></p>
<div id="exm-quantile" class="theorem example">
<p><span class="theorem-title"><strong>Приклад 1.1</strong></span> Для величини <span class="math inline">\(\xi \sim Bin(30, 0.5)\)</span> порахуємо 0.95-квантиль. Вирішимо задачу просто підбором.</p>
<p><span class="math display">\[
P(\xi \leqslant 18) \approx 0.90
\]</span></p>
<p><span class="math display">\[
P(\xi \leqslant 19) \approx 0.951
\]</span></p>
<p><span class="math display">\[
P(\xi \leqslant 20) \approx 0.97
\]</span></p>
<p>Бачимо, що 18 нам ще не підходить, а 19 й більші значення вже підійдуть. У них функція розподілу буде більшою за <span class="math inline">\(p\)</span>. Відповідь — найменше відповідне значення, тобто 19. При цьому немає точки, де функція розподілу дорівнювала б <span class="math inline">\(p\)</span> в точності.</p>
<p>Якби розподіл був неперервним, можна було б сказати, що квантиль — це таке <span class="math inline">\(x\)</span>, на якому функція розподілу дорівнює <span class="math inline">\(p\)</span>. Але для дискретного розподілу такого може не бути.</p>
</div>
<p>У Python квантиль можна порахувати через функцію <code>ppf</code> (Percent Point Function).</p>
<div id="5ddbadea" class="cell" data-execution_count="14">
<div id="lst-quantile" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-quantile-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.9: Обчислення квантилю біноміального розподілу
</figcaption>
<div aria-describedby="lst-quantile-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-quantile"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-quantile-1"><a href="#lst-quantile-1" aria-hidden="true" tabindex="-1"></a>binom_dist.ppf(<span class="fl">0.95</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>19.0</code></pre>
</div>
</div>
<p>Як тепер підібрати <span class="math inline">\(C\)</span> для будь-яких <span class="math inline">\(n, \mu\)</span> й для будь-якого рівня значущості <span class="math inline">\(\alpha\)</span>?</p>
<ol type="1">
<li>Потрібно знайти <span class="math inline">\(C\)</span>, таке що <span class="math inline">\(P(Q \geqslant C) \leqslant \alpha\)</span></li>
<li>Тобто потрібно <span class="math inline">\(P(Q &lt; C) \geqslant 1 - \alpha\)</span></li>
<li><span class="math inline">\(Q\)</span> приймає тільки цілі значення: <span class="math inline">\(P(Q \leqslant C - 1) \geqslant 1 - \alpha\)</span>, або <span class="math inline">\(F(C - 1) \geqslant 1 - \alpha\)</span></li>
<li>Отже, з визначення квантилі, <span class="math inline">\(C - 1 = u_{1 - \alpha}\)</span></li>
<li>Значить <span class="math inline">\(C = u_{1 - \alpha} + 1\)</span></li>
</ol>
<div id="5f973611" class="cell" data-execution_count="15">
<div id="lst-find-crit-subs" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-find-crit-subs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.10: Знаходження критичного значення для критерію
</figcaption>
<div aria-describedby="lst-find-crit-subs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-find-crit-subs"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-find-crit-subs-1"><a href="#lst-find-crit-subs-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_crit_subs(n, mu, alpha):</span>
<span id="lst-find-crit-subs-2"><a href="#lst-find-crit-subs-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="lst-find-crit-subs-3"><a href="#lst-find-crit-subs-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Знаходить критичне значення для критерію</span></span>
<span id="lst-find-crit-subs-4"><a href="#lst-find-crit-subs-4" aria-hidden="true" tabindex="-1"></a><span class="co">    :param n: кількість спостережень</span></span>
<span id="lst-find-crit-subs-5"><a href="#lst-find-crit-subs-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param mu: ймовірність успіху</span></span>
<span id="lst-find-crit-subs-6"><a href="#lst-find-crit-subs-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :param alpha: рівень значущості</span></span>
<span id="lst-find-crit-subs-7"><a href="#lst-find-crit-subs-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :return: критичне значення</span></span>
<span id="lst-find-crit-subs-8"><a href="#lst-find-crit-subs-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="lst-find-crit-subs-9"><a href="#lst-find-crit-subs-9" aria-hidden="true" tabindex="-1"></a>    binom_dist <span class="op">=</span> binom(n, mu)</span>
<span id="lst-find-crit-subs-10"><a href="#lst-find-crit-subs-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> binom_dist.ppf(<span class="dv">1</span> <span class="op">-</span> alpha) <span class="op">+</span> <span class="dv">1</span></span>
<span id="lst-find-crit-subs-11"><a href="#lst-find-crit-subs-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-find-crit-subs-12"><a href="#lst-find-crit-subs-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-find-crit-subs-13"><a href="#lst-find-crit-subs-13" aria-hidden="true" tabindex="-1"></a>find_crit_subs(<span class="dv">30</span>, <span class="fl">0.5</span>, <span class="fl">0.05</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>20.0</code></pre>
</div>
</div>
<p>Критичне значення <span class="math inline">\(20\)</span>, отже підсумковий критерій має такий вигляд</p>
<p><span class="math display">\[
S = \{Q \geqslant 20\}
\]</span></p>
<p><span class="math inline">\(Q = 19\)</span>, значить гіпотезу ми не відкидаємо.</p>
<p>При цьому нам вдалося побудувати процес, за яким ми ухвалюємо рішення для будь-якого рівня значущості та значення статистики критерію.</p>
</section>
</section>
<section id="p-значення" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="p-значення"><span class="header-section-number">1.4</span> <span class="math inline">\(p\)</span>-значення</h2>
<p>Зауважимо, що зараз, якщо нам зададуть іншу <span class="math inline">\(\alpha\)</span>, нам доведеться перебудовувати критерій заново. Це не зовсім зручно. У статистиці є механізм <em><span class="math inline">\(p\)</span>-значення</em>, який дає змогу прийняти рішення для всіх <span class="math inline">\(\alpha\)</span> відразу.</p>
<section id="більш-екстремальні-значення" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="більш-екстремальні-значення"><span class="header-section-number">1.4.1</span> Більш екстремальні значення</h3>
<p>Припустимо, ми провели експеримент й порахували для критерію його статистику <span class="math inline">\(Q(\xi)\)</span>. Позначимо отримане значення <span class="math inline">\(q\)</span>, у поточній задачі це <span class="math inline">\(q = 19\)</span>. Якби кількість успішних підписок була більшою, це б сильніше свідчило на користь альтернативної гіпотези <span class="math inline">\(H_1\)</span>. Тобто в разі значення <span class="math inline">\(25\)</span> ми були б ще сильніше впевнені в тому, що наш бізнес буде окупатися. Тоді значення <span class="math inline">\(25\)</span> називається <em>більш екстремальним</em>, ніж значення <span class="math inline">\(19\)</span>. У нашій задачі більш екстремальним із двох значень є те, яке більше.</p>
<p>Визначимо поняття екстремальності формально:</p>
<p><span class="math display">\[
S = \{Q(\xi) \geqslant C\}:\ t\ \text{екстремальніше}\ q \Leftrightarrow t &gt; q
\]</span></p>
<p>Найчастіше критерії інших видів можна привести до цього, тоді для них теж визначено поняття екстремальності.</p>
</section>
<section id="p-значення-1" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="p-значення-1"><span class="header-section-number">1.4.2</span> <span class="math inline">\(p\)</span>-значення</h3>
<p><strong>p-value</strong> — це ймовірність отримати таке або більш екстремальне значення статистики <span class="math inline">\(q\)</span> за умови вірності <span class="math inline">\(H_0\)</span>.</p>
<p><span class="math display">\[
P_{H_0}(Q \geqslant q)
\]</span></p>
<div id="cell-fig-binom-pmf-p-value" class="cell" data-execution_count="16">
<div class="cell-output cell-output-display">
<div id="fig-binom-pmf-p-value" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-pmf-p-value-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-pmf-p-value-output-1.png" width="675" height="324" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-pmf-p-value-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.4: <span class="math inline">\(p\)</span>-значення для критерію <span class="math inline">\(Q = 15\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Тепер виведемо формулу через функції Python:</p>
<p><span class="math display">\[
P_{H_0}(Q \geqslant q) = 1 - P_{H_0}(Q &lt; q) = 1 - F(q)
\]</span></p>
<p>Зобразимо на графіку область більш екстремальних значень й p-value для різних значень статистики.</p>
<div id="cell-fig-binom-pmf-p-values" class="cell" data-execution_count="17">
<div class="cell-output cell-output-display">
<div id="fig-binom-pmf-p-values" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-pmf-p-values-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-pmf-p-values-output-1.png" width="729" height="559" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-pmf-p-values-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.5: <span class="math inline">\(p\)</span>-значення для критерію <span class="math inline">\(Q = 10, 19, 20, 25\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Можна побачити, що в критичній області <span class="math inline">\(p\)</span>-значення <span class="math inline">\(\leqslant \alpha\)</span>, а поза нею <span class="math inline">\(p\)</span>-значення <span class="math inline">\(&gt; \alpha\)</span>. Саме таке правило й використовується для прийняття рішення.</p>
<p><span class="math display">\[
H_0 \text{ відкидається } \Leftrightarrow p-значення \leqslant \alpha
\]</span></p>
<p>Причому за <span class="math inline">\(p\)</span>-значення одразу видно, що якби в нашу критичну область включили значення <span class="math inline">\(19\)</span>, наш критерій допускав би FPR у <span class="math inline">\(10\%\)</span> випадків, що вже неприпустимо. Тому й гіпотезу ми не відкидаємо.</p>
<p>Зауважимо, що для обчислення <span class="math inline">\(p\)</span>-значення не знадобилося знання <span class="math inline">\(\alpha\)</span>, а потрібна була тільки статистика й форма критерію.</p>
</section>
</section>
<section id="двосторонні-критерії" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="двосторонні-критерії"><span class="header-section-number">1.5</span> Двосторонні критерії</h2>
<p>До цього моменту нас цікавили відхилення від ймовірності в <span class="math inline">\(50\%\)</span> тільки в один бік. І логічно, адже це продиктовано бізнесом. Тільки велика частка успішних підписок призведе до успіху. І зазвичай при прийнятті рішень так й буває. <strong>При тестуванні нового рішення або продукту розглядають альтернативну гіпотезу тільки в бік поліпшення</strong>, тому що в іншому разі немає сенсу впроваджувати рішення на всіх користувачів.</p>
<p>Однак <strong>іноді</strong> може знадобитися доводити відхилення в обидва боки, якщо ви перевіряєте якесь припущення. Нехай вам дали монетку й просять перевірити, чесна вона чи ні. Монетка чесна, якщо під час підкидання ймовірність випадання орла дорівнює <span class="math inline">\(0.5\)</span>. Ви підкидаєте монетку <span class="math inline">\(30\)</span> разів, кожен кидок — бернуллівська величина, аналогічно завданню з сервісом освітніх послуг. Нульова гіпотеза та ж сама: <span class="math inline">\(\mu = 0.5\)</span>. Але тепер ми хочемо відкидати цю гіпотезу як у разі великої ймовірності орла, так і в разі маленької, відповідно перевіряємо <em>двосторонню гіпотезу</em>.</p>
<p><span class="math display">\[
H_0: \mu = 0.5
\]</span></p>
<p><span class="math display">\[
H_1: \mu \neq 0.5
\]</span></p>
<p>Виберемо критичну область для критерію за такої альтернативи. Скористаємося тією ж статистикою <span class="math inline">\(Q(\xi) = \sum \xi_i\)</span>. Тільки тепер відхилення в кожну сторону однаково важливі. Відкидати гіпотезу будемо не тільки на досить великих значеннях, а й на досить маленьких. Наприклад, якщо у нас було всього <span class="math inline">\(2\)</span> орла з <span class="math inline">\(30\)</span> — це свідчення на користь того, що <span class="math inline">\(\mu \neq 0.5\)</span>, але не на користь <span class="math inline">\(\mu &gt; 0.5\)</span>.</p>
<p>Оскільки відхилення в різні боки однаково важливі, а розподіл симетричний, шукати критерій можна в такому вигляді:</p>
<p><span class="math display">\[
S = \{Q \geqslant C\} \cup \{Q \leqslant n - C\}
\]</span></p>
<section id="як-вибрати-критичну-область" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="як-вибрати-критичну-область"><span class="header-section-number">1.5.1</span> Як вибрати критичну область</h3>
<p>Подивимося, який вигляд матиме критична область у такому разі.</p>
<div id="cell-fig-binom-pmf-two-sided" class="cell" data-execution_count="18">
<div class="cell-output cell-output-display">
<div id="fig-binom-pmf-two-sided" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-pmf-two-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-pmf-two-sided-output-1.png" width="526" height="361" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-pmf-two-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.6: Двостороння критична область для критерію <span class="math inline">\(С = 6\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>З картинки видно, що якщо тепер відкидати відхилення за <span class="math inline">\(Q \geqslant 20\)</span>, то необхідно відкидати й <span class="math inline">\(Q \leqslant 10\)</span>, а отже, загальна площа стовпців буде вже приблизно <span class="math inline">\(0.1\)</span>. Тому за рівня значущості <span class="math inline">\(0.05\)</span> й <span class="math inline">\(20\)</span> успіхів гіпотеза вже не відкинеться.</p>
<p>Якщо ж виставити <span class="math inline">\(C = 6\)</span>, то така область уже підходить, площа стовпців <span class="math inline">\(\approx 0.043 &lt; 0.05\)</span>.</p>
<p>Щоб вибрати порогову константу за формулою, можна помітити, що критична область симетрична, а значить праворуч площа не повинна бути більшою, ніж <span class="math inline">\(\frac{\alpha}{2}\)</span>. А таку задачу ми вже вміємо розв’язувати.</p>
<p>Реалізуємо функцію на Python.</p>
<div id="6daa2eea" class="cell" data-execution_count="19">
<div id="lst-find-crit-subs-two-sided" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-find-crit-subs-two-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.11: Знаходження критичного значення для двостороннього критерію
</figcaption>
<div aria-describedby="lst-find-crit-subs-two-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-find-crit-subs-two-sided"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-find-crit-subs-two-sided-1"><a href="#lst-find-crit-subs-two-sided-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_crit_subs_two_sided(n, mu, alpha):</span>
<span id="lst-find-crit-subs-two-sided-2"><a href="#lst-find-crit-subs-two-sided-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="lst-find-crit-subs-two-sided-3"><a href="#lst-find-crit-subs-two-sided-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Знаходить критичне значення для двостороннього критерію</span></span>
<span id="lst-find-crit-subs-two-sided-4"><a href="#lst-find-crit-subs-two-sided-4" aria-hidden="true" tabindex="-1"></a><span class="co">    :param n: кількість спостережень</span></span>
<span id="lst-find-crit-subs-two-sided-5"><a href="#lst-find-crit-subs-two-sided-5" aria-hidden="true" tabindex="-1"></a><span class="co">    :param mu: ймовірність успіху</span></span>
<span id="lst-find-crit-subs-two-sided-6"><a href="#lst-find-crit-subs-two-sided-6" aria-hidden="true" tabindex="-1"></a><span class="co">    :param alpha: рівень значущості</span></span>
<span id="lst-find-crit-subs-two-sided-7"><a href="#lst-find-crit-subs-two-sided-7" aria-hidden="true" tabindex="-1"></a><span class="co">    :return: критичне значення</span></span>
<span id="lst-find-crit-subs-two-sided-8"><a href="#lst-find-crit-subs-two-sided-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="lst-find-crit-subs-two-sided-9"><a href="#lst-find-crit-subs-two-sided-9" aria-hidden="true" tabindex="-1"></a>    binom_dist <span class="op">=</span> binom(n, mu)</span>
<span id="lst-find-crit-subs-two-sided-10"><a href="#lst-find-crit-subs-two-sided-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> binom_dist.ppf(alpha <span class="op">/</span> <span class="dv">2</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="lst-find-crit-subs-two-sided-11"><a href="#lst-find-crit-subs-two-sided-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-find-crit-subs-two-sided-12"><a href="#lst-find-crit-subs-two-sided-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-find-crit-subs-two-sided-13"><a href="#lst-find-crit-subs-two-sided-13" aria-hidden="true" tabindex="-1"></a>find_crit_subs_two_sided(<span class="dv">30</span>, <span class="fl">0.5</span>, <span class="fl">0.05</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>6.0</code></pre>
</div>
</div>
</section>
<section id="як-знайти-p-значення" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="як-знайти-p-значення"><span class="header-section-number">1.5.2</span> Як знайти <span class="math inline">\(p\)</span>-значення</h3>
<p>Критерій має вигляд</p>
<p><span class="math display">\[
S = \{|Q(\xi) - 15| \geqslant C\}
\]</span></p>
<p>Позначимо відхилення суми від 15 як <span class="math inline">\(\Delta(\xi) = |Q(\xi) - 15|\)</span>, тоді ми маємо критерій</p>
<p><span class="math display">\[
S = \{\Delta(\xi) \geqslant C\}
\]</span></p>
<p>Тобто більш екстремальними вважатимуться ті значення суми, що знаходяться далі від 15. Щоб обчислити <span class="math inline">\(p\)</span>-значення, доведеться порахувати суму площ із двох сторін окремо.</p>
<div id="35715700" class="cell" data-execution_count="20">
<div id="lst-p-value-two-sided" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-p-value-two-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.12: Обчислення <span class="math inline">\(p\)</span>-значення для двостороннього критерію
</figcaption>
<div aria-describedby="lst-p-value-two-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-p-value-two-sided"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-p-value-two-sided-1"><a href="#lst-p-value-two-sided-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pvalue_two_sided_sym(n, q):</span>
<span id="lst-p-value-two-sided-2"><a href="#lst-p-value-two-sided-2" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span>n, p<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="lst-p-value-two-sided-3"><a href="#lst-p-value-two-sided-3" aria-hidden="true" tabindex="-1"></a>    diff <span class="op">=</span> np.<span class="bu">abs</span>(q <span class="op">-</span> <span class="dv">15</span>)</span>
<span id="lst-p-value-two-sided-4"><a href="#lst-p-value-two-sided-4" aria-hidden="true" tabindex="-1"></a>    right_sq <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> binom_h0.cdf(<span class="dv">15</span> <span class="op">+</span> diff <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="lst-p-value-two-sided-5"><a href="#lst-p-value-two-sided-5" aria-hidden="true" tabindex="-1"></a>    left_sq <span class="op">=</span> binom_h0.cdf(<span class="dv">15</span> <span class="op">-</span> diff)</span>
<span id="lst-p-value-two-sided-6"><a href="#lst-p-value-two-sided-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> left_sq <span class="op">+</span> right_sq</span>
<span id="lst-p-value-two-sided-7"><a href="#lst-p-value-two-sided-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-p-value-two-sided-8"><a href="#lst-p-value-two-sided-8" aria-hidden="true" tabindex="-1"></a>pvalue_two_sided_sym(<span class="dv">30</span>, <span class="dv">21</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>0.04277394525706769</code></pre>
</div>
</div>
<p>Насправді через симетричність розподілу ліва і права площа виходять однаковими, тому можна порахувати площу з одного боку і помножити на 2.</p>
<div id="559feace" class="cell" data-execution_count="21">
<div id="lst-p-value-two-sided-simple" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-p-value-two-sided-simple-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.13: Обчислення <span class="math inline">\(p\)</span>-значення для двостороннього критерію (спрощено)
</figcaption>
<div aria-describedby="lst-p-value-two-sided-simple-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-p-value-two-sided-simple"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-p-value-two-sided-simple-1"><a href="#lst-p-value-two-sided-simple-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pvalue_two_sided_sym_simple(n, q):</span>
<span id="lst-p-value-two-sided-simple-2"><a href="#lst-p-value-two-sided-simple-2" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span>n, p<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="lst-p-value-two-sided-simple-3"><a href="#lst-p-value-two-sided-simple-3" aria-hidden="true" tabindex="-1"></a>    diff <span class="op">=</span> np.<span class="bu">abs</span>(q <span class="op">-</span> <span class="dv">15</span>)</span>
<span id="lst-p-value-two-sided-simple-4"><a href="#lst-p-value-two-sided-simple-4" aria-hidden="true" tabindex="-1"></a>    right_sq <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> binom_h0.cdf(<span class="dv">15</span> <span class="op">+</span> diff <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="lst-p-value-two-sided-simple-5"><a href="#lst-p-value-two-sided-simple-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> right_sq</span>
<span id="lst-p-value-two-sided-simple-6"><a href="#lst-p-value-two-sided-simple-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-p-value-two-sided-simple-7"><a href="#lst-p-value-two-sided-simple-7" aria-hidden="true" tabindex="-1"></a>pvalue_two_sided_sym_simple(<span class="dv">30</span>, <span class="dv">21</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>0.04277394525706768</code></pre>
</div>
</div>
<p>Тепер навіть у разі <span class="math inline">\(20\)</span> орлів <span class="math inline">\(p\)</span>-значення <span class="math inline">\(&gt; 0.05\)</span>, тому відкидати будемо значення, починаючи з <span class="math inline">\(21\)</span> й менші або такі, що дорівнюють <span class="math inline">\(9\)</span>.</p>
</section>
<section id="випадок-із-несиметричним-розподілом" class="level3" data-number="1.5.3">
<h3 data-number="1.5.3" class="anchored" data-anchor-id="випадок-із-несиметричним-розподілом"><span class="header-section-number">1.5.3</span> Випадок із несиметричним розподілом</h3>
<p>Коли розподіл за справедливості <span class="math inline">\(H_0\)</span> несиметричний, відхилення від очікуваного значення в різні боки можуть бути по-різному критичними. Як приклад розглянемо також біноміальний розподіл, але з імовірністю успіху <span class="math inline">\(0.8\)</span>.</p>
<p>Тоді можна ліву і праву критичні області побудувати окремо, виділивши на них по <span class="math inline">\(\frac{\alpha}{2}\)</span> площі. Праву область ми вже вміємо шукати, знайдемо ліву.</p>
<div id="cell-fig-binom-pmf-two-sided-nonsym" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>binom_h0_nonsym <span class="op">=</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>probs <span class="op">=</span> binom_h0_nonsym.pmf(np.arange(<span class="dv">31</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plt.bar(np.arange(<span class="dv">31</span>), probs, color<span class="op">=</span>turquoise, label<span class="op">=</span><span class="st">"Binom(30, 0.8)"</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-pmf-two-sided-nonsym" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-pmf-two-sided-nonsym-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-pmf-two-sided-nonsym-output-1.png" width="658" height="304" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-pmf-two-sided-nonsym-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.7: Біноміальний розподіл з імовірністю успіху <span class="math inline">\(0.8\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Для того, щоб побудувати двосторонній критерій, потрібно знайти ліворуч і праворуч області, площа яких становить не більше, ніж <span class="math inline">\(\frac{\alpha}{2}\)</span>. Для правого боку ми вже розв’язували таку задачу, розв’яжемо для лівого.</p>
<p>Шукаємо <span class="math inline">\(C\)</span>, таке що</p>
<p><span class="math display">\[
P(Q(\xi) \leqslant C) \leqslant \frac{\alpha}{2}
\]</span></p>
<p>Спочатку знайдемо перше число, де ймовірність <span class="math inline">\(\geqslant \frac{\alpha}{2}\)</span>. А це за визначенням <span class="math inline">\(\frac{\alpha}{2}\)</span>-квантиль. Достатньо взяти попереднє число, і воно буде задовольняти нашій умові.</p>
<div id="eaab477a" class="cell" data-execution_count="23">
<div id="lst-find-crit-subs-two-sided-nonsym" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-find-crit-subs-two-sided-nonsym-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.14: Знаходження критичного значення для двостороннього критерію
</figcaption>
<div aria-describedby="lst-find-crit-subs-two-sided-nonsym-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-find-crit-subs-two-sided-nonsym"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-find-crit-subs-two-sided-nonsym-1"><a href="#lst-find-crit-subs-two-sided-nonsym-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> two_sided_criterion_nonsym(n, mu, alpha):</span>
<span id="lst-find-crit-subs-two-sided-nonsym-2"><a href="#lst-find-crit-subs-two-sided-nonsym-2" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span>n, p<span class="op">=</span>mu)</span>
<span id="lst-find-crit-subs-two-sided-nonsym-3"><a href="#lst-find-crit-subs-two-sided-nonsym-3" aria-hidden="true" tabindex="-1"></a>    c2 <span class="op">=</span> binom_h0.ppf(<span class="dv">1</span> <span class="op">-</span> alpha<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="lst-find-crit-subs-two-sided-nonsym-4"><a href="#lst-find-crit-subs-two-sided-nonsym-4" aria-hidden="true" tabindex="-1"></a>    c1 <span class="op">=</span> binom_h0.ppf(alpha<span class="op">/</span><span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="lst-find-crit-subs-two-sided-nonsym-5"><a href="#lst-find-crit-subs-two-sided-nonsym-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c1, c2</span>
<span id="lst-find-crit-subs-two-sided-nonsym-6"><a href="#lst-find-crit-subs-two-sided-nonsym-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-find-crit-subs-two-sided-nonsym-7"><a href="#lst-find-crit-subs-two-sided-nonsym-7" aria-hidden="true" tabindex="-1"></a>two_sided_criterion_nonsym(<span class="dv">30</span>, <span class="fl">0.8</span>, <span class="fl">0.05</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>(18.0, 29.0)</code></pre>
</div>
</div>
<p>Отже, наш критерій для перевірки гіпотези</p>
<p><span class="math display">\[
H_0: \mu = 0.8
\]</span></p>
<p><span class="math display">\[
H_1: \mu \neq 0.8
\]</span></p>
<p>має вигляд</p>
<p><span class="math display">\[
S = \{Q(\xi) \leqslant 18\} \cup \{Q(\xi) \geqslant 29\}
\]</span></p>
<p>Тут межа <span class="math inline">\(29\)</span> уже має логічний вигляд, бо треба спростувати 80% орлів/успіхів, а для цього потрібна велика їхня кількість.</p>
<p>Зобразимо критичну область на графіку.</p>
<div id="cell-fig-binom-pmf-two-sided-nonsym-crit" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>C1, C2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, <span class="fl">0.8</span>, <span class="fl">0.05</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>plt.bar(np.arange(<span class="dv">31</span>), probs, color<span class="op">=</span>turquoise, label<span class="op">=</span><span class="st">"Binom(30, 0.8)"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.bar(np.arange(<span class="dv">31</span>)[np.arange(<span class="dv">31</span>) <span class="op">&lt;=</span> C1], probs[np.arange(<span class="dv">31</span>) <span class="op">&lt;=</span> C1], color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">"Критичне значення"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.bar(np.arange(<span class="dv">31</span>)[np.arange(<span class="dv">31</span>) <span class="op">&gt;=</span> C2], probs[np.arange(<span class="dv">31</span>) <span class="op">&gt;=</span> C2], color<span class="op">=</span>red_pink)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Кількість успішних випадків"</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Ймовірність"</span>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize <span class="op">=</span> <span class="st">'8'</span>, loc <span class="op">=</span> <span class="st">'upper left'</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-pmf-two-sided-nonsym-crit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-pmf-two-sided-nonsym-crit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-pmf-two-sided-nonsym-crit-output-1.png" width="532" height="361" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-pmf-two-sided-nonsym-crit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.8: Двостороння критична область для критерію <span class="math inline">\(C_1 = 18, C_2 = 29\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="p-значення-для-несиметричного-розподілу" class="level3" data-number="1.5.4">
<h3 data-number="1.5.4" class="anchored" data-anchor-id="p-значення-для-несиметричного-розподілу"><span class="header-section-number">1.5.4</span> <span class="math inline">\(p\)</span>-значення для несиметричного розподілу</h3>
<p>Цей критерій — об’єднання двох критеріїв рівня значущості <span class="math inline">\(\frac{\alpha}{2}\)</span>, для кожного з яких можна порахувати <span class="math inline">\(p\)</span>-значення. Позначимо їх як <span class="math inline">\(p_1, p_2\)</span>. Перший критерій відкидається при <span class="math inline">\(p_1 \leqslant \frac{\alpha}{2}\)</span>, другий при <span class="math inline">\(p_2 \leqslant \frac{\alpha}{2}\)</span>. А наш об’єднаний, коли виконано одну з цих умов, тобто</p>
<p><span class="math display">\[
2p_1 \leqslant \alpha \vee 2p_2 \leqslant \alpha \Leftrightarrow 2 \cdot \min(p_1, p_2) \leqslant \alpha
\]</span></p>
<p>Отже, можна рахувати <span class="math inline">\(p\)</span>-значення як <span class="math inline">\(2 \min(p_1, p_2)\)</span> й порівнювати з <span class="math inline">\(\alpha\)</span>.</p>
<p>Проведемо аналогію із симетричним випадком: якщо сума опинилася в лівій частині, то потрібно порахувати <span class="math inline">\(p\)</span>-значення лівого критерію і помножити на 2. Якщо сума опинилася в правій частині, то потрібно порахувати <span class="math inline">\(p\)</span>-значення правого критерію і помножити на 2.</p>
<div id="278d2439" class="cell" data-execution_count="25">
<div id="lst-p-value-two-sided-nonsym" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-p-value-two-sided-nonsym-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.15: Обчислення <span class="math inline">\(p\)</span>-значення для двостороннього критерію з несиметричним розподілом
</figcaption>
<div aria-describedby="lst-p-value-two-sided-nonsym-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-p-value-two-sided-nonsym"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-p-value-two-sided-nonsym-1"><a href="#lst-p-value-two-sided-nonsym-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pvalue_two_sided(n, q, mu<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="lst-p-value-two-sided-nonsym-2"><a href="#lst-p-value-two-sided-nonsym-2" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span>n, p<span class="op">=</span>mu)</span>
<span id="lst-p-value-two-sided-nonsym-3"><a href="#lst-p-value-two-sided-nonsym-3" aria-hidden="true" tabindex="-1"></a>    pvalue_left <span class="op">=</span> binom_h0.cdf(q)</span>
<span id="lst-p-value-two-sided-nonsym-4"><a href="#lst-p-value-two-sided-nonsym-4" aria-hidden="true" tabindex="-1"></a>    pvalue_right <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> binom_h0.cdf(q <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="lst-p-value-two-sided-nonsym-5"><a href="#lst-p-value-two-sided-nonsym-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">min</span>(pvalue_left, pvalue_right)</span>
<span id="lst-p-value-two-sided-nonsym-6"><a href="#lst-p-value-two-sided-nonsym-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-p-value-two-sided-nonsym-7"><a href="#lst-p-value-two-sided-nonsym-7" aria-hidden="true" tabindex="-1"></a>pvalue_two_sided(<span class="dv">30</span>, <span class="dv">28</span>, <span class="fl">0.8</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0.08835797030399428</code></pre>
</div>
</div>
<p>Видно, що <span class="math inline">\(p\)</span>-значення <span class="math inline">\(&gt; 0.05\)</span>, отже, на рівні значущості <span class="math inline">\(0.05\)</span> навіть <span class="math inline">\(28\)</span> успіхів недостатньо, щоб відкинути ймовірність успіху в <span class="math inline">\(80\%\)</span>.</p>
<p>Зауважимо, що ця ж функція працює і для симетричного випадку, повертаючи той самий результат.</p>
<div id="b63dad6d" class="cell" data-execution_count="26">
<div id="lst-p-value-two-sided-sym" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-p-value-two-sided-sym-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.16: Обчислення <span class="math inline">\(p\)</span>-значення для двостороннього критерію з симетричним розподілом
</figcaption>
<div aria-describedby="lst-p-value-two-sided-sym-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-p-value-two-sided-sym"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-p-value-two-sided-sym-1"><a href="#lst-p-value-two-sided-sym-1" aria-hidden="true" tabindex="-1"></a>pvalue_two_sided(n<span class="op">=</span><span class="dv">30</span>, q<span class="op">=</span><span class="dv">20</span>, mu<span class="op">=</span><span class="fl">0.5</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0.09873714670538902</code></pre>
</div>
</div>
<div id="4e58b8d0" class="cell" data-execution_count="27">
<div id="lst-p-value-two-sided-sym-20" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-p-value-two-sided-sym-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.17: Знаходження <span class="math inline">\(p\)</span>-значення для двостороннього критерію
</figcaption>
<div aria-describedby="lst-p-value-two-sided-sym-20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-p-value-two-sided-sym-20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-p-value-two-sided-sym-20-1"><a href="#lst-p-value-two-sided-sym-20-1" aria-hidden="true" tabindex="-1"></a>pvalue_two_sided_sym(n<span class="op">=</span><span class="dv">30</span>, q<span class="op">=</span><span class="dv">20</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>0.09873714670538904</code></pre>
</div>
</div>
</section>
</section>
<section id="готові-функції" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="готові-функції"><span class="header-section-number">1.6</span> Готові функції</h2>
<p>Звісно, можна використати готові функції з бібліотеки <code>scipy</code>. Для цього використаємо функцію <code>binomtest</code>, котра має параметри:</p>
<ul>
<li><code>k</code> — кількість успіхів</li>
<li><code>n</code> — кількість спостережень</li>
<li><code>p</code> — ймовірність успіху</li>
<li><code>alternative</code> — тип гіпотези:
<ul>
<li><code>two-sided</code>: двостороння</li>
<li><code>greater</code>: правостороння</li>
<li><code>less</code>: лівостороння</li>
</ul></li>
</ul>
<div id="93eea74b" class="cell" data-execution_count="28">
<div id="lst-python-binomtest" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-python-binomtest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.18: Використання функції <code>binomtest</code> для перевірки гіпотези
</figcaption>
<div aria-describedby="lst-python-binomtest-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-python-binomtest"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-python-binomtest-1"><a href="#lst-python-binomtest-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> binomtest</span>
<span id="lst-python-binomtest-2"><a href="#lst-python-binomtest-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-python-binomtest-3"><a href="#lst-python-binomtest-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> binomtest(<span class="dv">19</span>, <span class="dv">30</span>, <span class="fl">0.5</span>, alternative<span class="op">=</span><span class="st">'two-sided'</span>)</span>
<span id="lst-python-binomtest-4"><a href="#lst-python-binomtest-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-python-binomtest-5"><a href="#lst-python-binomtest-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Статистика: </span><span class="sc">{</span>result<span class="sc">.</span>statistic<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="lst-python-binomtest-6"><a href="#lst-python-binomtest-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"p-значення: </span><span class="sc">{</span>result<span class="sc">.</span>pvalue<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Статистика: 0.6333333333333333
p-значення: 0.20048842206597334</code></pre>
</div>
</div>
</section>
<section id="статистична-потужність" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="статистична-потужність"><span class="header-section-number">1.7</span> Статистична потужність</h2>
<section id="хибно-негативні-помилки" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="хибно-негативні-помилки"><span class="header-section-number">1.7.1</span> Хибно негативні помилки</h3>
<p>Раніше під час побудови критеріїв ми звертали увагу тільки на <span class="math inline">\(\alpha\)</span>, рівень значущості критерію. Але цей параметр контролює лише хибнопозитивну помилку (False Positive), а саме ймовірність, що критерій прийме <span class="math inline">\(H_1\)</span> за умови вірності <span class="math inline">\(H_0\)</span>.</p>
<p>Але є ще один вид помилок, які може допустити критерій — хибно негативні помилки (False Negative). Це випадки, коли критерій приймає <span class="math inline">\(H_0\)</span> за умови вірності <span class="math inline">\(H_1\)</span>. Це важливо, оскільки вони можуть вказувати на те, що критерій не чутливий до змін, які відбуваються в даних.</p>
<p>Випадок, коли ймовірність FPR <span class="math inline">\(&lt; \alpha\)</span>, але при цьому ймовірність хибно негативні помилки (False Negative Rate, FNR) величезна, можна навести легко. Для цього достатньо <strong>ніколи</strong> не відкидати гіпотезу, взявши критерій <span class="math inline">\(S \equiv 0\)</span>.</p>
<p>Наведемо приклад, коли помилки False Negative відбуваються не завжди, але критерії є все одно нечутливими.</p>
</section>
<section id="критерій-пори-року" class="level3" data-number="1.7.2">
<h3 data-number="1.7.2" class="anchored" data-anchor-id="критерій-пори-року"><span class="header-section-number">1.7.2</span> Критерій пори року</h3>
<p>Поставимо гіпотезу про те, що зараз на вулиці літо. Для перевірки можна було б, звісно, подивитися в календар, але ми зробимо інакше.</p>
<p><span class="math display">\[
H_0: \text{ на вулиці літо}
\]</span></p>
<p><span class="math display">\[
H_1: \text{ на вулиці не літо}
\]</span></p>
<p>Подивимося у вікно і визначимо, чи йде там сніг. Якщо він йде, то це непоганий доказ того, що зараз не літо, а отже можна відкинути <span class="math inline">\(H_0\)</span>.</p>
<p>Порахуємо FPR та FNR для цього критерію. Ми знаємо, що влітку сніг іде дуже рідко (ймовірність помилки нижча за <span class="math inline">\(0.1\%\)</span>), тож це точно критерій рівня значущості <span class="math inline">\(0.001\)</span>, чого зазвичай достатньо для критеріїв.</p>
<p><span class="math display">\[
FPR(S) = P(\text{йде сніг}\ |\ \text{сьогодні літо}) &lt; 0.001
\]</span></p>
<p>Але що з FNR? Розглянемо конкретний випадок: зараз вересень. Оскільки у вересні майже завжди немає снігу, можна сказати, що FNR більша за <span class="math inline">\(90\%\)</span>, отже, цей критерій насправді мало дієвий.</p>
<p><span class="math display">\[
FNR(S) = P(\text{не йде сніг}\ |\ \text{зараз вересень}) &gt; 0.9
\]</span></p>
<p>Сформулюємо інший критерій рівня значущості <span class="math inline">\(\alpha\)</span>, причому в цьому разі рівень значущості можна вибрати довільним.</p>
<p><span class="math display">\[
S(\xi) = \begin{cases}
    1, \text{ якщо монетка з імовірністю орла } \alpha \text{ випала орлом} \\
    0, \text{ інакше}
\end{cases}
\]</span></p>
<p>Виходить, цей критерій випадковий, і він не використовує взагалі жодної інформації про погоду. Однак вимогам до рівня значущості він задовольняє.</p>
<p><span class="math display">\[
FPR = P(\text{випав орел}\ |\ \text{сьогодні літо}) = P(\text{випав орел}) = \alpha
\]</span></p>
<p>Обчислимо FNR.</p>
<p><span class="math display">\[
FNR = P(\text{не випав орел}\ |\ \text{сьогодні не літо}) = P(\text{не випав орел}) = 1 - \alpha
\]</span></p>
<p>За <span class="math inline">\(\alpha = 0.001\)</span>, як у першому випадку, отримуємо ймовірність FNR <span class="math inline">\(0.999 &gt; 0.9\)</span>, тобто за однакового рівня значущості з першим критерієм, другий критерій частіше припускається хибно негативної помилки.</p>
</section>
<section id="потужність" class="level3" data-number="1.7.3">
<h3 data-number="1.7.3" class="anchored" data-anchor-id="потужність"><span class="header-section-number">1.7.3</span> Потужність</h3>
<p>У статистиці заведено позитивним результатом вважати відкидання нульової гіпотези, бо зазвичай підтвердження альтернативи означає наявність бізнес-результату. Тому вважається хорошим критерій, який частіше дає змогу виявити бізнес-результат. І рахують тоді не ймовірність хибно негативної помилки, а <em>потужність</em>, що дорівнює ймовірності відкинути нульову гіпотезу за вірності <span class="math inline">\(H_1\)</span>, тобто ймовірність <strong>істинно позитивного результату</strong> (True Positive Rate, TPR).</p>
<p><span id="eq-power"><span class="math display">\[
\text{Power}_S = 1 - FNR
\tag{1.1}\]</span></span></p>
<p>Коли альтернатива <span class="math inline">\(H_1\)</span> складається з множини результатів, потужність розглядають як функцію від результату. Наприклад, можна порахувати потужність першого та другого критеріїв взимку й восени.</p>
<p><span class="math display">\[
\text{Power}_S(\mu) = 1 - FNR(\mu)
\]</span></p>
<p><strong>Перший критерій</strong></p>
<p><span class="math display">\[
\text{Power}_S(\text{травень}) = P(\text{їде сніг } | \text{ травень}) \approx 0.00001
\]</span></p>
<p><span class="math display">\[
\text{Power}_S(\text{жовтень}) = P(\text{їде сніг } | \text{ жовтень}) \approx 0.1
\]</span></p>
<p><span class="math display">\[
\text{Power}_S(\text{січень}) = P(\text{їде сніг } | \text{ січень}) \approx 0.5
\]</span></p>
<p><strong>Другий критерій</strong></p>
<p><span class="math display">\[
\text{Power}_S(\text{травень}) = P(\text{випав орел } | \text{ травень}) = \alpha = 0.001
\]</span></p>
<p><span class="math display">\[
\text{Power}_S(\text{жовтень}) = P(\text{випав орел } | \text{ жовтень}) = \alpha = 0.001
\]</span></p>
<p><span class="math display">\[
\text{Power}_S(\text{січень}) = P(\text{випав орел } | \text{ січень}) = \alpha = 0.001
\]</span></p>
<p>Зазвичай завдання пошуку найкращого критерію формулюється як пошук якомога потужнішого критерію за заданого рівня значущості <span class="math inline">\(FPR \leqslant \alpha\)</span>. Але ми сказали, що потужність — функція від параметра, у нашому випадку від місяця.</p>
<p>Якщо ми застосовуватимемо критерій у січні, то потужнішим буде перший критерій, а якщо в травні, то потужнішим буде другий критерій. Тому потрібно розуміти, коли буде застосовуватися критерій, а отже, ми шукаємо найпотужніший критерій у галузі, яка нас цікавить.</p>
<p>Хоча в реальності в травні потужність обох критеріїв настільки низька, що вони просто не приносять користі, й використовувати їх не має сенсу.</p>
</section>
</section>
<section id="потужність-для-біноміального-розподілу" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="потужність-для-біноміального-розподілу"><span class="header-section-number">1.8</span> Потужність для біноміального розподілу</h2>
<p>Застосуємо нові знання про потужність для нашої задачі з освітнім сервісом. З бізнес-міркувань ми вже вибрали <span class="math inline">\(\alpha = 0.05\)</span>, а отже, знаємо, що ми неправильно відкидаємо гіпотезу <span class="math inline">\(H_0:\ \mu = 0.5\)</span> з ймовірністю не більше, ніж <span class="math inline">\(5\%\)</span>. Тобто цим обмежена ймовірність хибно позитивної помилки.</p>
<p>А з якою ймовірністю ми будемо <em>правильно</em> відкидати гіпотезу? І яка в нас буде ймовірність хибно негативної помилки? На це запитання якраз відповість формула потужності.</p>
<p>Згадаймо критерій, за яким ми приймаємо рішення:</p>
<p><span class="math display">\[
Q(\xi) = \sum\limits_{i=1}^n \xi_i - \text{кількість підписок}
\]</span></p>
<p><span class="math display">\[
S = \{Q \geqslant 20\}
\]</span></p>
<p>Тобто якщо отримуємо хоча б <span class="math inline">\(20\)</span> успішних підписок, то відкидаємо <span class="math inline">\({H}_0\)</span>.</p>
<p>Зауважимо, що потужність залежить від того, яке значення <span class="math inline">\(\mu\)</span> у нашій генеральній сукупності. Зафіксуємо спочатку параметр <span class="math inline">\(\mu = 0.6\)</span> й порахуємо потужність для нього. Якщо істинний параметр такий, то статистика <span class="math inline">\(Q\)</span> має розподіл <span class="math inline">\(Binom(30, 0.6)\)</span>.</p>
<div id="cell-fig-binom-power" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>binom_h0 <span class="op">=</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>binom_alternative <span class="op">=</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>x_grid <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="dv">31</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>crit_reg <span class="op">=</span> x_grid <span class="op">&gt;=</span> <span class="dv">20</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>probs_h0 <span class="op">=</span> binom_h0.pmf(x_grid)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>plt.bar(x_grid, probs_h0, color<span class="op">=</span>turquoise, label<span class="op">=</span><span class="st">'PMF, $Binom(0.5, 30)$'</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>probs_alternative <span class="op">=</span> binom_alternative.pmf(x_grid)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>plt.bar(x_grid, probs_alternative, color<span class="op">=</span>slate, label<span class="op">=</span><span class="st">'PMF, $Binom(0.6, 30)$'</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>plt.bar(x_grid[crit_reg], probs_alternative[crit_reg], color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Критична область'</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>plt.legend(fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-power" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-power-output-1.png" width="652" height="304" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.9: Потужність критерію для <span class="math inline">\(\mu = 0.6\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Як і раніше, нас цікавить імовірність отримати <span class="math inline">\(20\)</span> або більше успіхів. Але якщо раніше ми дивилися на неї для розподілу з <span class="math inline">\(\mu=0.5\)</span> й хотіли, щоб вона була меншою за <span class="math inline">\(5\%\)</span>, то тепер ми дивимося за <span class="math inline">\(\mu = 0.6\)</span> та прагнемо зробити цю величину якомога більшою. Порівняно з обчисленням FPR формула не зміниться, змінюється тільки <span class="math inline">\(\mu\)</span></p>
<div id="60369afd" class="cell" data-execution_count="30">
<div id="lst-binom-power" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.19: Обчислення потужності критерію
</figcaption>
<div aria-describedby="lst-binom-power-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-power"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-power-1"><a href="#lst-binom-power-1" aria-hidden="true" tabindex="-1"></a>critical_value <span class="op">=</span> <span class="dv">20</span></span>
<span id="lst-binom-power-2"><a href="#lst-binom-power-2" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span><span class="fl">0.6</span>).cdf(critical_value <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="lst-binom-power-3"><a href="#lst-binom-power-3" aria-hidden="true" tabindex="-1"></a>fpr   <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span><span class="fl">0.5</span>).cdf(critical_value <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="lst-binom-power-4"><a href="#lst-binom-power-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-power-5"><a href="#lst-binom-power-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Хибно позитивна помилка: </span><span class="sc">{</span>fpr<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="lst-binom-power-6"><a href="#lst-binom-power-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Потужність: </span><span class="sc">{</span>power<span class="sc">:.1%}</span><span class="ss">"</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Хибно позитивна помилка: 4.9%
Потужність: 29.1%</code></pre>
</div>
</div>
<p>Видно, що потужність близько <span class="math inline">\(30\%\)</span>. Це досить маленьке значення, адже якщо наш продукт прибутковий, то ми побачимо це за допомогою нашого тесту тільки з імовірністю в <span class="math inline">\(30\)</span> відсотків. Ми легко можемо пропустити ефект.</p>
<p>Що ж можна зробити, щоб зробити потужність вищою? Щоб розібратися, реалізуємо функцію потужності в загальному вигляді.</p>
<div id="0344e3ba" class="cell" data-execution_count="31">
<div id="lst-binom-power-general" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-power-general-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.20: Обчислення потужності критерію для загального випадку
</figcaption>
<div aria-describedby="lst-binom-power-general-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-power-general"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-power-general-1"><a href="#lst-binom-power-general-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_stat_power(N, mu_h0, mu_alternative, alpha):</span>
<span id="lst-binom-power-general-2"><a href="#lst-binom-power-general-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''Обчислює статистичну потужність критерію для біноміального розподілу</span></span>
<span id="lst-binom-power-general-3"><a href="#lst-binom-power-general-3" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="lst-binom-power-general-4"><a href="#lst-binom-power-general-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Параметри:</span></span>
<span id="lst-binom-power-general-5"><a href="#lst-binom-power-general-5" aria-hidden="true" tabindex="-1"></a><span class="co">        N - кількість бернуллієвських експериментів (розмір вибірки)</span></span>
<span id="lst-binom-power-general-6"><a href="#lst-binom-power-general-6" aria-hidden="true" tabindex="-1"></a><span class="co">        mu_h0 - імовірність успіху в нульовій гіпотезі</span></span>
<span id="lst-binom-power-general-7"><a href="#lst-binom-power-general-7" aria-hidden="true" tabindex="-1"></a><span class="co">        mu_alternative - передбачувана ймовірність успіху в експерименті</span></span>
<span id="lst-binom-power-general-8"><a href="#lst-binom-power-general-8" aria-hidden="true" tabindex="-1"></a><span class="co">        alpha - рівень значущості критерію</span></span>
<span id="lst-binom-power-general-9"><a href="#lst-binom-power-general-9" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="lst-binom-power-general-10"><a href="#lst-binom-power-general-10" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span>N, p<span class="op">=</span>mu_h0)</span>
<span id="lst-binom-power-general-11"><a href="#lst-binom-power-general-11" aria-hidden="true" tabindex="-1"></a>    binom_alternative <span class="op">=</span> binom(n<span class="op">=</span>N, p<span class="op">=</span>mu_alternative)</span>
<span id="lst-binom-power-general-12"><a href="#lst-binom-power-general-12" aria-hidden="true" tabindex="-1"></a>    critical_value <span class="op">=</span> binom_h0.ppf(<span class="dv">1</span> <span class="op">-</span> alpha) <span class="op">+</span> <span class="dv">1</span></span>
<span id="lst-binom-power-general-13"><a href="#lst-binom-power-general-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="op">-</span> binom_alternative.cdf(critical_value <span class="op">-</span> <span class="dv">1</span>) </span>
<span id="lst-binom-power-general-14"><a href="#lst-binom-power-general-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-power-general-15"><a href="#lst-binom-power-general-15" aria-hidden="true" tabindex="-1"></a>get_stat_power(<span class="dv">30</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, alpha<span class="op">=</span><span class="fl">0.05</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>0.2914718612234968</code></pre>
</div>
</div>
<p>Коли в житті ми спостерігаємо якесь явище і бачимо його лише кілька разів, ми не впевнені в тому, що воно не випадкове. Якщо ж бачимо його досить часто, то вже складаємо закономірності. Так і в статистиці. Коли ми подивилися на 30 потенційних підписок, ми помічаємо, що частка доставок більше половини. Але ми все ще не впевнені. Щоб отримати більше впевненості, потрібно провести більше спостережень, тобто знайти більше пробних клієнтів.</p>
<p>Подивимося, що буде, якщо ми проведемо експеримент на 300 клієнтах.</p>
<div id="75d81dcb" class="cell" data-execution_count="32">
<div id="lst-binom-power-general-300" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-power-general-300-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.21: Обчислення потужності критерію для 300 клієнтів
</figcaption>
<div aria-describedby="lst-binom-power-general-300-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-power-general-300"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-power-general-300-1"><a href="#lst-binom-power-general-300-1" aria-hidden="true" tabindex="-1"></a>get_stat_power(<span class="dv">300</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, alpha<span class="op">=</span><span class="fl">0.05</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>0.9655326717180749</code></pre>
</div>
</div>
<p>Бачимо, що потужність уже дуже близька до <span class="math inline">\(100\%\)</span>. Але провести 300 пробних занять набагато затратніше, ніж 30. І за ресурсами, і за часом. Тому зазвичай балансують між потужністю і тривалістю/витратами експерименту.</p>
<p>Прийнято вважати, що прийнятною для роботи потужністю вважається <span class="math inline">\(80\%\)</span>. Подивимося, як змінюється потужність при зростанні розміру вибірки, і скільки потрібно провести експериментів, щоб детектувати ефект при <span class="math inline">\(\mu = 0.6\)</span> у <span class="math inline">\(80\%\)</span> випадків.</p>
<div id="cell-fig-binom-power-n" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>n_grid <span class="op">=</span> np.arange(<span class="dv">10</span>, <span class="dv">600</span>, <span class="dv">10</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> get_stat_power(n_grid, <span class="fl">0.5</span>, <span class="fl">0.6</span>, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Кількість пробних занять'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Потжність'</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.plot(n_grid, power, color<span class="op">=</span>turquoise)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="fl">0.8</span>, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Потужність = 80%'</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>min_n <span class="op">=</span> n_grid[power <span class="op">&gt;=</span> <span class="fl">0.8</span>].<span class="bu">min</span>()</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>plt.axvline(min_n, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>slate, label<span class="op">=</span><span class="ss">f'N = </span><span class="sc">{</span>min_n<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-power-n" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-power-n-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-power-n-output-1.png" width="666" height="324" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-power-n-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.10: Залежність потужності від розміру вибірки для <span class="math inline">\(\mu = 0.6\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Бачимо, що для потужності в <span class="math inline">\(80\%\)</span> достатньо набрати 160 пробних занять.</p>
<p>А що, якщо ми хочемо детектувати ще менший ефект? Наприклад, якщо хочемо відкидати гіпотезу за <span class="math inline">\(\mu = 0.51\)</span>. Часто поліпшення ймовірності успіху на <span class="math inline">\(1\%\)</span> може бути значущим для продукту, тому це питання не позбавлене сенсу.</p>
<div id="cell-fig-binom-power-n-51" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>n_grid <span class="op">=</span> np.arange(<span class="dv">10</span>, <span class="dv">30000</span>, <span class="dv">59</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> get_stat_power(n_grid, <span class="fl">0.5</span>, <span class="fl">0.51</span>, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Кількість пробних занять'</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Потжність'</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>plt.plot(n_grid, power, color<span class="op">=</span>turquoise)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="fl">0.8</span>, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Потужність = 80%'</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>min_n <span class="op">=</span> n_grid[power <span class="op">&gt;=</span> <span class="fl">0.8</span>].<span class="bu">min</span>()</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>plt.axvline(min_n, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>slate, label<span class="op">=</span><span class="ss">f'N = </span><span class="sc">{</span>min_n<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-power-n-51" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-power-n-51-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-power-n-51-output-1.png" width="661" height="319" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-power-n-51-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.11: Залежність потужності від розміру вибірки для <span class="math inline">\(\mu = 0.51\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>Бачимо, що потрібно понад 15 тисяч клієнтів, щоб детектувати такий ефект! Дуже складно знайти стільки пробних клієнтів. Але потрібно замислитися над питанням, а чи варто це робити? У нашому випадку, якщо ймовірність успіху <span class="math inline">\(51\%\)</span>, то прибуток із замовлень буде невеликий, і вкладення інвесторів, звісно, окупатимуться, але дуже довго. Тому збільшення на <span class="math inline">\(1%\)</span> для нашого завдання не значуще <em>практично</em>, а отже, не потрібно намагатися набирати 15 тисяч людей, а можна зупинитися і на 160.</p>
<p>Перед кожним експериментом аналітику варто замислюватися над питанням тривалості тесту і кількості учасників. Для цього потрібно зрозуміти:</p>
<ul>
<li>Який ефект є для завдання практично значущим?</li>
<li>Скільки знадобиться випробовуваних, щоб детектувати цей ефект частіше, ніж у <span class="math inline">\(80\%\)</span> випадків?</li>
</ul>
<p>З графіків видно, що для детектування меншого ефекту потрібен більший розмір вибірки. Подивимося, як для фіксованого <span class="math inline">\(N=30\)</span> змінюється потужність для різних параметрів <span class="math inline">\(\mu\)</span>.</p>
<div id="cell-fig-binom-power-mu" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.linspace(<span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="dv">100</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>power <span class="op">=</span> get_stat_power(<span class="dv">30</span>, <span class="fl">0.5</span>, mu_grid, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Ймовірність успіху'</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Потужність'</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>plt.plot(mu_grid, power, color<span class="op">=</span>turquoise)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="fl">0.8</span>, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Потужність = 80%'</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>min_mu <span class="op">=</span> mu_grid[power <span class="op">&gt;=</span> <span class="fl">0.8</span>].<span class="bu">min</span>()</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>plt.axvline(min_mu, ls<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span>slate, label<span class="op">=</span><span class="ss">f'$\mu = </span><span class="sc">{</span>min_mu<span class="sc">:.2f}</span><span class="ss">$'</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-binom-power-mu" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-power-mu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-power-mu-output-1.png" width="666" height="327" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-power-mu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.12: Залежність потужності від параметра <span class="math inline">\(\mu\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>У нашому експерименті ми добре детектуємо ефект, тільки якщо ймовірність успіху в генеральній сукупності хоча б <span class="math inline">\(72\%\)</span>.</p>
</section>
<section id="мінімальна-величина-ефекту" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="мінімальна-величина-ефекту"><span class="header-section-number">1.9</span> Мінімальна величина ефекту</h2>
<p>Вище на <a href="#fig-binom-power-mu" class="quarto-xref">Рисунок&nbsp;<span>1.12</span></a> ми побачили, що з хорошою потужністю понад <span class="math inline">\(80\%\)</span> ми можемо помітити ефект у <span class="math inline">\(22\)</span> процентних пункти. Причому це можна порахувати навіть до проведення експерименту. У нашому випадку таке збільшення успішності щодо <span class="math inline">\(0.5\)</span> цілком можливо, і з ним можна працювати. Але коли аналітики перевіряють зміни, найчастіше очікуваний ефект коливається в районі одного, максимум двох відсотків! Для подібних змін не підійде обрана постановка експерименту, а значить і проводити його не має сенсу.</p>
<p>Тому перед запуском експериментів аналітики повідомляють <strong>мінімальну величину ефекту, яку можна задетектувати</strong> (Minimal Detectable Effect, MDE). У нашому випадку <span class="math inline">\(MDE = +22\)</span> процентних пункти.</p>
<p>Більш формально, MDE для гіпотези <span class="math inline">\(H_0: \mu = \mu_0\)</span> — це мінімальний ефект <span class="math inline">\(\delta\)</span>, за якого критерій рівня значущості <span class="math inline">\(\alpha\)</span> для перевірки цієї гіпотези за істинного параметра <span class="math inline">\(\mu = \mu_0 + \delta\)</span> та розміру вибірки <span class="math inline">\(N\)</span> відкидатиме <span class="math inline">\({H}_0\)</span> з потужністю більшою, ніж <span class="math inline">\(1 - \beta\)</span>.</p>
<p>Найчастіше беруть <span class="math inline">\(1 - \beta = 80\%\)</span>. Напишемо функцію, яка обчислюватиме MDE підбором.</p>
<div id="d196fc75" class="cell" data-execution_count="36">
<div id="lst-binom-mde" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-mde-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.22: Обчислення MDE
</figcaption>
<div aria-describedby="lst-binom-mde-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-mde"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-mde-1"><a href="#lst-binom-mde-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> binom_test_mde_one_sided(N, mu0, alpha<span class="op">=</span><span class="fl">0.05</span>, min_power<span class="op">=</span><span class="fl">0.8</span>):</span>
<span id="lst-binom-mde-2"><a href="#lst-binom-mde-2" aria-hidden="true" tabindex="-1"></a>    delta_grid <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">1</span> <span class="op">-</span> mu0, <span class="dv">500</span>) </span>
<span id="lst-binom-mde-3"><a href="#lst-binom-mde-3" aria-hidden="true" tabindex="-1"></a>    power <span class="op">=</span> get_stat_power(N, mu0, mu0 <span class="op">+</span> delta_grid, alpha<span class="op">=</span>alpha)</span>
<span id="lst-binom-mde-4"><a href="#lst-binom-mde-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># выберем подходящие delta и вернем первую</span></span>
<span id="lst-binom-mde-5"><a href="#lst-binom-mde-5" aria-hidden="true" tabindex="-1"></a>    fit_delta <span class="op">=</span> delta_grid[power <span class="op">&gt;=</span> min_power]</span>
<span id="lst-binom-mde-6"><a href="#lst-binom-mde-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fit_delta[<span class="dv">0</span>]</span>
<span id="lst-binom-mde-7"><a href="#lst-binom-mde-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-mde-8"><a href="#lst-binom-mde-8" aria-hidden="true" tabindex="-1"></a>binom_test_mde_one_sided(<span class="dv">30</span>, <span class="fl">0.5</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>0.21843687374749496</code></pre>
</div>
</div>
<p>Результат збігається з обчисленнями за графіком <a href="#fig-binom-power-mu" class="quarto-xref">Рисунок&nbsp;<span>1.12</span></a>. Тобто ми можемо детектувати ефект у <span class="math inline">\(22\)</span> процентних пункти.</p>
<p>Зазвичай MDE розраховують не просто так, а нерозривно з ним іде питання про визначення <strong>розміру вибірки</strong>.</p>
<p>У нашому завданні ми знайшли <span class="math inline">\(30\)</span> клієнтів, не обчислюючи спочатку, скільки їх знадобиться. Але що якщо отриманий MDE занадто великий й потрібно зробити його меншим, оскільки очікувані зміни набагато менші? Тоді вирішується зворотне завдання, За необхідним MDE визначити обсяг вибірки. Якщо ми говоримо, що хочемо детектувати +10 в.п., тобто 60% успішних підписок, то потрібно знайти 160 тестових клієнтів, це видно з попередніх графіків. Якщо 30 осіб нам, наприклад, шукати місяць, такий тест може затягнутися майже на півроку. Тому варто подумати про те, щоб виділити додаткові ресурси на пошук клієнтів, наприклад, залучити маркетологів.</p>
</section>
<section id="довірчі-інтервали" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="довірчі-інтервали"><span class="header-section-number">1.10</span> Довірчі інтервали</h2>
<p>Раніше ми навчилися перевіряти гіпотезу <span class="math inline">\({H}_0: \mu = 0.5\)</span>. Як відповідь ми отримуємо лише вердикт “відкидаємо <span class="math inline">\({H}_0\)</span>” або “не відкидаємо <span class="math inline">\({H}_0\)</span>”. Однак у вибірці міститься набагато більше інформації, й ми можемо більше зрозуміти про параметр, ніж порівняння з числом <span class="math inline">\(0.5\)</span>.</p>
<p>Якщо гіпотеза <span class="math inline">\({H}_0\)</span> не відкидається, це означає, що значення <span class="math inline">\(\mu = 0.5\)</span> припустиме для нашої вибірки. Отримані значення можна пояснити значенням <span class="math inline">\(\mu = 0.5\)</span>. Але якщо у нас є механізм перевірки для будь-якого <span class="math inline">\(\mu\)</span>, ми можемо для всіх значень дізнатися, які з них допустимі, і отримати множину можливих значень <span class="math inline">\(\mu\)</span>. Така множина називається <em>довірчим інтервалом</em>.</p>
<p><strong>Довірчий інтервал</strong> рівня <span class="math inline">\(1 - \alpha\)</span> — множина значень параметра <span class="math inline">\(\mu_0\)</span>, для яких гіпотеза <span class="math inline">\(\mu = \mu_0\)</span> не відкидається критерієм рівня значущості <span class="math inline">\(\alpha\)</span>.</p>
<p>З визначення випливає, що різні критерії можуть породжувати різні довірчі інтервали. У цій частині розглянемо, які інтервали породжуються двостороннім критерієм. Для цього з кроком <span class="math inline">\(0.001\)</span> переберемо значення <span class="math inline">\(\mu \in [0, 1]\)</span> і перевіримо гіпотези.</p>
<div id="193d3f82" class="cell" data-execution_count="37">
<div id="lst-binom-ci" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.23: Довірчі інтервали для біноміального розподілу
</figcaption>
<div aria-describedby="lst-binom-ci-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci"><pre class="sourceCode code-annotation-code python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-1"><a href="#lst-binom-ci-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> two_sided_criterion_nonsym(n, mu, alpha):</span>
<span id="lst-binom-ci-2"><a href="#lst-binom-ci-2" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span>n, p<span class="op">=</span>mu)</span>
<span id="lst-binom-ci-3"><a href="#lst-binom-ci-3" aria-hidden="true" tabindex="-1"></a>    c2 <span class="op">=</span> binom_h0.ppf(<span class="dv">1</span> <span class="op">-</span> alpha<span class="op">/</span><span class="dv">2</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="lst-binom-ci-4"><a href="#lst-binom-ci-4" aria-hidden="true" tabindex="-1"></a>    c1 <span class="op">=</span> binom_h0.ppf(alpha<span class="op">/</span><span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="lst-binom-ci-5"><a href="#lst-binom-ci-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c1, c2</span>
<span id="lst-binom-ci-6"><a href="#lst-binom-ci-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-7"><a href="#lst-binom-ci-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-8"><a href="#lst-binom-ci-8" aria-hidden="true" tabindex="-1"></a>success_cnt <span class="op">=</span> <span class="dv">19</span></span>
<span id="lst-binom-ci-9"><a href="#lst-binom-ci-9" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="lst-binom-ci-10"><a href="#lst-binom-ci-10" aria-hidden="true" tabindex="-1"></a>mu_no_rejection <span class="op">=</span> []</span>
<span id="lst-binom-ci-11"><a href="#lst-binom-ci-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-12"><a href="#lst-binom-ci-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="lst-binom-ci-13"><a href="#lst-binom-ci-13" aria-hidden="true" tabindex="-1"></a>    c1, c2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-14"><a href="#lst-binom-ci-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> success_cnt <span class="op">&gt;</span> c1 <span class="kw">and</span> success_cnt <span class="op">&lt;</span> c2:</span>
<span id="lst-binom-ci-15"><a href="#lst-binom-ci-15" aria-hidden="true" tabindex="-1"></a>        mu_no_rejection.append(mu_h0)</span>
<span id="lst-binom-ci-16"><a href="#lst-binom-ci-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-17"><a href="#lst-binom-ci-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'95% довірчий інтервал: [</span><span class="sc">{</span><span class="bu">min</span>(mu_no_rejection)<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(mu_no_rejection)<span class="sc">}</span><span class="ss">]'</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>95% довірчий інтервал: [0.439 - 0.8]</code></pre>
</div>
</div>
<ol type="1">
<li>Функція, що обчислює критичні значення для двостороннього критерію.</li>
<li>Кількість успішних підписок.</li>
<li>Сітка значень <span class="math inline">\(\mu\)</span>.</li>
<li>Список значень <span class="math inline">\(\mu\)</span>, для яких гіпотеза не відкидається.</li>
<li>Перебір значень <span class="math inline">\(\mu\)</span>.</li>
</ol>
<p>Отримавши такий інтервал, ми відразу можемо зробити висновок, що гіпотеза <span class="math inline">\({H}_0: \mu = 0.5\)</span> не відкидається, оскільки <span class="math inline">\(0.5\)</span> лежить у довірчому інтервалі. Але при цьому відразу зрозуміло, що <span class="math inline">\(\mu \neq 0.4\)</span> на рівні значущості <span class="math inline">\(\alpha\)</span>.</p>
<p>Звичайно ж, у довірчому інтервалі лежить значення <span class="math inline">\(\mu = \frac{19}{30}\)</span>, для якого <span class="math inline">\(19\)</span> успіхів — це найбільш правдоподібний результат. При цьому інтервал несиметричний щодо точки <span class="math inline">\(\frac{19}{30}\)</span>.</p>
<p>Подивимося, як можна візуально знайти межу інтервалу. Ми отримали <span class="math inline">\(19\)</span> успіхів. Для кожного <span class="math inline">\(\mu_0\)</span> статистика <span class="math inline">\(Q\)</span> має розподіл <span class="math inline">\(Binom(30, \mu_0)\)</span>. Будемо малювати цей розподіл і дивитися, чи потрапляє <span class="math inline">\(19\)</span> у критичну область.</p>
<div id="cell-fig-binom-ci" class="cell" data-execution_count="38">
<div id="lst-binom-ci-plot" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.24: Довірчі інтервали для біноміального розподілу
</figcaption>
<div aria-describedby="lst-binom-ci-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-plot"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-plot-1"><a href="#lst-binom-ci-plot-1" aria-hidden="true" tabindex="-1"></a>mus_h0 <span class="op">=</span> [<span class="fl">0.2</span>, <span class="fl">0.438</span>, <span class="fl">0.439</span>, <span class="fl">0.8</span>, <span class="fl">0.81</span>, <span class="fl">0.9</span>]</span>
<span id="lst-binom-ci-plot-2"><a href="#lst-binom-ci-plot-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-plot-3"><a href="#lst-binom-ci-plot-3" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">10</span>))</span>
<span id="lst-binom-ci-plot-4"><a href="#lst-binom-ci-plot-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-plot-5"><a href="#lst-binom-ci-plot-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0, ax <span class="kw">in</span> <span class="bu">zip</span>(mus_h0, axes.flatten()):</span>
<span id="lst-binom-ci-plot-6"><a href="#lst-binom-ci-plot-6" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span>mu_h0)</span>
<span id="lst-binom-ci-plot-7"><a href="#lst-binom-ci-plot-7" aria-hidden="true" tabindex="-1"></a>    probs <span class="op">=</span> binom_h0.pmf(x_grid)</span>
<span id="lst-binom-ci-plot-8"><a href="#lst-binom-ci-plot-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-plot-9"><a href="#lst-binom-ci-plot-9" aria-hidden="true" tabindex="-1"></a>    ax.bar(x_grid, probs, color<span class="op">=</span>turquoise, label<span class="op">=</span><span class="ss">f'PMF, $Binom(</span><span class="sc">{</span>mu_h0<span class="sc">}</span><span class="ss">, 30)$'</span>)</span>
<span id="lst-binom-ci-plot-10"><a href="#lst-binom-ci-plot-10" aria-hidden="true" tabindex="-1"></a>    c1, c2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-plot-11"><a href="#lst-binom-ci-plot-11" aria-hidden="true" tabindex="-1"></a>    crit_reg <span class="op">=</span> (x_grid <span class="op">&lt;=</span> c1) <span class="op">|</span> (x_grid <span class="op">&gt;=</span> c2)</span>
<span id="lst-binom-ci-plot-12"><a href="#lst-binom-ci-plot-12" aria-hidden="true" tabindex="-1"></a>    ax.bar(x_grid[crit_reg], probs[crit_reg], color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Критична область'</span>)</span>
<span id="lst-binom-ci-plot-13"><a href="#lst-binom-ci-plot-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-plot-14"><a href="#lst-binom-ci-plot-14" aria-hidden="true" tabindex="-1"></a>    is_rejection <span class="op">=</span> success_cnt <span class="op">&lt;=</span> c1 <span class="kw">or</span> success_cnt <span class="op">&gt;=</span> c2</span>
<span id="lst-binom-ci-plot-15"><a href="#lst-binom-ci-plot-15" aria-hidden="true" tabindex="-1"></a>    ax.axvline(success_cnt, ls<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'Q = </span><span class="sc">{</span>success_cnt<span class="sc">}</span><span class="ss"> '</span> <span class="op">+</span> (<span class="st">'відхилено'</span> <span class="cf">if</span> is_rejection <span class="cf">else</span> <span class="st">'не видхилено'</span>), color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="lst-binom-ci-plot-16"><a href="#lst-binom-ci-plot-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-plot-17"><a href="#lst-binom-ci-plot-17" aria-hidden="true" tabindex="-1"></a>    rejection_prob <span class="op">=</span> probs[crit_reg].<span class="bu">sum</span>()</span>
<span id="lst-binom-ci-plot-18"><a href="#lst-binom-ci-plot-18" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'$\mu = </span><span class="sc">{</span>mu_h0<span class="sc">}</span><span class="ss">$'</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="lst-binom-ci-plot-19"><a href="#lst-binom-ci-plot-19" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display">
<div id="fig-binom-ci" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-ci-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-ci-output-1.png" width="658" height="802" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-ci-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.13: Довірчі інтервали для біноміального розподілу
</figcaption>
</figure>
</div>
</div>
</div>
<p>Видно, що зі зростанням <span class="math inline">\(\mu_0\)</span> гістограма зсувається вправо. І спочатку <span class="math inline">\(19\)</span> потрапляє в праву критичну область. Потім, починаючи з точки <span class="math inline">\(0.439\)</span>, значення <span class="math inline">\(19\)</span> вже опиняється поза критичною областю, і тільки з <span class="math inline">\(\mu_0 = 0.81\)</span> починає потрапляти в ліву критичну область.</p>
<p>Таким чином, ліва межа довірчого інтервалу — це перша точка, коли значення статистики перестало потрапляти до критичної області, а права межа - остання точка, коли значення не потрапляє до правої критичної області.</p>
</section>
<section id="односторонні-довірчі-інтервали" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="односторонні-довірчі-інтервали"><span class="header-section-number">1.11</span> Односторонні довірчі інтервали</h2>
<p>Насправді, двосторонній критерій потрібен вкрай рідко. Контролювати хибно похитивну помилку нам потрібно тільки для відхилень у бік, корисний для бізнесу. У випадку завдання з освітнім сервісом це отримання <em>більшої</em> конверсії в успіх.</p>
<p>Спробуємо скористатися одностороннім критерієм для побудови довірчого інтервалу.</p>
<div id="4b139e00" class="cell" data-execution_count="39">
<div id="lst-binom-ci-one-sided" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-one-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.25: Односторонні довірчі інтервали для біноміального розподілу
</figcaption>
<div aria-describedby="lst-binom-ci-one-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-one-sided"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-one-sided-1"><a href="#lst-binom-ci-one-sided-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_binom_criterion(n, mu<span class="op">=</span><span class="fl">0.5</span>, alpha<span class="op">=</span><span class="fl">0.05</span>):</span>
<span id="lst-binom-ci-one-sided-2"><a href="#lst-binom-ci-one-sided-2" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span>n, p<span class="op">=</span>mu)</span>
<span id="lst-binom-ci-one-sided-3"><a href="#lst-binom-ci-one-sided-3" aria-hidden="true" tabindex="-1"></a>    q <span class="op">=</span> binom_h0.ppf(<span class="dv">1</span> <span class="op">-</span> alpha)</span>
<span id="lst-binom-ci-one-sided-4"><a href="#lst-binom-ci-one-sided-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> q <span class="op">+</span> <span class="dv">1</span></span>
<span id="lst-binom-ci-one-sided-5"><a href="#lst-binom-ci-one-sided-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-one-sided-6"><a href="#lst-binom-ci-one-sided-6" aria-hidden="true" tabindex="-1"></a>success_cnt <span class="op">=</span> <span class="dv">19</span></span>
<span id="lst-binom-ci-one-sided-7"><a href="#lst-binom-ci-one-sided-7" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="fl">1.001</span>, <span class="fl">0.001</span>)</span>
<span id="lst-binom-ci-one-sided-8"><a href="#lst-binom-ci-one-sided-8" aria-hidden="true" tabindex="-1"></a>mu_no_rejection <span class="op">=</span> []</span>
<span id="lst-binom-ci-one-sided-9"><a href="#lst-binom-ci-one-sided-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-one-sided-10"><a href="#lst-binom-ci-one-sided-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="lst-binom-ci-one-sided-11"><a href="#lst-binom-ci-one-sided-11" aria-hidden="true" tabindex="-1"></a>    crit_val <span class="op">=</span> make_binom_criterion(n<span class="op">=</span><span class="dv">30</span>, mu<span class="op">=</span>mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-one-sided-12"><a href="#lst-binom-ci-one-sided-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> success_cnt <span class="op">&lt;</span> crit_val:</span>
<span id="lst-binom-ci-one-sided-13"><a href="#lst-binom-ci-one-sided-13" aria-hidden="true" tabindex="-1"></a>        mu_no_rejection.append(mu_h0)</span>
<span id="lst-binom-ci-one-sided-14"><a href="#lst-binom-ci-one-sided-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-one-sided-15"><a href="#lst-binom-ci-one-sided-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'95% довірчий інтервал: [</span><span class="sc">{</span><span class="bu">min</span>(mu_no_rejection)<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(mu_no_rejection)<span class="sc">}</span><span class="ss">]'</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>95% довірчий інтервал: [0.467 - 1.0]</code></pre>
</div>
</div>
<p>Коли ми використовували двосторонній інтервал, ми отримали ліву межу <span class="math inline">\(0.439 &lt; 0.467\)</span>. Виходить, що односторонній інтервал з точки зору лівої межі дає нам більше інформації. При цьому з точки зору правої межі ми втрачаємо інформацію зовсім. Вона дорівнює 1 просто тому, що ймовірність не може бути більшою.</p>
<p>Насправді зазвичай на праву межу не дивляться під час аналізу, коли ми шукаємо позитивний ефект.</p>
<p>Припустимо, ми отримали не <span class="math inline">\(19\)</span> успіхів, а <span class="math inline">\(22\)</span>. Побудуємо 2 види інтервалів.</p>
<div id="331cca2f" class="cell" data-execution_count="40">
<div id="lst-binom-ci-22" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.26: Двосторонній довірчий інтервал для <span class="math inline">\(22\)</span> успіхів
</figcaption>
<div aria-describedby="lst-binom-ci-22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-22-1"><a href="#lst-binom-ci-22-1" aria-hidden="true" tabindex="-1"></a>success_cnt <span class="op">=</span> <span class="dv">22</span></span>
<span id="lst-binom-ci-22-2"><a href="#lst-binom-ci-22-2" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="lst-binom-ci-22-3"><a href="#lst-binom-ci-22-3" aria-hidden="true" tabindex="-1"></a>mu_no_rejection <span class="op">=</span> []</span>
<span id="lst-binom-ci-22-4"><a href="#lst-binom-ci-22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-5"><a href="#lst-binom-ci-22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="lst-binom-ci-22-6"><a href="#lst-binom-ci-22-6" aria-hidden="true" tabindex="-1"></a>    c1, c2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-22-7"><a href="#lst-binom-ci-22-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> success_cnt <span class="op">&gt;</span> c1 <span class="kw">and</span> success_cnt <span class="op">&lt;</span> c2:</span>
<span id="lst-binom-ci-22-8"><a href="#lst-binom-ci-22-8" aria-hidden="true" tabindex="-1"></a>        mu_no_rejection.append(mu_h0)</span>
<span id="lst-binom-ci-22-9"><a href="#lst-binom-ci-22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-10"><a href="#lst-binom-ci-22-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Двосторонній 95% довірчий інтервал: [</span><span class="sc">{</span><span class="bu">min</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss">]'</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Двосторонній 95% довірчий інтервал: [0.542 - 0.877]</code></pre>
</div>
</div>
<div id="7547ef29" class="cell" data-execution_count="41">
<div id="lst-binom-ci-22-one-sided" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-22-one-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.27: Односторонній довірчий інтервал для <span class="math inline">\(22\)</span> успіхів
</figcaption>
<div aria-describedby="lst-binom-ci-22-one-sided-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-22-one-sided"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-22-one-sided-1"><a href="#lst-binom-ci-22-one-sided-1" aria-hidden="true" tabindex="-1"></a>success_cnt <span class="op">=</span> <span class="dv">22</span></span>
<span id="lst-binom-ci-22-one-sided-2"><a href="#lst-binom-ci-22-one-sided-2" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="fl">1.001</span>, <span class="fl">0.001</span>)</span>
<span id="lst-binom-ci-22-one-sided-3"><a href="#lst-binom-ci-22-one-sided-3" aria-hidden="true" tabindex="-1"></a>mu_no_rejection <span class="op">=</span> []</span>
<span id="lst-binom-ci-22-one-sided-4"><a href="#lst-binom-ci-22-one-sided-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-one-sided-5"><a href="#lst-binom-ci-22-one-sided-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="lst-binom-ci-22-one-sided-6"><a href="#lst-binom-ci-22-one-sided-6" aria-hidden="true" tabindex="-1"></a>    crit_val <span class="op">=</span> make_binom_criterion(n<span class="op">=</span><span class="dv">30</span>, mu<span class="op">=</span>mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-22-one-sided-7"><a href="#lst-binom-ci-22-one-sided-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> success_cnt <span class="op">&lt;</span> crit_val:</span>
<span id="lst-binom-ci-22-one-sided-8"><a href="#lst-binom-ci-22-one-sided-8" aria-hidden="true" tabindex="-1"></a>        mu_no_rejection.append(mu_h0)</span>
<span id="lst-binom-ci-22-one-sided-9"><a href="#lst-binom-ci-22-one-sided-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-one-sided-10"><a href="#lst-binom-ci-22-one-sided-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Односторонній 95% довірчий інтервал: [</span><span class="sc">{</span><span class="bu">min</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss">]'</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Односторонній 95% довірчий інтервал: [0.571 - 1.000]</code></pre>
</div>
</div>
<p>За обома довірчими інтервалами ми робимо висновок, що конверсія значимо відрізняється від <span class="math inline">\(50\%\)</span>. Але односторонній інтервал дає кращу нижню оцінку на ймовірність успіху. Ми можемо зрозуміти, що наша конверсія більша за <span class="math inline">\(57\%\)</span>. А інформація з двостороннього інтервалу про те, що ймовірність менша за <span class="math inline">\(88\%\)</span> не додає нам користі.</p>
<p>Навіщо ж ми тоді взагалі використовуємо двосторонній інтервал? Щоб це зрозуміти, подивимося, як виглядають візуально межі для одностороннього інтервалу.</p>
<div id="cell-fig-binom-ci-22" class="cell" data-execution_count="42">
<div id="lst-binom-ci-22-plot" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-22-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.28: Односторонній довірчий інтервал для <span class="math inline">\(22\)</span> успіхів
</figcaption>
<div aria-describedby="lst-binom-ci-22-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-22-plot"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-22-plot-1"><a href="#lst-binom-ci-22-plot-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">3</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">10</span>))</span>
<span id="lst-binom-ci-22-plot-2"><a href="#lst-binom-ci-22-plot-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-plot-3"><a href="#lst-binom-ci-22-plot-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0, ax <span class="kw">in</span> <span class="bu">zip</span>(mus_h0, axes.flatten()):</span>
<span id="lst-binom-ci-22-plot-4"><a href="#lst-binom-ci-22-plot-4" aria-hidden="true" tabindex="-1"></a>    binom_h0 <span class="op">=</span> binom(n<span class="op">=</span><span class="dv">30</span>, p<span class="op">=</span>mu_h0)</span>
<span id="lst-binom-ci-22-plot-5"><a href="#lst-binom-ci-22-plot-5" aria-hidden="true" tabindex="-1"></a>    probs <span class="op">=</span> binom_h0.pmf(x_grid)</span>
<span id="lst-binom-ci-22-plot-6"><a href="#lst-binom-ci-22-plot-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-plot-7"><a href="#lst-binom-ci-22-plot-7" aria-hidden="true" tabindex="-1"></a>    ax.bar(x_grid, probs, color<span class="op">=</span>turquoise, label<span class="op">=</span><span class="ss">f'PMF, $Binom(</span><span class="sc">{</span>mu_h0<span class="sc">}</span><span class="ss">, 30)$'</span>)</span>
<span id="lst-binom-ci-22-plot-8"><a href="#lst-binom-ci-22-plot-8" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> make_binom_criterion(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.05</span>)</span>
<span id="lst-binom-ci-22-plot-9"><a href="#lst-binom-ci-22-plot-9" aria-hidden="true" tabindex="-1"></a>    crit_reg <span class="op">=</span> (x_grid <span class="op">&gt;=</span> c)</span>
<span id="lst-binom-ci-22-plot-10"><a href="#lst-binom-ci-22-plot-10" aria-hidden="true" tabindex="-1"></a>    ax.bar(x_grid[crit_reg], probs[crit_reg], color<span class="op">=</span>red_pink, label<span class="op">=</span><span class="st">'Критична область'</span>)</span>
<span id="lst-binom-ci-22-plot-11"><a href="#lst-binom-ci-22-plot-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-plot-12"><a href="#lst-binom-ci-22-plot-12" aria-hidden="true" tabindex="-1"></a>    is_rejection <span class="op">=</span> success_cnt <span class="op">&gt;=</span> c</span>
<span id="lst-binom-ci-22-plot-13"><a href="#lst-binom-ci-22-plot-13" aria-hidden="true" tabindex="-1"></a>    ax.axvline(success_cnt, ls<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="ss">f'Q = </span><span class="sc">{</span>success_cnt<span class="sc">}</span><span class="ss"> '</span> <span class="op">+</span> (<span class="st">'відхилено'</span> <span class="cf">if</span> is_rejection <span class="cf">else</span> <span class="st">'не відхилено'</span>), color<span class="op">=</span><span class="st">'gray'</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="lst-binom-ci-22-plot-14"><a href="#lst-binom-ci-22-plot-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-plot-15"><a href="#lst-binom-ci-22-plot-15" aria-hidden="true" tabindex="-1"></a>    rejection_prob <span class="op">=</span> probs[crit_reg].<span class="bu">sum</span>()</span>
<span id="lst-binom-ci-22-plot-16"><a href="#lst-binom-ci-22-plot-16" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f'$\mu = </span><span class="sc">{</span>mu_h0<span class="sc">}</span><span class="ss">$'</span>, fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="lst-binom-ci-22-plot-17"><a href="#lst-binom-ci-22-plot-17" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-display">
<div id="fig-binom-ci-22" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-binom-ci-22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="binom_files/figure-html/fig-binom-ci-22-output-1.png" width="658" height="802" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-binom-ci-22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Рисунок&nbsp;1.14: Односторонній довірчий інтервал для <span class="math inline">\(22\)</span> успіхів
</figcaption>
</figure>
</div>
</div>
</div>
<p>Порівняно з <a href="#fig-binom-ci" class="quarto-xref">Рисунок&nbsp;<span>1.13</span></a> ми бачимо, що права критична область стала більшою через те, що там тепер знаходиться не <span class="math inline">\(2.5\%\)</span>, а <span class="math inline">\(5\%\)</span> від усіх значень. При цьому лівої критичної області просто не існує, тому за великих <span class="math inline">\(\mu\)</span> не відбувається потрапляння <span class="math inline">\(19\)</span> до неї, а значить ми не відкидаємо гіпотезу.</p>
<p>Зауважимо, що якби ми будували двосторонній інтервал, але з удвічі більшою <span class="math inline">\(\alpha\)</span>, потрапляння в праву критичну область траплялися б за тих самих <span class="math inline">\(\mu\)</span>, що й в односторонньому критерії. Тому часто для пошуку односторонньої межі будують двосторонній довірчий інтервал із більшою <span class="math inline">\(\alpha\)</span>, ігноруючи при цьому праву межу. Це зручно, оскільки можна користуватися тільки однією функцією для критерію.</p>
<p>Перевіримо, що вийде за <span class="math inline">\(\alpha = 0.1\)</span>.</p>
<div id="876e6cce" class="cell" data-execution_count="43">
<div id="lst-binom-ci-22-2alpha" class="python cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-binom-ci-22-2alpha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Лістинг&nbsp;1.29: Двосторонній довірчий інтервал для <span class="math inline">\(22\)</span> успіхів з <span class="math inline">\(\alpha = 0.1\)</span>
</figcaption>
<div aria-describedby="lst-binom-ci-22-2alpha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-binom-ci-22-2alpha"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="lst-binom-ci-22-2alpha-1"><a href="#lst-binom-ci-22-2alpha-1" aria-hidden="true" tabindex="-1"></a>success_cnt <span class="op">=</span> <span class="dv">19</span></span>
<span id="lst-binom-ci-22-2alpha-2"><a href="#lst-binom-ci-22-2alpha-2" aria-hidden="true" tabindex="-1"></a>mu_grid <span class="op">=</span> np.arange(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="lst-binom-ci-22-2alpha-3"><a href="#lst-binom-ci-22-2alpha-3" aria-hidden="true" tabindex="-1"></a>mu_no_rejection <span class="op">=</span> []</span>
<span id="lst-binom-ci-22-2alpha-4"><a href="#lst-binom-ci-22-2alpha-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-2alpha-5"><a href="#lst-binom-ci-22-2alpha-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mu_h0 <span class="kw">in</span> mu_grid:</span>
<span id="lst-binom-ci-22-2alpha-6"><a href="#lst-binom-ci-22-2alpha-6" aria-hidden="true" tabindex="-1"></a>    c1, c2 <span class="op">=</span> two_sided_criterion_nonsym(<span class="dv">30</span>, mu_h0, alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="lst-binom-ci-22-2alpha-7"><a href="#lst-binom-ci-22-2alpha-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> success_cnt <span class="op">&gt;</span> c1 <span class="kw">and</span> success_cnt <span class="op">&lt;</span> c2:</span>
<span id="lst-binom-ci-22-2alpha-8"><a href="#lst-binom-ci-22-2alpha-8" aria-hidden="true" tabindex="-1"></a>        mu_no_rejection.append(mu_h0)</span>
<span id="lst-binom-ci-22-2alpha-9"><a href="#lst-binom-ci-22-2alpha-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-binom-ci-22-2alpha-10"><a href="#lst-binom-ci-22-2alpha-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'95% довірчий інтервал: [</span><span class="sc">{</span><span class="bu">min</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss"> - </span><span class="sc">{</span><span class="bu">max</span>(mu_no_rejection)<span class="sc">:.3f}</span><span class="ss">]'</span>)</span></code><button title="Скопіювати в буфер обміну" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>95% довірчий інтервал: [0.467 - 0.778]</code></pre>
</div>
</div>
<p>Бачимо, що отримали таку саму ліву межу, як і в односторонньому інтервалі.</p>
</section>
<section id="властивості-довірчих-інтервалів" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="властивості-довірчих-інтервалів"><span class="header-section-number">1.12</span> Властивості довірчих інтервалів</h2>
<p>Згадаймо визначення довірчого інтервалу.</p>
<p>Нехай є критерій <span class="math inline">\(S = \{Q(\xi) \leqslant C\}\)</span> рівня значущості <span class="math inline">\(\alpha\)</span> для перевірки гіпотези <span class="math inline">\({H}_0: \mu = \mu_0\)</span>, <span class="math inline">\(Q\)</span> — статистика критерію, а <span class="math inline">\(q\)</span> — її реалізація на конкретній вибірці <span class="math inline">\(\xi = \xi_1, \dots, \xi_n\)</span>. Тоді <strong>довірчим інтервалом</strong> називається множина таких <span class="math inline">\(\mu_0\)</span>, на яких критерій <span class="math inline">\(S\)</span> не відкидає гіпотезу <span class="math inline">\({H}_0: \mu = \mu_0\)</span>.</p>
<p>Процедура підрахунку інтервалу — це довгий перебір значень із деяким кроком. Але це все ще залишається деякою функцією від вибірки, тобто <em>статистикою</em> й випадковою величиною, причому її розподіл залежить від статистики <span class="math inline">\(Q\)</span>, а отже, і від початкової вибірки, та від параметра <span class="math inline">\(\mu\)</span> у генеральній сукупності.</p>
<p>Позначимо межі інтервалу за <span class="math inline">\(\mathcal{L}(Q), \mathcal{R}(Q)\)</span> — статистики критерію, які відповідають лівій та правій межі інтервалу.</p>
</section>
<section id="висновок" class="level2" data-number="1.13">
<h2 data-number="1.13" class="anchored" data-anchor-id="висновок"><span class="header-section-number">1.13</span> Висновок</h2>
<p>Ми розглянули, як можна використовувати біноміальний розподіл для перевірки гіпотези про ймовірність успіху. Для цього ми визначили критерій, критичну область, <span class="math inline">\(p\)</span>-значення. Показали, як можна використовувати ці поняття для різних видів гіпотез: односторонніх, двосторонніх, симетричних та несиметричних.</p>
</section>
<section id="питання-для-самоперевірки" class="level2" data-number="1.14">
<h2 data-number="1.14" class="anchored" data-anchor-id="питання-для-самоперевірки"><span class="header-section-number">1.14</span> Питання для самоперевірки</h2>
<ol type="1">
<li>Які гіпотези можна перевірити за допомогою біноміального розподілу?</li>
<li>Як визначити критичну область для критерію?</li>
<li>Як визначити <span class="math inline">\(p\)</span>-значення для критерію?</li>
<li>Як визначити критичну область для двостороннього критерію?</li>
<li>Як визначити <span class="math inline">\(p\)</span>-значення для двостороннього критерію?</li>
<li>Як визначити критичну область для несиметричного розподілу?</li>
<li>Як визначити <span class="math inline">\(p\)</span>-значення для несиметричного розподілу?</li>
</ol>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>У статистиці <span class="math inline">\(\hat{\mu}\)</span> позначається як оцінка параметра <span class="math inline">\(\mu\)</span>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Метод <code>integers()</code> генерує випадкові цілі числа в заданому діапазоні. Аргумент <code>endpoint</code> вказує, що верхня межа включається у діапазон.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Розподіл Бернуллі — це дискретний розподіл ймовірностей, який моделює випадковий експеримент з двома можливими результатами: успіхом або невдачею.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Біноміальний розподіл моделює кількість успішних випадків у послідовності незалежних випробувань. Сума <span class="math inline">\(n\)</span> незалежних випадкових величин з розподілу Бернуллі підпорядковується біноміальному розподілу.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Англ. <em>cyan</em>, від грец. κυανouς — “блакитний”, “лазуровий”.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Скопійовано!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Скопійовано!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link" aria-label="Вступ">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Вступ</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./z-test.html" class="pagination-link" aria-label="$Z$-критерій Фішера">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><span class="math inline">\(Z\)</span>-критерій Фішера</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Прикладний статистичний аналіз</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Ця книга створена за допомогою <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>